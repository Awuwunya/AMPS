<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>AMPS v2.0 TECHNICAL DOCUMENTATION</title>
	<link href="https://fonts.googleapis.com/css2?family=Bitter&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Lexend+Deca&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Overpass:400,700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Mono&display=swap" rel="stylesheet">
	<script>
		function init(){
			document.body.addEventListener("click", (e) => {
				if(e.target && e.target.matches("a") && e.target.hash){
					e.preventDefault();
					document.documentElement.scrollTop = document.getElementById(e.target.hash.substring(1)).getBoundingClientRect().y + document.documentElement.scrollTop;
					showmenu(false);

					// delay a little to prevent browser bugs
					setTimeout(() => {
						window.location.hash = e.target.hash;
					}, 500);
				}
			});

			refRAM();
			showmenu(!window.location.hash);
		}

		const chantbl = [
			{ size: 1, align: 1, name: "cFlags", },
			{ size: 1, align: 1, name: "cType", },
			{ size: 4, align: 2, name: "cData", },
			{ size: 0, align: 1, name: "cEnvPos", cno: 0x10, },
			{ size: 0, align: 1, name: "cStatPSG4", cyes: 0x10, },
			{ size: 1, align: 1, name: "cPanning", },
			{ size: 1, align: 1, name: "cDetune", },
			{ size: 1, align: 1, name: "cPitch", },
			{ size: 1, align: 1, name: "cVolume", },
			{ size: 1, align: 1, name: "cTick", },
			{ size: 0, align: 1, name: "cVolEnv", cno: 0x10, },
			{ size: 0, align: 1, name: "cSample", },
			{ size: 1, align: 1, name: "cVoice", },
			{ size: 1, align: 1, name: "cDuration", },
			{ size: 1, align: 1, name: "cLastDur", },
			{ size: 2, align: 2, name: "cFreq", },

			{ size: 0, align: 2, cyes: 0x02, name: "cModDelay", },
			{ size: 4, align: 2, cyes: 0x02, name: "cMod", },
			{ size: 2, align: 2, cyes: 0x02, name: "cModFreq", },
			{ size: 1, align: 1, cyes: 0x02, name: "cModSpeed", },
			{ size: 1, align: 1, cyes: 0x02, name: "cModStep", },
			{ size: 1, align: 1, cyes: 0x02, name: "cModCount", },

			{ size: 1, align: 1, cyes: 0x04, name: "cPortaSpeed", },
			{ size: 2, align: 2, cyes: 0x04, name: "cPortaFreq", },
			{ size: 2, align: 2, cyes: 0x04, name: "cPortaDisp", },

			{ size: 1, align: 1, cyes: 0x10, name: "cVolEnv", },
			{ size: 1, align: 1, cyes: 0x10, name: "cEnvPos", },

			{ size: 1, align: 1, cyes: 0x08, name: "cModEnv", },
			{ size: 1, align: 1, cyes: 0x08, name: "cModEnvPos", },
			{ size: 1, align: 1, cyes: 0x08, name: "cModEnvSens", },

			{ size: 2, align: 2, cyes: 0x80, name: "cChipFreq", },
			{ size: 1, align: 1, cyes: 0x80, name: "cChipVol", },

			{ size: 3, align: 1, name: "cLoop", },
			{ size: 1, align: 2, name: "cStatPSG4", offset: -2, cno: 0x10, },
			{ size: 1, align: 2, name: "cPrio", offset: -1, },
			{ size: 0, align: 2, name: "cSizeSFX", save: -2, },

			{ size: 1, align: 1, name: "cGateCur", },
			{ size: 1, align: 1, name: "cGateMain", },
			{ size: 1, align: 1, name: "cStack", },
			{ size:12, align: 2, name: "", },
			{ size: 0, align: 2, name: "cSize", save: -1, },
		];

		const ramtbl = [
			{ size: 1, align: 1, name: "mFlags", },
			{ size: 1, align: 1, name: "mCtrPal", },
			{ size: 8, align: 1, name: "mComm", },
			{ size: 0, align: 2, name: "mMasterVolFM", },
			{ size: 4, align: 2, name: "mFadeAddr", },
			{ size: 1, align: 1, name: "mSpeed", },
			{ size: 1, align: 1, name: "mSpeedAcc", },
			{ size: 1, align: 1, name: "mTempo", },
			{ size: 1, align: 1, name: "mTempoAcc", },
			{ size: 3, align: 1, name: "mQueue", },
			{ size: 1, align: 1, name: "mMasterVolPSG", },
			{ size: 4, align: 2, name: "mVctMus", },
			{ size: 1, align: 1, name: "mMasterVolDAC", },
			{ size: 1, align: 1, name: "mSpindash", },
			{ size: 1, align: 1, name: "mContCtr", },
			{ size: 1, align: 1, name: "mContLast", },
			{ size: 1, align: 1, name: "mLastCue", },

			{ size: 0,  align: 2, name: "mBackUpArea", },
			{ size: -1, align: 2, name: "mDAC1", },
			{ size: -1, align: 2, name: "mDAC2", },
			{ size: -1, align: 2, name: "mFM1", },
			{ size: -1, align: 2, name: "mFM2", },
			{ size: -1, align: 2, name: "mFM3", },
			{ size: -1, align: 2, name: "mFM4", },
			{ size: -1, align: 2, name: "mFM5", },
			{ size: -1, align: 2, name: "mFM6", cyes: 0x40, },
			{ size: -1, align: 2, name: "mPSG1", },
			{ size: -1, align: 2, name: "mPSG2", },
			{ size: -1, align: 2, name: "mPSG3", },

			{ size: -2, align: 2, name: "mSFXDAC1", },
			{ size: -2, align: 2, name: "mSFXFM3", },
			{ size: -2, align: 2, name: "mSFXFM4", },
			{ size: -2, align: 2, name: "mSFXFM5", },
			{ size: -2, align: 2, name: "mSFXPSG1", },
			{ size: -2, align: 2, name: "mSFXPSG2", },
			{ size: -2, align: 2, name: "mSFXPSG3", },
			{ size: 0,  align: 2, name: "mChannelEnd", },

			{ size: 0,  align: 2, cyes: 0x20, name: "mBackUpLoc", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackDAC1", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackDAC2", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackFM1", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackFM2", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackFM3", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackFM4", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackFM5", },
			{ size: -1, align: 2, cyes: 0x60, name: "mBackFM6", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackPSG1", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackPSG2", },
			{ size: -1, align: 2, cyes: 0x20, name: "mBackPSG3", },

			{ size: 1, align: 1, cyes: 0x20, name: "mBackTempoMain", },
			{ size: 1, align: 1, cyes: 0x20, name: "mBackTempoSpeed", },
			{ size: 1, align: 1, cyes: 0x20, name: "mBackTempo", },
			{ size: 1, align: 1, cyes: 0x20, name: "mBackTempoCur", },
			{ size: 4, align: 2, cyes: 0x20, name: "mBackVctMus", },

			{ size: 1, align: 1, cyes: 0x01, name: "msChktracker", },
			{ size: 0, align: 2, name: "mSize", },
		];

		var sizes = Array(2), mode = 0;

		function refRAM() {
			mode = document.getElementById("mdsafe").checked * 0x01;
			mode |= document.getElementById("mdmod").checked * 0x02;
			mode |= document.getElementById("mdport").checked * 0x04;
			mode |= document.getElementById("mdmenv").checked * 0x08;
			mode |= document.getElementById("mdvenvdf").checked * 0x10;
			mode |= document.getElementById("mdbackup").checked * 0x20;
			mode |= document.getElementById("mdfm6").checked * 0x40;
			mode |= document.getElementById("mdstest").checked * 0x80;

			let def = `
				<tr>
					<td>offset</td><td>length</td><td>equate</td>
				</tr>
			`;

			document.getElementById("chantable").innerHTML = def + procRAM(chantbl);
			document.getElementById("ramtable").innerHTML = def + procRAM(ramtbl);
		}

		function procRAM(tbl) {
			let data = "", pos = 0;

			for(e of tbl) {
				if(e.cyes && (mode & e.cyes) != e.cyes)
					continue;

				if(e.cno && (mode & e.cno) != 0)
					continue;

				if(e.align && pos % e.align != 0){
					pos += e.align - (pos % e.align);
				}

				let s = e.size >= 0 ? e.size : sizes[-1 - e.size];

				if(e.offset){
					data += "<tr><td>"+ hexstr(pos + e.offset, 4, "$") +"</td><td>"+ hexstr(s, 2, "$") +"</td><td>"+ e.name +"</td>";

				} else {
					data += "<tr><td>"+ hexstr(pos, 4, "$") +"</td><td>"+ hexstr(s, 2, "$") +"</td><td>"+ e.name +"</td>";
					pos += s;
				}

				if(e.save) {
					sizes[-1 - e.save] = pos;
				}
			}

			return data;
		}

		// convert an array of values into a string
		function hexstrarr(vals) {
			vals = vals.map(x => hexstr(x, 2, "$"));
			return vals.join(", ");
		}

		// convert a value into a string
		function hexstr(num, len, pfx) {
			num = num.toString(16).toUpperCase();
			return pfx + ("0".repeat(len - num.length)) + num;
		}

		// function for reading hex value from an input element
		function gethex(e){
			// check if element has valid text
			let a = document.getElementById(e).value;
			if(a !== a || a == undefined) return null;
			return gethexstr(a);
		}

		// function for reading hex value from a string
		function gethexstr(a){
			// trim any hex identifiers
			a.startsWith("$") && (a = a.substring(1));
			a.startsWith("0x") && (a = a.substring(2));

			// parse and check if valid value is returned
			a = parseInt(a, 16);
			if(a !== a || a == undefined) return null;
			return a;
		}

		function bpmx(){
			// check if element has valid text
			let a = document.getElementById('bcbpm').value;
			if(a !== a || a == undefined) return null;

			// parse and check if valid value is returned
			a = parseFloat(a);
			if(a !== a || a == undefined) return null;

			// get value for tick mult
			let m = gethex('bctm');
			if(!m) return;

			// get value for tick tpq
			let q = gethex('bctq');
			if(!q) return;

			// do overflow conversion
			let o = 256 - (a / (60 / (q * m / 60)) * 256);
			if(o < 0 || o >= 256){
				document.getElementById("bcofw").value = "invalid";

			} else document.getElementById("bcofw").value = hexstr(~~o, 2, "");

			// do counter conversion
			if(a > 150 || a < 0)
				document.getElementById("bcctr").value = "invalid";

			else if(a == 150)
				document.getElementById("bcctr").value = hexstr(0, 2, "");

			else if(a == 0)
				document.getElementById("bcctr").value = hexstr(1, 2, "");

			else {
				let diff = Number.POSITIVE_INFINITY, val = 0;

				// we have to do it this fucking way
				for(let p = 2;p < 0x100; p++){
					let r = cctr(p, m, q);

					// check if the difference is smaller
					if(diff > Math.abs(a - r)){
						diff = Math.abs(a - r);
						val = p;
						console.log(diff, r)
					}
				}

				document.getElementById("bcctr").value = hexstr(~~val, 2, "");
			}
		}

		// function for calculating bpm for counter method
		function cctr(a, m, q){
			return 60 / (m / ((a - 1) / a) * q / 60);
		}

		function bpmc(e){
			// get value for current element
			let a = gethex(e);
			if(a == null) return;

			// convert tempo
			let n = tempoConv(a);

			// get value for tick mult
			let m = gethex('bctm');
			if(!m) return;

			// get value for tick tpq
			let q = gethex('bctq');
			if(!q) return;

			let b = 0;
			if(e == "bcctr") {
				// counter method code
				if(a)
					b = cctr(a, m, q);
				else b = 150;

			} else {
				// overflow method
				b = ((256 - a) * (60 / (q * m / 60))) / 256;
			}

			// round the value and submit
			b = Math.round(b * 10000) / 10000;
			document.getElementById("bcbpm").value = b;

			// if counter, swap values around
			if(e == "bcctr") {
				let x = a;
				a = n;
				n = x;
			}

			// save values
			document.getElementById("bcctr").value = hexstr(n, 2, "");
			document.getElementById("bcofw").value = hexstr(a, 2, "");
		}

		function tmpc(e){
			// get value for current element
			let a = gethex(e);
			if(a == null) return;

			// negate if Sonic 2
			if(e == "tmsh2") a = (-a) & 0xFF;

			// convert tempo
			let n = tempoConv(a);

			// if counter, swap values around
			if(e == "tmctr") {
				let x = a;
				a = n;
				n = x;
			}

			// save values
			document.getElementById("tmctr").value = hexstr(n, 2, "");
			document.getElementById("tmofw").value = hexstr(a, 2, "");
			document.getElementById("tmsh2").value = hexstr((-a) & 0xFF, 2, "");
		}

		// function to convert between overflow and counter tempo algorithms
		function tempoConv(n){
			n = ((n == 0) << 8) | n;
			n = ((((n - 1) << 8) + (n >> 1)) / n) & 0xFF;
			n = (0x100 - ((n == 0) | n)) & 0xFF;
			return n;
		}

		// function for converting modulation between 68k, z80 and amps
		function modc(e){
			// check if there is a valid value
			let vals = document.getElementById(e).value;
			if(vals !== vals || vals == undefined) return null;

			// convert into array of ints
			vals = vals.split(",");
			vals = vals.map(x => gethexstr(x.trim()));

			// check if any were null and return if so
			let ret = false;
			vals.forEach(x => x == null ? (ret = true) : false);
			if(ret) return;

			// transform to AMPS format - wait speed step count
			switch(e) {
				case "mc6":
					vals[0]++;              // 68k does not update modulation the frame tracker is read, AMPS does.
					vals[3]++;              // last step is always done twice, this (somewhat) accounts for that
					vals[0] > 0xFF && (vals[0] = 0xFF);
					vals[3] > 0xFF && (vals[3] = 0xFF);
					break;

				case "mc8":
					vals[0]--;              // z80 stops waiting once the param reaches $00, but 68k and AMPS when the carry flag is set (reaches $FF)
					vals[0] < 0 && (vals[0] = 0);
					vals[3] = vals[3] || 0x100;
					vals[3] /= vals[1] || 0x100;// count is always decremented every frame, not every step. Also there is some weird special behaviour
					break;
			}

			// keep in range
			vals = vals.map(x => x & 0xFF);

			if(e !== "mca"){
				// save to AMPS format
				document.getElementById("mca").value = hexstrarr(vals);
			}

			if(e !== "mc6"){
				// save to 68k format
				let v6 = [ vals[0] - 1, vals[1], vals[2], vals[3] - 1 ];
				v6[0] < 0 && (v6[0] = 0);
				v6[3] < 0 && (v6[3] = 0);
				document.getElementById("mc6").value = hexstrarr(v6);
			}

			if(e !== "mc8"){
				// save to z80 format
				let v8 = [ vals[0] + 1, vals[1], vals[2], (vals[3] || 0x100) *  (vals[1] || 0x100) ];
				if(v8[0] > 0xFF) v8[0] = 0xFF;
				if(v8[3] > 0xFF) v8[3] = 0xFF;
				document.getElementById("mc8").value = hexstrarr(v8);
			}
		}

		function hlvte(e){
			if(!document.getElementById(e).classList.contains("volhi"))
				document.getElementById(e).classList.add("volhi");
		}

		function uhvte(e){
			document.getElementById(e).classList.remove("volhi");
		}

		var menustate = false;

		function showmenu(state){
			if(state === null){
				menustate = !menustate;

			} else menustate = state;

			document.getElementById("mainarrow").classList[menustate ? "add" : "remove"]("hide");
			document.getElementById("mainwrap").classList[menustate ? "add" : "remove"]("mainhide");
		}
	</script>
	<style>
		html {
			background: #131313;
			color: #C2C2C2;
			padding: 1vh 2vw;
			overflow-x: hidden;
			scroll-behavior: smooth;
			text-rendering: optimizeLegibility;
		}

		body {
			margin: 0;
		}

		main {
			background: #232323;
			border: .16vw solid gray;
			border-radius: 2vw;
			margin: auto;
			padding: 2vw;
		}

		#mainwrap {
			width: 100%;
			margin-left: 0;
			transition: margin-left .5s ease-in-out;
			position: relative;
			z-index: 1;
			box-shadow: -10px -10px 57px 40px black;
			background: rgba(0,0,0,.95);
		}

		.mainhide {
			margin-left: 50% !important;
		}

		#mainarrow {
			position: fixed;
			z-index: 10;
			font: 3.5vw 'Noto Sans', sans-serif;
			border: .15vw solid rgba(128,128,128,.5);
			background: rgba(128,128,128,.7);
			border-radius: 50%;
			width: 5vw;
			height: 5vw;
			bottom: 1vw;
			left: 1vw;
			outline: 0;
			padding: 0;
			cursor: pointer;
			transition: background-color .5s ease-in-out, border-color .5s ease-in-out, left .5s ease-in-out;
		}

		#mainarrow:hover {
			background: rgba(144,144,144,.9);
			border-color: rgba(192,192,192,.5);
		}

		#mainarrow:active {
			background: rgba(255,144,144,1);
			border-color: rgba(255,176,176,1);
			transition: background-color 0s ease-in-out, border-color 0s ease-in-out;
		}

		#mainarrow:hover > svg, #mainarrow:active > svg {
			opacity: 1;
		}

		#mainarrow > svg {
			width: 70%;
			height: 70%;
			margin: 15%;
			opacity: .6;
			transform: rotate(180deg);
			transition: transform .5s ease-in-out, opacity .5s ease-in-out;
		}

		#mainarrow.hide > svg {
			transform: rotate(0deg);
		}

		#mainarrow.hide {
			left: 43% !important;
		}

		img {
			width: 100%;
		}

		.bd {
			border-top: .3vw solid;
			border-image: linear-gradient(to right, rgba(94,90,133,0.03) 0%, rgba(92,92,104,1) 20%, rgba(92,92,104,1) 80%, rgba(94,90,133,0.03) 100%) 1 round;
		}

		.bx {
			color: inherit;
			text-decoration: none;
		}

		.bx:hover, .bx:focus {
			text-decoration: underline;
		}

		.bx:active {
			color: hotpink;
		}

		h1 {
			font: 2.8vw 'Noto Sans', sans-serif;
			margin: .5vw 0;
		}

		h3 {
			font: 2vw 'Noto Sans', sans-serif;
			margin: 1vw 0;
		}

		h4 {
			font: 1.4vw 'Noto Sans', sans-serif;
			margin: 1vw 0;
			font-weight: bold;
		}

		p {
			font: 1vw 'Lexend Deca', sans-serif;
			margin: .3vw 1.2vw .8vw 0;
		}

		p > a, li > a, td > a {
			color: #cbacb0;
			text-decoration: none;
		}

		p > a:active, li > a:active, td > a:active {
			color: #b57e79;
			text-decoration: underline;
		}

		nav {
			padding-left: .8vw;
			height: 100%;
			position: fixed;
			z-index: 0;
			top: 0;
		}

		tblcnt {
			font: 1.1vw 'Bitter', sans-serif;
			display: block;
			white-space: pre;
		}

		tblcnt > a {
			color: #C2C2C2;
			text-decoration: none;
		}

		tblcnt > a:focus, tblcnt > a:hover, p > a:focus, p > a:hover, li > a:focus, li > a:hover, td > a:focus, td > a:hover {
			text-decoration: underline;
		}

		tblcnt > a:active {
			color: #ffffff;
			text-decoration: underline;
		}

		li {
			font: 1.1vw 'Lexend Deca', sans-serif;
			margin: 0 1.5vw 0 0;
		}

		li > b {
			color: #da7d31;
			font: 600 1.1vw 'Overpass', sans-serif;
		}

		table {
			font: .95vw 'Roboto Mono', sans-serif;
			margin: 0 .5vw;
			border-collapse: collapse;
			text-align: center;

			overflow-x: auto;
			max-width: 100%;
			width: fit-content;
			display: block;
			position: relative;
		}

		td {
			padding: .24vw .24vw;
			border: .1vw solid whitesmoke;
		}

		cbox {
			display: inline-block;
			margin: .3vw;
			white-space: nowrap;
		}

		cbox > input[type=checkbox] {
			margin: 0;
			vertical-align: middle;
			-webkit-appearance: none;
			width: 1vw;
			height: 1vw;
			display: inline-block;
			position: relative;
			background: #1e1e1e;
			border: .1vw solid #545454;
			padding: .4vw;
			border-radius: 20%;
			outline: none !important;
		}

		cbox > input[type=checkbox]:active, cbox > input[type=checkbox]:checked:active,
		cbox > input[type=checkbox]:focus, cbox > input[type=checkbox]:checked:focus,
		cbox > input[type=checkbox]:hover, cbox > input[type=checkbox]:checked:hover {
			background: #393939;
		}

		cbox > input[type=checkbox]:checked {
			background: #000000;
		}

		cbox > input[type=checkbox]:checked:after {
			content: '\2714';
			font: 1vw 'Roboto Mono', sans-serif;
			position: absolute;
			top: -.35vw;
			left: 0;
			color: #b5bfc6;
			font-weight: bold;
		}

		cbox > input[type=checkbox]::after {
			outline: none !important;
		}

		cbox > span {
			font: 1.2vw 'Overpass', sans-serif;
			margin-left: .1vw;
			vertical-align: middle;
		}

		input {
			background: #1e1e1e;
			border-color: #5c585b;
			color: whitesmoke;
			font: 1vw 'Roboto Mono', monospace;
		}

		input:focus, input:active {
			background: #2e2e2e;
		}

		button {
			background: #1e1e1e;
			color: whitesmoke;
			border: .1vw solid #5c585b;
			font: .8vw 'Overpass', sans-serif;
			cursor: pointer;
		}

		button:hover, button:focus {
			background: #272e27;
		}

		button:active {
			background: #402b2c;
		}

		td > button {
			padding: .2vw .4vw;
			font-size: .9vw;
		}

		smps2asm, asm {
			display: block;
			overflow-x: auto;
			tab-size: 8;
			white-space: pre;
			background: #272823;
			font: .9vw 'Roboto Mono', monospace;
			border: .1vw solid rgba(255,255,255,.3);
			margin: .1vw .4vw;
			padding: .4vw .5vw;
		}

		smps2asm::-moz-selection, smps2asm > *::-moz-selection, asm::-moz-selection, asm > *::-moz-selection {
			background: #606080CF;
		}

		smps2asm::selection, smps2asm > *::selection, asm::selection, asm > *::selection {
			background: #606080CF;
		}

		smps2asm > lbl, asm > lbl {
			color: #D4D4D4;
		}

		smps2asm > mac, asm > mac {
			color: #4CBD00;
		}

		smps2asm > val, asm > val {
			color: #FF7575;
		}

		smps2asm > equ, asm > equ {
			color: #AA7FFF;
		}

		smps2asm > cmt, asm > cmt {
			color: #8F8F8F;
		}

		smps2asm > opc, asm > opc {
			color: #9fb6f2;
		}

		smps2asm > mth, asm > mth {
			color: #FFC273;
		}

		asm > ea {
			color: #4EB51B;
		}

		asm > math {
			color: #FFC273;
			display: inline-block;
		}

		asm > str {
			color: #FF8597;
			background: #5729467D;
		}

		voltbl > div:first-of-type {
			width: 100%;
			height: auto;
			position: relative;
			display: block;
		}

		voltbl > div:first-of-type > img:not(:first-of-type) {
			position: absolute;
			top: 0;
			left: 0;
			filter: saturate(60%);
			transition: .15s filter ease-in-out;
		}

		voltbl > div:first-of-type > img:first-of-type {
			position: relative;
		}

		voltbl > div:first-of-type > .volhi {
			filter: saturate(100%) !important;
			z-index: 100;
		}

		voltbl > div:last-of-type {
			width: 100%;
			display: block;
		}

		voltbl > div:last-of-type > div {
			display: inline-block;
			font: 1.2vw 'Overpass', sans-serif;
			margin-right: .3vw;
			cursor: default;

			background: rgba(255,255,255, 0);
			border: .1vw solid rgba(255,255,255, 0);
			border-radius: .3vw;
			padding: .1vw;
			transition: background-color .25s ease-in-out, border-color .25s ease-in-out;
		}

		voltbl > div:last-of-type > div:hover, voltbl > div:last-of-type > div:active {
			background-color: rgba(255,255,255, .1);
			border-color: rgba(255,255,255, .2);
		}

		voltbl > div:last-of-type > div > div {
			width: .7vw;
			height: .7vw;
			display: inline-block;
			pointer-events: none;
			margin-right: .2vw;

			border: .1vw solid rgba(0,0,0, .4);
			border-radius: 50%;
			filter: blur(.1vw) saturate(80%);
			transition: border-color .25s ease-in-out, filter .25s ease-in-out, margin-right .1s linear;
		}

		voltbl > div:last-of-type > div:hover > div, voltbl > div:last-of-type > div:active > div {
			border-color: rgba(0,0,0, .45);
			filter: blur(.08vw) saturate(100%);
			margin-right: .4vw;
		}

		@media screen and (max-width: 800px){
			main {
				border: .2vw solid gray;
				border-radius: 2.2vw;
			}

			.mainhide {
				margin-left: 60% !important;
			}

			#mainarrow.hide {
				left: 52% !important;
			}

			#mainarrow {
				border-width: .22vw;
				width: 6vw;
				height: 6vw;
				bottom: 1.2vw;
				left: 1.2vw;
			}

			tblcnt {
				font-size: 1.8vw;
			}

			h1 {
				font-size: 4vw;
			}

			h3 {
				font-size: 3.2vw;
			}

			h4 {
				font-size: 2.4vw;
			}

			p {
				font-size: 1.8vw;
			}

			ul {
				margin-top: .4vw;
				margin-bottom: .6vw;
			}

			li {
				font-size: 1.7vw;
				margin: 0 1.7vw 0 0;
			}

			li > b {
				font-size: 1.8vw;
			}

			table {
				font-size: 1.5vw;
				border-width: .15vw;
				margin: .7vw .1vw 1vw;
			}

			td {
				padding: .3vw .4vw;
			}

			cbox > input[type=checkbox] {
				width: 1.8vw;
				height: 1.8vw;
				border-width: .2vw;
				padding: .8vw;
			}

			cbox > input[type=checkbox]:checked:after {
				font-size: 1.6vw;
				top: -.3vw;
			}

			cbox > span {
				font-size: 1.8vw;
			}

			input {
				font: 1.7vw 'Roboto Mono', monospace;
			}

			button {
				border: .15vw solid #5c585b;
				font: 1.4vw 'Overpass', sans-serif;
			}

			td > button {
				padding: .4vw .6vw;
				font-size: 1.5vw;
			}

			smps2asm, asm {
				font-size: 1.5vw;
				border-width: .2vw;
				margin: .1vw .5vw;
				padding: .3vw .4vw;
			}

			voltbl > div:first-of-type > img:not(:first-of-type) {
				transition: none;
			}

			voltbl > div:last-of-type > div {
				font-size: 1.6vw;
				margin-right: .4vw;

				border-width: .15vw;
				border-radius: .4vw;
				padding: .2vw;
			}

			voltbl > div:last-of-type > div > div {
				width: 1vw;
				height: 1vw;
				display: inline-block;
				pointer-events: none;
				margin-right: .3vw;

				border-width: .2vw;
			}

			voltbl > div:last-of-type > div:hover > div, voltbl > div:last-of-type > div:active > div {
				margin-right: .5vw;
			}
		}

		@media screen and (max-width: 600px){
			html {
				padding: 0;
				text-rendering: optimizeSpeed;
			}

			main {
				border: .2vw solid gray;
				border-radius: 0;
				padding: 1vw;
			}

			.mainhide {
				margin-left: 65% !important;
			}

			#mainarrow.hide {
				left: 56% !important;
			}

			#mainarrow {
				border-width: .28vw;
				width: 6.5vw;
				height: 6.5vw;
				bottom: 1.5vw;
				left: 1.5vw;
			}

			tblcnt {
				font-size: 2vw;
			}

			.bd {
				border-top: .4vw solid;
			}

			h1 {
				font-size: 5vw;
				margin: 1.8vw 0;
			}

			h3 {
				font-size: 3.8vw;
				margin: 1.5vw 0;
			}

			h4 {
				font-size: 2.8vw;
				margin: 1.5vw 0;
			}

			p {
				font-size: 2.4vw;
				margin: .5vw 1.6vw 1vw 0;
			}

			ul {
				margin-top: 1vw;
				margin-bottom: 1vw;
			}

			li {
				font-size: 2.25vw;
				margin: 0 1.9vw 0 0;
			}

			li > b {
				font-size: 2.4vw;
			}

			table {
				font-size: 1.9vw;
				margin: 1vw .1vw 1.5vw;
				border-width: .2vw;
			}

			td {
				padding: .5vw .6vw;
			}

			cbox {
				margin: .5vw;
			}

			cbox > input[type=checkbox] {
				width: 3vw;
				height: 3vw;
				border-width: .28vw;
				padding: 1vw;
			}

			cbox > input[type=checkbox]:checked:after {
				font-size: 2.5vw;
				top: -.6vw;
			}

			cbox > span {
				font-size: 2.4vw;
				margin-left: .4vw;
			}

			input {
				font: 2.5vw 'Roboto Mono', monospace;
			}

			button {
				border: .2vw solid #5c585b;
				font: 2vw 'Overpass', sans-serif;
			}

			td > button {
				padding: .7vw .9vw;
				font-size: 2.2vw;
			}

			smps2asm, asm {
				font-size: 1.8vw;
				border-width: .3vw;
				margin: 0 .4vw;
				padding: .4vw .2vw;
			}

			voltbl > div:first-of-type > img:not(:first-of-type) {
				transition: none;
			}

			voltbl > div:last-of-type > div {
				width: 8vw;
				font-size: 1.9vw;
				margin-right: .5vw;
				border-radius: .8vw;
				padding: .3vw;

				transition: none;
				border: .2vw solid rgba(255, 255, 255, .2);
				text-align: center;
			}

			voltbl > div:last-of-type > div > div {
				width: 1.1vw;
				height: 1.1vw;
				margin-right: .5vw;
				border-width: .18vw;
				transition: none;
			}
		}
	</style>
</head>
<body onload="init();">
	<button id="mainarrow" onclick="showmenu(null)" aria-label="toggle table of contents">
		<svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><g><title>Layer 1</title><rect stroke="#fff" transform="rotate(45 118,171) " id="svg_2" height="24" width="150" y="159" x="43" stroke-width="0" fill="#ffffff"/><rect stroke="#fff" transform="rotate(-45 118,81) " id="svg_6" height="24" width="150" y="69" x="43" stroke-width="0" fill="#ffffff"/></g></svg>
	</button>
	<nav>
		<h1>Table of contents</h1>
		<tblcnt><a href="#part1">1 — Introduction</a></tblcnt>
		<tblcnt><a href="#part1_1">	1.1 — Undefined Behaviour</a></tblcnt>
		<tblcnt><a href="#part1_2">	1.2 — SMPS vs Sound-Source</a></tblcnt>
		<tblcnt><a href="#part2">2 — AMPS Overview</a></tblcnt>
		<tblcnt><a href="#part3">3 — Sound System</a></tblcnt>
		<tblcnt><a href="#part3_1">	3.1 — Music Files</a></tblcnt>
		<tblcnt><a href="#part3_1_1">		3.1.1 — Tempo vs BPM</a></tblcnt>
		<tblcnt><a href="#part3_2">	3.2 — Sound Effect Files</a></tblcnt>
		<tblcnt><a href="#part4">4 — Trackers</a></tblcnt>
		<tblcnt><a href="#part4_1">	4.1 — Trackers Overview</a></tblcnt>
		<tblcnt><a href="#part4_2">	4.2 — Tracker Commands</a></tblcnt>
		<tblcnt><a href="#part4_3">	4.3 — SN76496</a></tblcnt>
		<tblcnt><a href="#part4_4">	4.4 — YM2612</a></tblcnt>
		<tblcnt><a href="#part4_5">	4.5 — Dual PCM</a></tblcnt>
		<tblcnt><a href="#part5">5 — Frequency</a></tblcnt>
		<tblcnt><a href="#part5_1">	5.1 — Modulation</a></tblcnt>
		<tblcnt><a href="#part5_2">	5.2 — Portamento</a></tblcnt>
		<tblcnt><a href="#part6">6 — Volume</a></tblcnt>
		<tblcnt><a href="#part6_1">	6.1 — Channel Volumes</a></tblcnt>
		<tblcnt><a href="#part6_2">	6.2 — Underwater mode</a></tblcnt>
		<tblcnt><a href="#part6_3">	6.3 — Volume Fading</a></tblcnt>
		<tblcnt><a href="#part7">7 — Envelopes</a></tblcnt>
		<tblcnt><a href="#part8">8 — Communication Bytes</a></tblcnt>
		<tblcnt><a href="#part9">9 — Memory Map</a></tblcnt>
		<tblcnt><a href="#part10">10 — Creating Custom Music</a></tblcnt>
		<tblcnt><a href="#part11">11 — Porting Music And Sound Effects</a></tblcnt>
		<tblcnt><a href="#part11_1">	11.1 — Modulation Converter</a></tblcnt>
		<tblcnt><a href="#part12">12 — Installing AMPS</a></tblcnt>
		<tblcnt><a href="#part13">13 — Frequent Questions & Answers</a></tblcnt>
		<tblcnt><a href="#part14">14 — Changelog</a></tblcnt>
		<tblcnt><a href="#part14_1">	14.1 — AMPS v1.0</a></tblcnt>
		<tblcnt><a href="#part14_2">	14.2 — AMPS v2.0</a></tblcnt>
		<tblcnt><a href="#part14_3">	14.3 — AMPS v2.1</a></tblcnt>
	</nav>
<div id="mainwrap">
<main>
	<h1 style='text-decoration: underline;'>AMPS v2.0 technical manual</h1>
	<h1 id="part1" class="bd"><a class="bx" href="#part1">1 — Introduction</a></h1>
	<p>
		AMPS is a sound driver based on Sound-Source, that runs on the Motorola 68000, designed to be used with ROM hacks and Sega Mega Drive software. Although similar to Sound-Source, AMPS is fundamentally different in many aspects. It is also heavily customized, RAM-efficient and cycle-efficient. AMPS is powered by Dual PCM FlexEd, meaning that you can use 2 DAC sample channels with pitch and volume control. AMPS was designed to be a well-documented driver with a lot of capabilities so that the music can sound better, and the program and music can interact with each other. To ensure this, AMPS has a very robust codebase built to allow future expansion and customized programming for program-specific circumstances.
	</p>
	<p>
		AMPS is open source and free to use, given that you follow the license. You can easily make your own modifications, do feature requests, and make some great music. Currently, there is a limited number of options to create music, but using tools designed for Sound-Source drivers, you can convert the files into AMPS format. More on that in <a href="#part9">part 11</a>.
	</p>
	<p>
		This documentation is very comprehensive and detailed, so rather than trying to read it all at once, it is recommended to focus on the most relevant parts to you at this moment. The documentation links to other parts of the documentation to help provide additional details and context for everything that is being discussed. It also contains links to external sites for their usefulness factor and embeds various tools to help with various aspects regarding AMPS. Although the documentation may seem daunting, it is broken down into reasonable chunks so you can focus on what you need to know at any time. Although I've done my best to make the documentation accurate, it is possible there are problems here and there. If you see something clearly wrong, please let us know.
	</p>
	<h3 id="part1_1" class="bd"><a class="bx" href="#part1_1">1.1 — Undefined Behaviour</a></h3>
	<p>
		This document will talk a lot about undefined behaviour. But what is undefined behaviour? Simply, undefined behaviour is things that you can do from a technical sense, and there is nothing stopping you, but it is not intended to be done and therefore the result can be whatever. It can change, or stay the same, depend on something, and change between versions. While it is possible to do, you really shouldn't. It is never guaranteed to work the way you expect, want, or desire. Furthermore, trying to support someone's preferences of things that weren't ever supposed to exist is not possible, and I won't waste my time trying. In the future, safe mode will be more careful about checking for undefined behaviour, but right now often that is not the case.
	</p>
	<h3 id="part1_2" class="bd"><a class="bx" href="#part1_2">1.2 — SMPS vs Sound-Source</a></h3>
	<p>
		Sound-Source is the original sound driver developed by Sega of Japan for Japenese Mega Drive games. Sonic games also use this sound driver, but until recently we barely knew anything about its origins. We had thought its name was SMPS, standing for Sample Music Playback System, but it has recently been shown to be false. Instead, its real name seems to be Sound-Source. The document has been updated with the new name in mind, but many older tools still use the SMPS name. For respect of the original authors, these names have been kept in-tact in this document as well.
	</p>
	<h1 id="part2" class="bd"><a class="bx" href="#part2">2 — AMPS Overview</a></h1>
	<p>
		AMPS is based on sound data files, perhaps erroneously referred to as tracker files. These files define each music and sound effect you may hear in a game or a program. They do not specify samples themselves, as those are handled by a different system. They are the backbone of AMPS and without them no sound would be generated. Tracker files tell AMPS what notes to play, how long to play them, and can also tell AMPS about other aspects of how hardware should act. For example, you can manipulate <a href="#part4_4">YM2612</a> registers or tell <a href="#part4_5">Dual PCM</a> how to play samples. Additionally, AMPS has a long list of built-in features that help the programmer to make cool effects without needing to have in-depth programming ability.
	</p>
	<p>
		AMPS includes a number of customizable flags, that allow the programmer to decide which features they are going to need for their project. The more flags are enabled, generally, the more system RAM and processor cycles are required to execute AMPS, though there are also exceptions. Here is a list of currently available flags:
	</p>
	<ul>
		<li><b>FEATURE_SAFE_PSGFREQ</b> — When enabled, the PSG frequency behaviour is made safer. When disabled, it is possible that a PSG frequency overflows and messes with other PSG channels. This behaviour, for whatever reason, is required to make the insta-shield sound effect from Sonic 3 & Knuckles work correctly.</li>
		<li><b>FEATURE_SFX_MASTERVOL</b> — When enabled, sound effect channels will be affected by <a href="#part6">master volume.</a></li>
		<li><b>FEATURE_MODULATION</b> — When enabled, <a href="#part5_1">software modulation</a> can be used. This allows he programmer to define a linear change for frequency over time, which can also go back and forth between rising and falling.</li>
		<li><b>FEATURE_PORTAMENTO</b> — When enabled, <a href="#part5_2">the portamento command</a> can be used. Portamento makes the notes smoothly change over specified number of frames.</li>
		<li><b>FEATURE_MODENV</b> — When enabled, <a href="#part5">modulation envelopes</a> can be used. Similarly to volume envelopes (also known as PSG instruments or PSG tones), they can be used to create more complex patterns for changing channel frequency. Every frame a value is read from a list specified by the modulation envelope ID, and that is used to calculate the frequency displacement.</li>
		<li><b>FEATURE_DACFMVOLENV</b> — When enabled, <a href="#part6_1">volume envelopes</a> can be used in DAC and FM channels along with PSG channels. They can be used to create more complex patterns for changing channel volume. Every frame a value is read from a list specified by the volume envelope ID, which is then used to calculate the volume displacement.</li>
		<li><b>FEATURE_UNDERWATER</b> — Allows <a href="#part6_2">underwater mode</a> to be enabled. This makes it so that the program can request underwater mode to be activated, and when it is, all FM voices will sound slightly muffled. This is intended to emulate how music would sound if it were played underwater. Although the effect is not perfect, it creates an additional "depth" to how your program will sound when implemented right.</li>
		<li><b>FEATURE_BACKUP</b> — When enabled, music can be <a href="#part4_2">"backed up"</a> so it can be later started from the same place. This is useful if you have a temporary music you want to play for a small moment, but don't want the previous music to start from the beginning again. In Sonic games this is commonly used for the 1-UP sound. The one big downside of this flag is that it requires nearly double the amount of RAM as the driver regularly needs.</li>
		<li><b>FEATURE_BACKUPNOSFX</b> — When enabled, this prevents sound effects from playing when a song is backed up.</li>
		<li><b>FEATURE_FM6</b> — When enabled, FM6 can be used as a music channel in addition to DAC1 and DAC2 as sample channels. Because FM6 and DAC cannot play at the same time, whenever <b>any</b> DAC is playing in any channel, FM6 is temporarily disabled. FM6 keeps playing as normal in the background, but no sound is output. This feature is useful when you want to use FM6 for any song, but still want to have access to DAC channels too.</li>
		<li><b>FEATURE_SOUNDTEST</b> — When enabled, additional channel flags are present that are updated with the latest frequency and volume sent to hardware. Also, few other differences exist to make integration with sound test engines easier.</li>
	</ul>
	<p>
		AMPS also uses additional data, such as volume and modulation envelope data, sample tables, and other miscellaneous include files. This data is all defined in the <b>code/Data.asm</b> file, which is the file you will be editing most. Additionally, <b>AMPS Includer.exe</b> is used to pre-process this file so it works correctly in both ASM68K and AS. There are also a number of customizable things, such as volume fades, frequency tables, and PCM volume filters.
	</p>

	<h1 id="part3" class="bd"><a class="bx" href="#part3">3 — Sound System</a></h1>
	<p>
		AMPS uses sound IDs to differentiate each sound. There can be at most 255 sounds (from $01 to $FF), and they are split into 3 main groups: Commands, music, and sound effects. All of these have different behaviors, for a very specific reason: sound effect channels override music channels, due to a lack of hardware channels. Effectively, sound effects have to correctly inform music that a channel is in use, and therefore has to be differentiated. By default, commands come first, then music, and finally sound effects. There is no specific reason for this, other than making the organization easier. Below is a list of sound commands:
	</p>
	<ul>
		<li><b>mus_Reset</b> — Resets various things about AMPS: the underwater mode, speed shoes mode, and any backed-up song status.</li>
		<li><b>mus_FadeOut</b> — Fades out the current song.</li>
		<li><b>mus_Stop</b> — Stops the current song and sound effects immediately. Also clears sound driver memory and mutes hardware.</li>
		<li><b>mus_ShoesOn</b> — Enables the speed shoes mode. This allows the speed shoes tempo to speed up music.</li>
		<li><b>mus_ShoesOff</b> — Disables the speed shoes mode. This disallows the speed shoes tempo to speed up music.</li>
		<li><b>mus_ToWater</b> — Enables <a href="#part6_2">underwater mode</a>.</li>
		<li><b>mus_OutWater</b> — Disables <a href="#part6_2">underwater mode</a>.</li>
		<li><b>mus_Pause</b> — Pauses the execution of AMPS and mutes hardware. AMPS will ignore everything except sound commands at this point.</li>
		<li><b>mus_Unpause</b> — Unpauses the execution of AMPS. Some notes will not play for a moment after the unpause, due to limitations with the hardware.</li>
		<li><b>mus_StopSFX</b> — Safely stops every sound effect. This will correctly release all hardware channels back to music.</li>
	</ul>
	<p>
		AMPS uses a sound queue for playing different sounds. The sound queue has 3 bytes and they can be used for any sound. <b>mQueue</b> is the equate name for this RAM space, and slots can be referred by <b>mQueue</b>, <b>mQueue+1</b> and <b>mQueue+2</b>. Only a single slot can be loaded per frame, and the earlier slots have priority over later slots. It is recommended that sound commands go to slot 0, music in slot 1 and sound effects in slot 2, though the programmer may choose to configure this differently depending on their needs. When there is no sound queued, the slots will be set to $00. This can be used to check if a slot already contains a queued sound.
	</p>

	<h3 id="part3_1" class="bd"><a class="bx" href="#part3_1">3.1 — Music Files</a></h3>
	<p>
		Music is mainly used as background music or as a jingle. Generally, whenever you want to make something that can be overridden by sound effects or be the main focus, music is a good choice. Music has access to all the features in AMPS and is generally more versatile than sound effects. Music is affected by the current tempo. There are 2 tempos: Speed shoes tempo and normal tempo. Normal tempo always affects music, while the speed shoes tempo is used to speed up music every so often (according to tempo value). There are 2 tempo modes, overflow and counter. Overflow tempo delays or speeds up music by a single frame each time the tempo accumulator overflows (becomes >$FF). Each frame, the tempo value is added to the accumulator. Counter tempo instead holds a counter value, and it is counted down each frame. When it becomes 0, a single frame of delay is added, or the sound driver is ran twice per frame. Then the counter value is also read back into the accumulator. You can change the tempo algorithm in <b>code/macro.asm</b>. You can see a visualization of the two methods in the below image (thanks to MarkeyJester!)
	</p>
	<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAACowAAAPoCAMAAADZPL5ZAAABDlBMVEUAAABLfM3///9+pur//f3SOjrZ5LxVAAAAK38AAFWq//9Vqv/U////qlWqVQDUfysAVap/KwArf9TZxp4rAAD//9R/1P8AACv0eHjU/9R/f9Tz8fEZGRkJCQmqqlUTExO65Lyqf38EBAT49vbq6OgfHx/8+voNDQ3u7e0nJyfAvr76+PhjYmLHxcVcW1sxMTHMysrd29u2tbUsLCzl4+OTkpI/Pz94d3epqKjU09OJiIg4ODjh39/Qzs7a2Nifnp5MS0tGRUVRUFCtrKyko6N9fHyxsLBWVVWamZn18/NxcHCCgYFqaWlVf9RUU1PUf1W6ubl/VX8rK3+qVVXU1P9VVap/qv+qqtTUqqp/K1XXi6JGAABgSElEQVR42uzYwYqBYRTH4bfpm3uY+pqmxkJRkohCkVi6/8uRWIhwbPQ6Pc/21H/965R3+Pk++yoAAPCQGAUAIA8xCgBAlBgFACAPMQoAQJQYBQAgDzEKAECUGAUAIA8xCgBAlBgFACAPMQoAQJQYBQAgDzEKAECUGAUAIA8xCgBAlBgFACAPMQoAQJQYBQAgDzEKAECUGAWoXHNU6RpAdcQoEPA3mPQWbb9dLGfT9W9BjAKIUeBdVqN+c6Gz2/+XD9eczMuVbns61JOPYhRITowCT8yHzY3xtlvuqffJeBujm3Jlej68tCNGD+zd227iMBSF4X2x3iJBkQIhAUqhnKFAgdIDdNT3f5wxU4sxSeOYaIo0sL674pJd++pXBCkREWOUiH7KSwvf8STHfxWj9YacCAeMUSKiIoxRIrqc8Al/1J42/SCMo/VHuyDX/qsYxbucuAdjlIioCGOUiC7nHQfJOJSjaLi7nhit+mJaMEaJiAoxRonoYn7hYOHLCX9yHTHaBDATw+jwImOUiMiOMUpElxJ5UJqxpH0m1xCjKwCJubne4UXGKBGRHWOUiC5lC6UWSFY0lRz/UYzKFMBYjhp1YCqMUSIiO8YoEV2AjjNl5fCL4+bS85bNcUNKiu+fp8lu3tsHjiXW2PemtWptOrnzyyfeHYBBePIB2Xu9ZBnnGKPZTbkfWWfWVdO6wzVjlIiuHmOUiHLNoLSlSPSMo+fInmo4yPwYf3jQkjtjMUWOHps4qg6D7wb0Z4uknrStMRoOABwHBlVgHoo5yj4OadZN2Y/MFPUA7eGeMUpEV44xSkS5BlDepMBmB4O3Oj9GNzUYPgpjNBzixLyTGRBM8MUaozIGMBXtA8De+BMLxyHNtin7kZnWHgyMUSK6coxRIsrTgVILxe6thRPVz3NjdIhT64IYrfSQ4vVTA9Y1OMVo7AHY6MvWgCQ2/sTCcUizbcp+ZIZ1FYxRIrohjFEiyrOH8ip2/SqU2ks/jvsvCZRq44wY1aqTVRQGoy0OlgUx+gqlPnmLKhV/M6lDmVZOrrivwy1GZfj3gwh3AGbGkhSOQ5ptU45HJv7XK8PHIAwexwvGKBFdO8YoEeV5gjIWq7ALpR3okPr66dwYrW/9k+eajiwX0I287Ij2WIPykspb1xiNWsd5U6DqG0vu40Szb8rtyKQHZXCct2aMEtGVY4wSUZ62biibeygPgWjBHMrbeTE6MGZ0ocxsMepXASwDORrVze/EQ1uOO7HLA5O2AHqirAA8mUvu40Szb8rtyEZQdh0+2omIbgZjlIjyzKH0HYL1MxWnzfNiNEjf9mzaSmwGoN4RwyuUlfkOJHvXp3d2oDfZBOoNc8l9nGj2Tbkd2QTKB58zSkS3gzFKRHk8KL7YNKDMM9/Ab5wVo2IY6QvmXqDiAdiK6RPKzHzHInJ/lHzz63odAK+pJddxotk35XRkQQvALmaMEtHtYIwSUZ4WlIrY3EEZimEI5a50jPaheJYSW2efwx9BaZrvqIhjjOoLtiLZAhilllzHiWbflMOR6dJ95n9gIqIbwhglImuMOnzH6S3zIdL30jHq48BSYjMogZgqUB5c2u3bwQsAQ78FtI2l8uPsm7IfmQ7TX4xRIrohjFEiyuMV32TsQulkHk7aLR2jlaIYbeJ7SbkY1S3ovQPYGEvlx9k3ZT8yPW/EGCWiG8IYJaI8AyiR2DxACTJ3AR9Kx6gUxegU36uXjtFwjuzjTUuNs2/K6ciWUHzGKBHdEMYoEVm/Kf8oNknm5mkMJfm5GK0hR+kYlTH++GUulR9n35T9yPS8mDFKRDeEMUpEeSZGorl/rBRK6+ditPrvYzT2oNQq5lK5cfZN2Y/MXGWMEtENYYwSUZ4xlO2Zd0YrP3dn1P5B1vIxKrPsP1UqNc6+Kacj20EJGaNEdEMYo/SbvXvbTRuIAig6D+cvsGXJNjY3u1xNEgIEcm1SVfn/r+nQIjKGMhlSLFVmr7fIUs7MPG0ZsIFjCtHi8P/6zuhANO+8MepFIo1g/5J9XEXfGR3zMT2AS0OMAjgmbIi2/tdf04fniVFz4uy8MaqWIpPyJedx7jHqdGQL0drEKIALQowCOOpBtM6nzxnNDx6auTRDyj9PjJoTp2eMUfsl93Gum7If2btoK2IUwAUhRgEcVchnt0Z/iPaiDC+i9covFP16jCaihQfvfMqqj1H7OMsCLZtyOLIb0V6JUQAXhBgFcFwm2m2gDnnzjxddxsoQm58z34o2+0qMmjVbmt+UjaLyGLWPsyzQsimHI8tFGxKjAC4IMQrguFkiWpaqfcVYjFztHbtx2dm/zxe4x6hZs6ahaH2/6hi1j7Ms0LIphyMLuiISeWonJEYB1BwxCsBiIhvXTVWSThIRo6TGntryxqLlpWcm9c2GPTFG30V7LAeybFyFyjTKKopR+zhzgc6bsh/Zu2gTtbuaEaMAao4YBWDhZ7LRevTVjvcYG+/SnIvW97aX/vwVqq2i9Gojb5nIiTH6JlrsKdOVbGRto3HvE6koRu3jzAU6b8p+ZHditmkvFmIUQM0RowBsgr78Fj/ko0D5zdX0vVvqo2+RaK23UeqPHluiRaO9N8knk1kQNtdXkcipMTqSjcGzF6azt8E2kOeykdz32mnofXtejkWrIEZt4ywLtGzK5cg6svFQBH77VY8mRgHUHTEKwCp9kr+6VVt5V0q6z+rDKpGSiXOMbg3FoP5ozqWsohi1jbMs0LIplyNrt8TUIUYB1BwxCuATvVgOzPNwd/1nJIbva2WaiiG+U6fGqDf+SwH6D7KvVVmM2sfpBbrHqNuRFebFCT9gAlB3xCiAz6TThZhaL4UyNZ9k56mpyvJYtqKbVJ0co6qZyY7amT0l8iEa5n5lMWofV16gdVPORzaay9Z1waOdANQeMQrAweh1mY0bSRTPr6YzdaA97SwajUFn2lYH0h/D2++NxbAXqK9ZvVy3uvof3KxLOZcv+4NGNx4Mb+58VS37OHOBNu5HFq7vF43WfLlSAFB/xCgAAABcEaMAAACoD2IUAAAArohRAAAA1AcxCgAAAFfEKAAAAOqDGAUAAIArYhQAAAD1QYwCAADAFTEKAADwi916SWkgiMIwWtxB0nnYphJb0ZEbcv/bsUFNNe0gRUEgFOcMLv/dwUc/xCgAALXEKAAA/RCjAADUEqMAAPRDjAIAUEuMAgDQDzEKAEAtMQoAQD/EKAAAtcQoAAD9EKMAANQSowAA9EOMAgBQS4wCANAPMQoAQC0xCgDAAxqOMV6f3T5iymWJUQAA7me3v3zFWL6nlA5TLkuMAgDQ6LyWVt5ex3QuMXrYbH869LrEKAAAjWIt/Vdi9Dc+T7HZliVGAQBoE3FZuhWjw/F5Pp8fUy5LjAIA0CbiZel2jI5peM+nKf8tMQoAQKtVfVbE6FygaU7QslKKBTEK8M3e3eWmDUQBGB3dB/9hsAdso/SpXVH3v5u6GOKqBaVxE6RK5zyMrmwW8MmaYQD4tBj99pLnB2Nep/QLMQoAwKfFaN2MeTlTv05iFACAbYo4plX1Voym3WlYztSvkxgFAGCbMqJON+c2ujditGqXvxhdJzEKAMBWRTT9eUnRaoq4V6IXRbmUZt1c5nUSowAAbFWOEdPuOJvaiC69lxgFAGC7fIqbsUtiFACAZxoO+6IYx+LU5SRGAQB4trLMuRxSEqMAAPy/xCgAAO9SV33fV2cxCgDA0x2bNiLaqRKjAAA82S5iLCKKaHsxCgDAU9UR+1xGlF3E+cFPmogxp5uqjTgN12GexCgAABs1UVwbsosp3bNcRP9ao30c1ltA55enQYwCALBNRHlZl+WeOTyXIl3TdF67tDiOWYwCALBNRHoco2t99rdb6Ku2m9fztL/FaFGKUQAAPj5G1/qsvn4Zc0rrN9Hdabi9tWcUAIB/jtH+UYweUvWS+yVGr7tHj5eDS3XjABMAAB8Qo3UVcXgQo3OLptcYTbuI+D5dI/Q8/Xwer8QoAAB/7xDHS4w2bRTpfox+e8m/H1Ra94zWzd6XUQAANtrvLw0Z475M99TNmK9n6ldV24lRAAA+Rtcdcnpgdxr+aM45TdcsFaM/2LuXHLWBKICipTcAA8Z/bHVGyf43GRNiDKRpJQ5xpNY5E2zEAq5eUVUAAPwrWX6c63Meljr0HgCAFez2EZvr0fhVRBzTWROj0t30AAAsNQzp74hRAACW6vt0r6rEKAAA64j45QsxCgDAE2IUAIDPQowCAPDfRFT3xCgAAGuJR2IUAIC1RGweiVEAANYRsX303qH3p/ruNYofnxeFGAUAYJGI9LHLtfSHa41meZFSFeXNNfViFACA18foXJtjkU6vbZfS0Lfd1KalZXoAAJZp298ZjKYqNtu5TecYPY9MxSgAAMt0XXpqHn1mX79M0dlEeVmmn1LVBiYAAF5v/o9o9lZXU4wOfZRZPg1Gm1MtRgEAmL08RscWTdVcnU3EMd0NRuNKjAIA8Cd2WTZ8GKPf3uqbEehu33ZDH8U0GHXOKAAAizX7PO+zc3VmTzYwnerrCU7T1qWhH18vYSpGAQBYqoqzfHzK8/SuQ9vNG5XGh5sYbaJwAxMAAItFtEV5iialIg5P1umPt0fbH6I8V+jxZ5iKUQAAFovoUqojHkLy8TrQzfb6g0OMynQZjLqbHgC+s3dvN2oDUQCGR+fBNr7iC6DkKekiKSIFpP9GwgTF1kqwykLEZqXvkxhs0cCvM4wN3C9iXfPyVmIUAAAxCgDAB9TFJEYBAHgnEbtLQ+7FKAAAz7X/FvU0ReTPIEYBAHim2BRJjAIA8EzzaijFKAAAT7WsUhKjAAD8b3Z1xGF8eR99yqo2ejEKAMDbVVV66XSjRbuUmq1Gq7ZPaR9D/mX+IUYBALhH276Mzv0xXdMU5e8iXe/nJaXTcV5Oxz5NYhQAgEf/33mqmjri5mA07aMotzi9xOj5WowCAHCfiNM2FG0jDnO6omqH8/Ll87pPP8Vw2aYXowAA3K2L42UoOtW5RIdxuR6jfao+jfs1Rk/HGKp2XsQoAAAPOESzuwxFi24t0Ssxem7RtMVoLtDo8vcao7ESowAA/J3xEHUeinZ9mW6q2q/nFk3TGqO7Op9dit5kFACAR4xzRHz/mV6zqw/jn2NLWT66lNeiFKMAADxi6edD1E11Src187I92ilfiVEAAP6NZRyKaI/T7R6t2m4djGZNDDlCO9v0AAA8ruznQ+7R3SuvAy3KrTSbOBsuB5myohSjAADcbRm7IqJu0j1MRgEAeFA5FBFiFACA91H2sxiFX+zdS27CMBRAUeuNnOAGAgmIjtr9b7JQS4UMKiFa04/OGdmwgaun2AYAfsokRgEA+MPEKAAANxOjAAD8G2IUAICbiVEAAH61ro+Yx8umGury9I8YBQCgkfos/WrRnPV50K5fm4wCANBQ7c5apBe5rJMYBQCgtZqhm8UL9OdBqRgFAKC1OgTNL8/zuAxUMQoAQHO5DCkfx811jG7Pm3qAaR7FKAAAreQy5OOYLjG6+ID0sI8hpfggRgEA+Ea5vB7HOgytlutcnkxGAQBopOvnsZ6pv/yym9L1RowCANDIajctr3baxrA432QyCgBAK7k8fT4YzWU3iVEAAJrp+qi3jEYsBqObOFm72gkAgPt1OR/SndwzCgDAV2z7Uvb5tMhZjAIA8FCbOCunVSliFACAh4rYDes5tikNsRKjAAA8UsSU0hjxvhSjAABv7N1LrtowGIBR6x8kvIJDEkDtqN1Ft1Gp3f9WCgQMA6iuQgvS1TkSkAcL+OTYMS9T6lGMAgDwAWIUAIBPo4lOjAIA8CYR87Eh24jHL73fblKx353OxxuxFqMAAEzU/ohF10UcP/lBizYpLa812kZz2Qp0fTyzNz0AABPFVZXuWlb1qUhLm+bLjX44DpP2gxgFAGCSvsj144HR1EZ1vt2NB2OlilEAAJ4wFOm+2Sofvr593W7OE0abdNZF9pgeAID/pMwMnX3ZtNcY7SKiOR1Gnq36QYwCADDN/taDGD20aLrE6HwRuSxi6mL8jUKMAgDwcbtb92P0+6FFU1ditLnMF50v+mG/i7WRUQAAnl9NX91fwLTdjPVZ5oyOy5j2u3E1fVWLUQAAJlmf5Sp+1+meZT+UAdExQ8eL84UYBQDg36ib6B6sYGouA6PltI314VrklLpoPKYHAOBpf9sOtKrLH667gy7jINsOFACAibpiGZGmEKMAAEwUxXabxSgAAK+Uz5r49TOJUQAA3mJdrVoxCgDAe9TmjAIA8Fpt0YlRAABeK270YhQAgFfqiyYPYhTgD3v3sqs2DAVQ1DqDBDDOi5faUfv/P1mgYBjAbW9aqCqtNQCbL9gycQ4A77St0mP1LffVYX/ZTxHRtGIUAIAXuYylz7caHaLUKfXn0fRiFACA2RZTznlapCdy056LtLZpn+4M0YtRAABmWuZ1nKynDw5G0xBNezsPvbNYFzEKAMBMq4hNKaWJyOmRxbo/fnz7uhsvD4yW5GQUAIC/Yojotsfvto9YPo7RLi2+jMMtRqeIKLfLTJ0YBQBgnqgnm32snsTosUXTNUaXq+jvLzGdF1GJUQAAfl/E3fJxjH4/tmiaaoyWeqvp1KKbrVc7AQDwqhhdrnZjrc/6zOjUtJdrTV56DwDAy2I05c22HojWDD39eG5RE5gAAJhtF9PtKtOT6/TlejBat0N0p1XTGgcKAMB8Y8RwOH4fhoj++TjQpq2lWaeD5vipE6MAAMxTIvZ5yvuIJn2ek1EAAP5E2cXZphWjAAC829iXTSndNolRAAD+gXOIilEAAP5rYhQAgE85VGIUAIC3Wk77SowCAPBOy1XciFEAAN5pFVH6q+e9uhvvd9f9YX9aiVEAAOaJ6NJHLmPp826s29qsQxQnowAAzBeRfiE37aVIa4zWlb/pf7Bzd7ltAlEARkf3AVAN4ccmUfOULqnq/vdSIsGYIrtNsRxL0TkPSHA38GnEHQAA7hejS4Z2UZTbBB2KUowCAHCDJob0V1XdTo+317HfxOjLc2OBCQCAm4zR/SNGn1L1ve/OMTrvL00xOkREI0YBANip+hkxdLMrMTq1aMoxOm/RP71XaTsvMUUmRgEA+Li6jrPLMfpjatE0jP0fH5tlp+lQlE5GAQDYpVi7vMA09rk5zx+Pp/mf0UGMAgCwU7mWLjkcT8tO/XqracnQaSxGAQC4k6pu8sFo/nQ8zYMuniwwAQBwD3l/viiX0uxi0ubB2NumBwBgp5e19J/cMwoAwC2e18QoAACfKVZGMQoAwGdqFxG/ejEKAMBDtPEtiVEAAB6jiYMYBQDgQSLEKAAAHyVGAQD4IqprMZrvts9v7+8uvQcA4FbdYqijuNKiTUqHsc+v7WYgRgEA2CfOxjJdcijKOTyXGN0MxCgAAPsUi2PTXz8YTV0UZY7R7UCMAgCwS7k4pcuqup0eb69jn2N0OxCjAPCbvTvKbROIAig6fZUACeKAgUTuV7P/TRYnjMEqkVq3OFF0zgdC8zZwNWIYYB9Vc0jVqWuXGJ3PL+WBGAUA4N9V1TsxOiVnumrO56c4rAex2IzR75ksBQBgW9Nsx+jLlJzpOHZXiw/bg3di9NtMjAIAsC1i+wDT2OWj86vFflgGYhQAgH1iNNX9kI/Or081rQZiFACAG1XHWcT0qH6fNw95/3NZ6odlIEYBALhR3cRas30daFHm0mxj8rgeiFEAAG7TRhT9m4h+kv6WGAUA4EYRfTm8iRgmYhQAgHuJGK5DUowCAHAvEUmMAgDwZ8QoAABfhhgFAODD9P3qVYwCAHBPw7B6FaMAAHwy53/bj11a1FGUKVVNRPSDGAUAYC/z7fP12F39J7/Ms34QowAA7KYuyrlIL3G6XEh/HDsxCgDAPnKGtlGUS5yuYtTd9AAA7KdqHqfHzx95C7SNw7lHL0PfjAIAsJuqOaTq1LVjt/qCtChfXx1gAgBgLzlGpxZNOUanDp0fZ89Pr8txIUYBAPivMfpy6vJJpXOa5iLNG6V2RuEXe3eTqzYMBWAU3QEEQhOcHyI6atfU/e+l5T1MgtJIFASqns4ZgbOBT7auDQC8ynbXp7E/m7hYb8QoAAAvV7bdTXTmMs0TTGIUAICXKfZ5ZOmqdOk9AADvsd1dTuUjpjHaxB+1t+kBAPhfiFEAAO4mRgEA+DLEKAAAdxOjAAB8GWIUAIC7DDNiFACANznOiFEAAN4ksqwXowAAvEl9FlF/iviVli+979P4IFNEtN3H8qdKjAIA8NxWZh27pRY9Pweaa3T2Cmi53ohRAACePFf/Fs1qJtfmuUgnmmubFvvaMT0AAI+JmP6cyRl6iJsN0Ob6r+yTGAUA4BUxmrc+ix/f+3SzNqaqASYAAB7URpm7cilGq1VxSoc+TeaZ2m48rxejAAA8qIsoi2EYtoddrBditDil1WFancOxT9ON0bgSowAA/IM6Yn88HncR/ebvMfrzlKZboGOEfqy6ZxQAgMdV6zjr27Rws1Of8kz9NEbzFU9iFACAJ2yquq6r1C18LtvuUp+zCaYmKi8wAQD8Zu+OctSEogAM35wmwIwgXBCNfWoX1JfufzG1jigTNekMow/N9z0gygb+HD1eHqiqm+vB6LA5vYhRAAAeZVqfL8qpNPs4aNNpMOpsegAAFnmpuq6rdukzxCgAAEv0r3VE1NtKjAIA8GSriLGIKKLuxCgAAE/1EtHkMqJsI3ZiFACAZ3qN4tSQbWzFKAAAzxRx3pOPEKMAADxTRBKjAAD8GzEKAMB/4xKjXcT9P70f8+VApogYNtP9+mMx+m0iSwEAOMfoSxWxvtOiTUqrMV8dB3q4/vpgjJqRAgAws47+2JCvdRTpplVRnor0oh9z2m3XqRejAAAs0DTHhoyxKe8PRlMXxfxx//ZOjAIAsFzbrnO6rarbw+XH9zG//0yMAgDwcFW9TtU+d2Oe7TMNGzEKAMBDTTFa7XM6xuhktx3zPEbjTIwCAPClMfpzn48rS+9/SGoyCgDAUt3c7QWmMb/t1ItRAAC+VsylW1bDZqrP+QaTGAUAYKniZIwYhjvf0zfXg9FhI0YBAFiqPMlj/N7cPw60KKfS7OOgTdPd30diFACAZXLU6TNMRgH+sHdvKw0DUQBFhxE0kPutRZ/0/3/S1Dq1eRBSZEwpaz0E2vmBzYEzA8DftbEUowAA7CRGMQoAwFZiFACAx3DsxCgAAPsoDzGOYhQAgD3EGMdJjAIAsIe6biZXOwEAcG9Ol97PfUiGdNH96f/TiRgFACCP72fpy0tzDkuIHg/LZzloTUYBAMiqPIdnHa50sRWjAABkljK0Wz9BX1S1GAUAILuiapfP+9vcm4wCAPDPiqoJxWvfXcfo8RCb7wWmuRejAAAkGWJ0adGwitEh1qssjRfbY/QpkaUAAPweox9Li4ZhdbnTOP0c1zdMRs1IAQC4bYFp7tNO/Ze0zJSOx0mMAgCQSTlOaad+3aJpv8lkFACAXIqqPg9G0891i46TGAUAIIv0HOjzSyrNMp41oYuLNgQxCgDAXRCjAABsJkYBAHgYYhQAgM3E6Cc7d5ebNhAFYHR0W9nY/BhjA2rz0ipV1M30pftfTI2I3ZjQFCPRRM05D4MNLODT2HcAAHgLikKMAgDwSspSjAIA8EoixCgAAJf6X2L0Q0+WAgC8WxEvHHq/rdNgtojV8EOspsSoPVIAAJ6YDyK6ZTM706LL7m/berhtfsTqGKXdxzoqMQoAwHXixGLzLFez/LFID/a7VdocY3TetIf7phWjAABcZTmI6JYsojizMZrWkeWp18dolk+N0Y9iFACAwWlH5k2UaWS2qLrly+dtfRqjm6imPqZ/EKMAAPx5gKmNOI3RVZp9qtfPY3S/i2q2aFoxCgDA1cYdeSZGuxZNJzHaX8QydWLwlxi9F6MAAEyK0a9di6bN8xgtyqbd72I1YWf0TowCADAhRotyW/fTSqMY3e+O0/RZfnmMfnf8PQAA51RVOsiyNDZv2n6mfhSjRXlFjDrkCQCAF+R5GpstlsPG6Phop6gO18sJj+m/iVEAACYpyogs70tzE53jF/PoVEmMAgDwJohRAAAut34qXcc7owAAXCWeEqMAAPxL2aNtRNPcPEbvxCgAAL/lj+pt/GxvHqP3YhQAgDPqWNx+gOlBjALAL/buLldNKArA6MlOoyiI/Klpn9pZdBKd/3QKGqhNsVVveiO5ayUSQAfwZR+OAHP2kb9OjHoXEwDAB/MOG5g+TWdhRgoAwB0xutlGHOo0yYoo06CJiNX6kRgNMQoAwIxTNR+jl9fS54d6umx/XGK0Wa3Pr6YXowAAvE1+jGjnv1mtL0V6djqWqYkyjarYi1EAAN4mItru5mA0Vdfr8dcxmhW752LUViYAAEa7XdmlOVmx7w9fvxzqNHp+MmpGCgDAI7KiTNnnupqP0dMxSjEKAMD/McRo36LpRow2seuPMRGjAAA8YpNlp7/G6Le+RVMzG6NNtN0jf+3k6VEAAK4126I4ZkN1ZvOtuj1naD6zgWnc1nR/jJqRAgBwpYpB0Z8VRZqVt924p/4qRqcWFaMAADwroi33h2hSKiO/sU6/Gwejv8doVvQ3xSgAAE+L6FKqI/7xOtDVevxBE4PhRh4X5f0x6ulRAAD+qMcxRp9zf4yakQIAIEYBAHgFu2iWHKMW7AEAFi1ic2nIapExakYKALBg1ffYNk3E8NmLUQAA3lP8skpLjlEL9gAAy9NO9utlx6gZKQDA4nSTlMQoAACvZrONONRzl6fjcPpqMWrBnp/s3U1u2lAUgNGnO7BJjPFPYlA7apdUqd3/VooixzVgBukAnuGcAbp3B59u8gAAWIvD3JUWrVOqhu5ybaPO8TLqRgoAsBb7ubSkKsoxQU/X40eT5Z/p3UgBANYi/imKq4fR1EZRnq99UeYeo26kAABZ242aIv6UacFm2xw/fnwfurP1sK/zfMDkRgoAsDplHf1yjO7S5lvXDt3J+hGjfUTU64hRWQoAkLeIKzF6jM80xei0vrxGMz5iiskKYlSWAgBko59U12L05zE+Uz90Z+v4pqkqynVdRmUpAEA2YjIMzfIDpqGbmnO+jv8z2j9CjF5mqUAFALiBZlTH719pUfX2Pj6iP13HDD3ujxSj7qYAAPewK7ZtWrLZ1tNhdLaOUxu7lT1gcjcFAMhQGXH950A/WjRito7T0K3tNb27KQBANtpJH5G+aEXfM+puCgCQoZh5E6MCFQDglt4mdfMuRm8aqFIVAHh675PjIkYzmD6JVgAAMZrtdBmoQhYAWKOXTdu2m4MYfZ7p09IkcwGAm+pftxGx3W/EqCnfzJXIAPCgqoihiChi24pR02NOd8/h+08JADL1ElF3ZUTZRBzSoum77efbNIlRk2kF091z+DmmBMCXvUYxNmQT+ystWqdUDd3p9jn5BSaTyWQS/WIe+G8R5cfn+LGgKsqxPE+2aRKjJpPJZBLzd58Sf9m5m902gSgMw0dnAfMHDKQGpavm/m+yNiZikOKklRP5YN53UX3zdFHJWfioi9BOU5VPj9Hl3Mxa1dvXujhGWSwWi8V6+Hr4ObzvJfSovj5GXepE3J/fp377KrxIix8rxyiLxWKxWKydrIefw/te33OM5lvHaCvutc+nfvsqvEjXHyvHKIvFYrFYLNYh1ncco96ptjeOUffaSz7121fpSkRERESHTe6o1WE+RkPSSj7KpbfXXmQ49dvXxpc4S4mIiIiOl9xT01xvyFNTy0f5MJ+bsaq3r61vU8UwDMMwDMOOZPfVdW0vN4ovv0R8aLavYtn5EDAMwzAMw7A9HqOf5dLyS0U3r3VxjGIYhmEYhh3efjAfVKt6+XeXV+EcoxiGYRiGYYc3U1n6YDAMwzAMwzCOUQzDMAzDMOyJzVSWPhgMwzAMwzCMYxTDMAzDMAx7YjOVpQ8GwzAMwzAM4xjFMAzDMAzDntiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIDtLgbJv1Ju+nybARERF9mXfnvF27Ntm06GRpMGnrEmfRzmmKfh4WLcslP2fRxA1jCOM4nMWkrXmb5idZsmlz3nmbFvP7w6btIO+c85NR80UWzRVh/2xG/8/FxZDOhehN2iBLo03TlJdVDSZt/e5NFu3CbRXyZVg0lUthzqL5VDWNNk0Vsli0omDSYhi9TEOMTixaXv4ihWzSKg3vN6BJi0UWTaYhXL7yxixi0UKRRUtF2H+YxXx6Ob21bddUwVs0laU2iEmrNMtcrSZt/e41afOuG41exKLp9c/unFq00NQi3SB1p5NF+8uunaS4EURBAA3+Iuehcsa98oWM738bd6WyJTCNN70JTMfi8+tpIxJUComqr7MURvPSmsMU1YJlNNkvjJyjGEbTKcs4HZDRRN2RPRgNU1p8jxIPRpP8jFBaurMnpeU7sielUcXFXn4YADo6RnudWjOUppXUs1LaY9La2fcfkozGdFb/tjgpzVX7sVJa7r1VybonR2l7FAApMNqW3HYHZDTRd2QPRvMj9UeRlovRBM8Ir7Hdi192iNtYIgAeDRBCafUjvwKl4W6AC8ASSrP70gCW0gDsXUfxjCbmeZxCaUQ33s8stV0Bae1eumRes/uK1h57Lykqx2hMn4VPreAkcRpd8fwuo/91GT0NUCjtFU4DdJN5mWsqRsvOWDtbqNU1RvPei98RYbQcjDVz3CuljQvAJbSGntpw1bKanN9HrBbdvqK1j91eb5R23u4CQGxMxe4vMzixnEZUPL/L6BejvAVQfl7WD0aT9AqlAehRJIjSjIYWnBs9q9E6o+2HqE4Y7X7PQcq9DUYr4quXSGsAeonDeQNhNKlrzRiutS5Kw/Bm/a5Y1jdKA2TZyztRkdFaXVh1TGP8YDSq4vmJpWCwY11kNKbi+V1GvxitnK/X9SZuFEYTvMJrKcesKQ09x1gAXTql7YeoThgNPbeY9lYoLTWlIrHtlDiCF0bLMqeg3TMxGooKc4qfTnVKW0amGy0mDUbrY/opRYUwCqMpixOrGA0t3N/J1bsBRot75r0y2iFuo4mOarxHxUJpCs9Q2h/2zmBFYRiKoqGLvi5sQpo4S///Myc4AzeLXgtC8EXuXckh4qFFUCic6JxNME+384xV36yauWZ/y2ldXLJ9XWOoqZQUXLJgaS+l7MlcsuPndi/p+e/SJQu5GccmnrJLZo/wv4d5ZKHu69J2Lzm4ZNpXzXKbOWV4fcmOjZwbyPjmq/t8ys+uGR4ZcnyLdX9fziJh8APDhjOz0FYrCGHLRs6NZU8AwtmxgWGDGX79XbJjI+fGMBg7Z96/vxbbcnXLvF+/b/EbuOvqEanTkPwfqYigjEHKE/KTn/zkJ78p/XKFH9jZOfiBwQ8MHwmG94HBD2y+6yc/+Y30m6vNjOoRyUqSOg3L/6EiQsoYvPawdZOf/OQnP/nJT37yk9/7ftPkQPvqEclK0jpNn/8jFZGTMgavPdy6yU9+8pOf/OQnP/nJ732/aXKgp9UjZCVJKYfn//qKCClj0NpDn9OSn/zkJz/5yU9+v+zdIQ7DMBBEUamk979xpaAhIzeRwbp9HwQ/LTLK8PFt9c38tVOsHpVZybJOUycBc0WkL2P0tYfX9eHj4+Pj4+Pj49vmm/uf0Vg9KrOSZZ2mHT9WRPoyxnrai4+Pj4+Pj4+P77HvnMdorh6VWcmyTpPzf2XRpC5jrI/Fx8fHx8fHx8f3ne/ox2hZPYpZybJOU+b/ckWkLGPUtYc8Fh8fHx8fHx8f33PfMY/RWD0qs5JlnabM/8WKSFnG6GsPOafFx8fHx8fHx8e3zTd4DjRWjxazku/FFGFdEbkuxcfHx8fHx8fHN8X3X02/FB/fjfiGxcd3I75h8f22T5IkSZIkSZIkSZIkSZIkSfqwc0e7acNQAIYrX2y0QEjSpn2WvcYmbXv/J1ljDsRYWJqERFP1+24KNifx5a+0BQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgJts06XDw308PqWse7hZn55fHgAA+ITuH6ORouH2kNzsxCgAwCf1ITHapyRGAQAIj0/3DLrNbonQrRgFAPjq7hqjb68pTcPyXowCAHxtOUarxCt/aT++b88r3fwyffs+r/Xx9t3+PBYL7TzMg3kytAb75bLblLrljtvjHePYFw716U+2+cxxVgAA1qWI0aryulOM/pz7bhrGKMachodj9EWeRi+GffvBaLV5ZbAdo8sdGzFanz6uMA19Ok8CALAmZYxWkddFjP5Os195ZxqOafh3l0JMj2mxb94rLrqoB9sx+mP5VCtG69NHjP5JM89GAQDWp4rRbe7NvHxcH3OBxj8ejcfq689lN56qb7OLwc0ulq7oq4eTjcE6Rss7vr3GNYq/GW2ePpaiVce8CQDAikSM1rmYq68752Y0YF/EaHdqvX38fH6JwfPLWl/tNAZbMdrFeaehitHG6eMKcdVYAwBgRSJGq/hbknCcWy6H3CHXX8ToNBQ9WCdiJGEtrlW4MtiO0a5cKm/ePH2sHU7bYhQAYGUuYvTtNTpy2RhT6mKjjNH9+VN5Y1lpPIFsxOjVwTpG66U6RpunV6AAACuXq614U4gYnYbcec8vVYxGAOb98eLblP47RuvBW2K0Pr0Y/cfeHawmDERhGAW3WRh8m77/i5UOP4levGWgtCTpOauoc2WWH9EkAADH9wsxOk6mTl3AVAfFKADA//KXZ0bHzfOdGQUAoIvReuqyj9H+P6NjpMjiLIs3gz+K0efdu2oJAOD4ytX06cjpGH2Mw/0K+nIc9T6g0QzmDlDjaD5Gs3sxCgBwIonRconRbIzmh/f9QZ/7YZXlJVTr4Eugrrc2Rut9ofbdi1EAgPNIjO6vtnhbRhE2Mfr12ai/TK+3vJfebCxPD+VcxmQd3J6flMVdjCZf82K5v9m9GAUAOLqnGE31bb6J0c34NNEXXf0lHyMZWwbrd330MZoYjnt2vxOjAADHlxjdrPMxmjWxlDxtPEqM1sHsKW+sfYy+zt6zezEKAHAmW4zWHE3D9TGa4IuxJmPRWLf07AeXBGYfo/v2M1t37z+jAADXNNIQAAAmiFEAAK5DjAIAMEuMAgBwHWIUAIBZYhQAgOsQowAAAAAAAAAAAAAAAAAAAAAA8MluHbMgCIQBGHa4f3G4RVK2OEhQglTUFNH//zUhGJI0RGBaPc923/DdcdMLAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMBz2flUxDwW17I5hUby3UJjotsAACYs3ZfLKs5jtSwvafIRq1m4+5X0EqMAAG9Y1DF0Yr1IhncMYZQYba/c9udZ+wXTyUcxCgD8haych0f5Jk0GtgvjxuihP193b3l9jxiFG3t3tpQ4EIUBuC/OWyRUqhKSsAkSFtlEER1lKcv3f5rJwY6nO2YmPYtaJf93RdMoOXd/nV4AAAD4R+05vTeP1cdaU251jBuN5WH4BWE0aStLOEYYBQAAAPh87SaxKOsN/NAf9LKI2LitPog0RlfBF0Qv0p6UpU8IowAAAACfLhgSe4klnb4QGwbqA00o11NfGEYjX5muEUYBAAAAPt+W2L5i++RWfaALyvlfFkY7RLRQhim/iTAKAAAA8LluiV1VHua5VR9nTESe+rIwymW3UiUyfhNhFAAAAODTyOr0D1WWUe5afZwdEa2+LoyquR3B2wnRXCGMAgAAAHyqDeW8WJXFHk9s1J9o77N5M2rOZz3fLWita6NX+6qz9rx156r9v8Noj4jGoSo8EVFfT9WU5RRG0/523tqtsn2ghFNRg8Vl/m2Xkw3CKAAAAHx/M8otfnXAaCbbO+9VyQ3lLmS87NCbaFJ5TH60uG4lrQv9jrA/JuItvdnG8v6wtIfgSERZKWAPa8JoODYPUAUR0SqUR6gti0RFDenBI63F31FXlIgzKgz7CKMAAADwzTV2lBuo9wY8sQvfLj3aBcqSnv7yUWnhhCyrwbswGsz0nGsYvduRwbu12ph0UG84L0aBveH1qSaMnj41V9qBiPalR6guyyWM3jXJcFB1RYmNRwaEUQAAAPjmNr/eGjrnqalcB79XliOZ69yNjEq8USn9bZr0Z2H0sUuW6FlpzzzsqIKf8Lhn3w/wXBdGU859d/rxm3ycqfwI1WXVh9EJ2TY1RYlNRAijAAAAcEZ+00R8klP2B345rzj49KC0HzxKZo9xo+HfzRIezRtW+tsn9GdhdBTxuPkwStPRQ4tfR209FSTWUfwjsUwVVvwsQe2xoIlsM+gR0cKY+m1ZdWGURbPbOAym98TWLkUx//WdyTIIg+XVNcIoAAAAfHcz6SmWHWXTqB/pLqkYkLk0vufReqC0ZdNKqlTyPnpWvBNe8vBCf4P/OlLaaTSQVXrWLR4m4NFl/Rn1uPtW1Jwo8o0p97KUkFKTe9/KydP6ouQKg/FAaRuEUQAAAPjmLii3VFWWRlK6l2Bq9k1vlJKwug5kdpqYa/ikra8GqWIuYbRv/whUsDK3qC54cCymunTSM29OXdSFUV1VVvzFjTXlXFbV/x5PFZPYvKgvik15tBvgaicAAAA4GyvKxapKm+Qm0KXZB2UNj3IDIxsmPLDXt2+tMNraK+YaRi9k46fkuI4Z2+6N7iN/+kWPH2oupSL21t0dvbZWk7Y15VxW1f8OVKm52qktStrUB9wzCgAAAOfDk/BUFvCUZzb4rmSyp9umkkzvlenZbAgSu46VexiVKCzGlGurk3BnbMV8Ieq2u7xOL4kxarhcJd/h534NpT+sKfeyVE1VU11HbVG6w7tLEUYBAADgfHQpF6oqDZ7qWuvL1vK+rC9vin6hiM2WH7GGcg2jknYnyjAxl+IzCdGc4TKVyeRYvromjG64wvi0XD+1ptzLqqtqRDmvrihJulv8AhMAAACckd+E0dAMo2HTWvseWfc6LSQZWkl2WJGpXMPojU67om8e/N9LUOxxnONZvU7vSxO3GjG5EmDid4ku7Cn3suqq8onVFSXB9IgwCgAAAGfEaZmeHay23cQ6Vt6haq2/D6NyXt4+v39pDhZFkzRKVRoV6/S3PLV0C6N9LvFJ7hsl5lCWexhtEKsrSr5vijAKAAAAZ2T86wNMsbXBkduH1PWlT2qcZ5pTteQfwujwXUr2rZ0CzWK9nFNopneKHovY3FJuYTRc0cm6NOVelltVTkWt+bWPMAoAAABn5NLpaic2M5qhj/peJwmG1f4hjLbe7TNNdVdSLpvyQr1K39dNzk6xnXTrEkbZFZ0cS1PuZblVVVeUfF+KMAoAAABnxO3Se7Y0GqUv9nJz9AFhtCsDc75rHXAaFKv0+rfyE19nuqNrGE09HjQbpSn3styqqi1KZhFGAQAA4Iw8OPwcqHb5dmYoTuzz6p40/Gz/tTPasDqjsW5oplFxLdOW39ATbacwyhaVP6rkXpZbVU5F7fh1iDAKAAAAZ+Qne3ezmzYQRQH4Ls5b2BaSwQZjfgoGVEhoCBAooap4/6fpTJwm/lN0pUk28fl2YUKiszvyzFw/wthKky2MVWW06EmMTWV0+wyGL3VfeGZUfgE45rvzE7HOeUPeA7gXdRn1u4DXKS05xHI6M7rgNj0RERG1TXCBkUndFIYXFn61ByCORMIFgPtQcfD0q27TW8u8xZ3e5sQHHhD7sgHwoC+j8gAsa0v6WLpUqlC/YCQso0RERNQmBxhLqVvCOErBBsZVZF8d5PmQf1DnOmd0IgUTlGrmHobf7wKHwvnXP3KrfK8OlmJJFUuXShXqBuORZZSIiIjaZAfDi6Qq8mrVyE/zSfcnAJeOVN8N+rll9E/tMOvv8l2rfgpgfwZwLtTToQwA+E5lVBsrhhGqUqlCbWA8s4wSERFRq6xhzKVqDmPbcPV+76fVRhXBWn1qGc1g9KSgV9nFHgPYHIBLIPK+T78CsBanMqqN5cHoqFKpQk1gzFlGiYiIqFX2sJ6abtljJyUrGPOXpazeXH8En1lGZQxj9MHj16v9n5fi9KkjAPu1pVsZ1ca6h3GnSqUK1UkBdH15E7KMEhER0fd3gvXU0EUPTRfs4/zdRyV3sH6GUpSNncroCMbCl1f+AsakUo3L1/p3yO3cyqg21g3GkyqVLtQNpSbtj1lGiYiI6PvrzGANE/kvGcKa9aVihFf7ptn5GCeFqniI4VRGwy2MH7688POfQnkXerC84P2TAay071ZGtbGuMHq+JpUu1A7FbjrqgWWUiIiIWiDpwUpvo6kfdqajeQprkUhV0MOL+9rCFlZ8GCX90J+eHxYA3MqoTLswBtesH2RPAxjdrOGR7s/qtX6Mxa2MamNlsGZnP+zfXWcfplKGGsI6rjpB8rwFWEaJiIioFZI16taR1G2A5nlH0RZl7mVUJilK0rOUPNce0j7CujqWUW0smaPgw1TKUMkARUOWUSIiImqF/jJGWbwMpEGUIp/rVBMcUTVwLKPyt4uCy17KstIuvRX2YKwcy6g2lvgLbRnVhloVF5e8wERERERtkR0veNc9Zh/NyP8tTe5OcfFPzCeBaxmV6IQ3p0iqFgCOtffpe6FjGdXFsqKxsoyqQ2VbvFqvONqJ/rE/NykIQmEAAN89PtpE5R9JiiEJadoi73+i7hBv18wNBgD+SPG510NcYrjubZF+cm6XWxfNqeun1yFlUY31HNHVY5UyyN9a90fZxNxPW6bUcXvPUT6XNQEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPBlt95xEASDKIxOpgAVJYJBV+X+t2PhY8xvJaE8p7p3Bx8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8IfdMcfP2R8yl+lrAQDA5qo+L/cc650ihmV6LzUKAMBqcysat+sYc8Xo0PXPDq0FAADrZCt+VYy+4vOcXV8rAODB3h0lqQmEURT+c62CBlFooLGcp8mKsv/dJIrYPmgwhrEYON+DdUtdwCm0AQBeIjW3xmLUFaWZ+/wIflj8Tg8AAIBXSe2t8Rjdmzv6KvhhEaMAAAB4lWS3nohRd/RWBR+XmW4YAAAA8FUx+vPozerg47IbxCgAAMA6bAZ6Y4xmefD9mfq4iFEAAIC1iAm6+XEh+w+JaovcWIzatmn7M/VxEaMAAABrERN0mhhNpcwGh0LlSIy6or/FaFzEKAAAwMJtBpo6Ri1RXh36FHWddK9Ez5K0L80sP++4iFEAAIBFupOg08doGqRuW//RFVJp/4oYBQAAWJKRBJ06Rs03GoTSiFEAAIAVGknQ6WM0ave7JAkhaUpvxCgAAMAaxbR8X4xGaep92poRowAAACsycj30uTWn/iNGAQAA5m4kQd8do5mrqsodiFEAAIAFu5Ogs4jROi8kFZ0jRgEAAJbmToLOK0a3UkikREVFjAIAACzMNRlnGqOZtPOplJbS4cFXcil4G7hCatp+nBYxCgAAMDObgeYeo7mSS0OW6uye/kH01xqttL95CmiWNy0xCgAAMAd3EnT2MSql59dHIdmHZ1+kZsPI8tJ6dfDEKAAAwPOWkqBTxag9jtFYn9XwFHpXlGZ26HbWq5OUGAUAABizvAT9+hiN9ek+P4I3i9dEt007fMp/RgEAAJ7w/Q4mvTdGq0cxujd39FXwdrY9jVpNewpTDjABAAD8zYKvh04bo5mT9g9i1B29XWPUtpJ+dZcIPXSn93VFjOI3e3e3nCYUBWB0z7lQmoKAPzD2qnn/l2x1JKcySSczQaKy1o3gE3yzYR8AgIglJOg0MbpJ23OMvpRpFe/H6OuxHS8q9V2VXyk1GQUAiFhagk4To1FV54ZMh2r9wclOh/ayU58VZS1GAQAilpug+Sq+rK43bbxj2FUaN2dO06KsxSgAwDMuJk0QoxMoyirXZx6WOvQeAGDJ89C5YvS8NL9aD6XZpJSqONmmv2rfpgcAWGKCThOjfR9fI0YBAJaYoNPEaNfFtaYRowAAEnS2c0bHf4hRAIAIi0liFADgoT3zPFSMAgDcpWUk6FQx2lwTowAAEnS2GB0TowAAEnS+GF2NiVEAAItJc8Xoeuy9Q+8P7dVt2lx+TzZiFABYGPPQWy0wjV0+S//zrUaLchPRpPqfz9SLUQBgESTorDGaa/NcpMPtbh/Rd7v90Ka1x/QAwDOToLeM0d3uM4PRaNJqnds0x+hpZCpGAYDnI0HnidH9Pj6UR5/F719DdG5TnR/Tn1LVAhMA8IS+P/Ee5ypuI78jWhzbZojRvkt1UQ6D0e2hFaMAwNMwD73HGC2ObTS5OrcpVXE1GE1vxCgA8Hgk6HfG6I+i6P8bo6/H9jwCHfpzt++7tBkGo84ZBQAekwS9ixjdvpRlV0REUXywwHRo8wlOl9WlvlutL2EqRgGAP+zdXW6bQBSG4U/ngr8ZGBjAKL1qd9Euogvo/jdSj0hAkWxfQCRD/D5Soi9yFvDqOMRnQoIeK0ZbS7wk73WT64fl/fg01hhVtIZPYAIAAKfy/HT7fks7mPVNGC1KjTndUvh6PYxKzoIUrX4PU2IUAACcAPfQ48boIHVmD0KyrMyyfPkFZ1dB82GUz6YHAADHRYKeIUbn7xtDkhgFAABHQ4ISowAAAI+RoN9oaYfaIjEKAADO7/lJ9rprZz6Wc0O2xCgAADgb7qFHWNqh/W1VjGbpKxCjAADgDEjQYy3tYKtMxCgAADguEvSoSzv0i5ATowAA4HBI0OMv7TAsJGIUAAAczvNTi7UrRvcrK7Ox+/yzNUoKbw0xCgAArriHvu7SNkWhz6Y7LVpLbq3RwjdSayG90v8lRgEAAAn64kvbeP85OtuLbnFZPhfpO9cP0nTph+nSKBKjAACABH3x9QV/3zkVrjK7exhVa1m+xukco5KIUQAAQIK+/Noco9N6FPVmY68bCh+k4uePsdMsWpjfpidGAQAADyaxNsdobZf5KBqrVKKhG27HaKPirWuXGJ0uFgrfD8QoAADgHsraHqMazZXzUTSr5xK9HaPXFtUao1I0qyWtMWoLYhQAAJCgr7a0UTdalY6idZPrrsL/euukuMRoWaVnl6zhMgoAAEhQ1o4YVdeb2Z9/eqSsxu7jsaUkPbqUvmc5MQoAAEhQ1o4Y1dD0o1WumHSf64f1XzulRYwCAAAeTGJ90ceBdiEzf4n3e7Tw9XIYTZwFKVrN2/QAAIB7KOu6tE/e9GPq0fLBx4Fm+Vqazq6CpJhGeo0YBfCfvXtJThuIwjB6qwdOS4hHA7KLjJL9bzIhSgKqSmxsrEKPc0Y/XsFX10gAyyRBrfOKex3L+imlehUf4TIKAAsjQa3+ik/wZfuUkhgFACSo9YAY7f5bL0YBAA8mWY+I0bOjGAUA3EOtd64x9Z8YBYA5kKCWGAUA3iBBrXGsGA8xCgBTI0EtMQoA3M6DSdbIVgyrqlNqy+VDZ/N7tkWMAsD0uIdaU4nRql5HrHrN2f08aFVvXUYBYFIkqDW9GD13Z1ekF7nZhhgFgImQoNaEY7TL0F3vF+jPh1IxCgDjJkGtWcToryNo/va1Lf1AFaMAMG6PTxRrKSuGlJtN5FPZXcfovi1/nmVqixgFgBFxD7XmF6P5VOISo70vkL48p01E+kuMAsCNJKg1mxVDys33U+mOoZ3+zs3aZRQAbiRBrVmuGFJVt6V7pv7yl8Mxrj+IUQB4jQS1Zr5iUKvDsf9qp33a9J5vchkFgDd4MMma9YpB5Wb9/8Nobg5HMQoA/+Ieai1lxbCqOnVvGU2pdxjdpZ+2Xu0EAFckqLXAFXepcn6JD/KeUQCIkKDWwlfcY183zXOOiJzFKADcToJa1g/27i4pbTAMw/A770FAyR/hb+xRu4tuozPt/rdSJRhxCnZaUCRc14z6IAvwno/EnCFG23xSRkRZilEA+CduTLKsU2M0c1E3q+wi6pyJUQD4G+ehlnXeGF1GzDO3U4wCwEES1LLeWKfXoxgFgD9JUMsSowBw7SSoNfYVJ6iyE6MA8Iobkyzrw2I0Mu/6hmwzj//T+9U8Bpv19nX/RtZiFACch1o3veIE7fe877rMp6/mSItWEbOXGm2z6se0rJ9eeTY9AEhQ66ZXnCBfFHHQrJhsi3Ro0+b5jcUyYrNeLMUoADdOglq3veIEi0EzOX4wGm0Wu7e7fvSVKkYBuGES1LJOj9HlIA6bls3jt69fVvPdBaNV7HTZ+JgegBt2+QSwrM+x4j1NyzqmD/P2JUa7zKy2M5tpuViKUQBuifNQyzpnjG72HYnRxxaN5xi9u89muImpy/5nDsQoAOMkQS3rfWJ0ve9wjH57mEd0Q4xWu+tFH+diuVln7WQUgLGSoJb1kXfTF4dvYFrN+/rcv2a0KyabdX83fTERowCMigS1rI+L0XqnKfLXJA6ZLZbDgWifof0v7+7FKACjdPk/7ZZ1XSvOYVJld+QOpqo/GN172WYdMcsmosvKx/QAjIHzUMu68N30bz0OdNuima+fDjrLR43HgQJwxSSoZV02RrvB7D9DUowCcHUkqGV9lhjNwWrViFEAxkyCWtbni9Fmp8qfP0KMAjBml/+TbVnjXHEOdVG2YhSA8XEeallXEaMxcc0oAL/Zu7fdtIEoDKNb+4KTGWwMAaVX7fu/ZBucDkiFqMhNGuK1rr7kBfJryDBfhwmq1GOM0a7qjVEAHp0JqtSjjdG8sDNGAXhEJqhSjztGd1Vp98YoAI/o//8pVmraFSPsq7iufst9dTy8/txn5mxujALwd5yHKvVFK97T8Cx9c16jXZb6Sv3paXpjFIA3mKBKffmKcRZ90zT9Im5oZvPTIq3btI0LXbbGKAB/MEGVmlDFGMtmnS/W/RsHo9HVz+P7U1SLdTFGARiYoEpNs2KMVeaulDLLbOKaxbqNWHz/9vo5/fFQwskoADe5mKTU9CpG6DI3+4iYt5nL62N0E4vnbXceo31mlvNlpo0xCoDzUKWmXDFC1pPNNlc3xuivLRq/x+hyle3lJaZTZGWMAmCCKjW1GjdGL/L6GP3xvI3o6xgt9VZTRJ+7va92AsAEVWrS9a5jdLl62tb1Wf9ntJ/NX681+dJ7AExQpaZd7zpGo9nt64HoMEOHXw5b1AtMALiYpNTEK0Z4yv58lenGdfoyHIxe/Njl5qVmc8+BAuA8VKmpV4ywzeyOEXHsMtvbz4HO5nVp1tdBmxxsjFEATFClJlwxRsk8NH1zyJzF/ZyMAmCCKjX1ilHKU57s5sYoACaoUuruinG2bdmVstmHMQqAi0lKqbsrRjsNUWMUAOehSqm76zPtP2MUYCpMUKXUPxqjx8oYBcAEVUp96Bhd9ofKGAXABFVKfeQYXa7yzBjlJ3v3lps2EIBhdDQPBgWML2BQ+tQuqer+91JobcdFkBRB8Ng556H6DAvg1zQDAC4mKaWeOUZfYsyLzvW92lTDp+75sD+VMQowT85DlVLP+G36TXhP+7P0q6bqH4vQKmPuZBRgbkxQpdRzx2j4wCpbtIu0H6N9+W96gJkwQZVSiY7RvzO0jNnifILW2cIYBZg0E1QpNfYYzWMd3rVcF8d/vn9rqrMxetjnLjABTNv4H2FKqTlUuEcTyw/G6CYsX6vybYy295eOY7Q+Zm6MAkyM81ClVDpjdPkzxrpsXRmjxy0a+jHa3qLfnFZp0V5iij1jFCBVJqhSKsUxul7HN5fH6I/XKoS6qf55Me/uNK2yhZNRgGSZoEqptMdoNnT5AlNTtZtz+OJ21/7NaG2MAiTHBFVKTWWMLobCJavtrrtTP7zV1M7Q09vGKEBixv9oUkp9pQqfarnO+4PR/qXtrn2jjBsXmADS4DxUKTXHMfrn/ny26JZmGY+Kwe+Euk0PcBsTVCk1swp3OAyFG/meUYD/ZIIqpWZc4Q77IWMUIG0mqFIqxQp3iAONMQqQtvE/cpRS6rFjtOjE+KsyRgFS5DxUKZV2hUco4kswRgHSYYIqpaZS4SHyuDJGAW5lgiqlVDhK5FTTGAUwQZVSX62MUYCJG/+jRCmlxh6jy2tDsv9u+/7p9OxL7wGchyql1L1jtOzU65hd2aJ5CKum6h+LszeMUQATVKnf7N3LbptAAIbR0SyA1viCgVbNKn3/lyytwWDXiRT5hplzFtanzN76NQpGpVzhCnHU5uGSVZb3w3MYo2cHxiiACaqUSrnCFbJBva4+vhgNu5jlxzF6fmCMApigSqmEK1whHzThsqLcdh/vb211HKPnB8YogAeTlFIJV7inotyE4le1G8do//zScGCMArgPVUolXeE2iuKDMdpNznCyOX/+iJvpQTwyRoF0maBKqVQr3EZZXh6jv7vJGfZtdfLH9fHAzSiQNBNUKaXu+qP33763Vf/o/PSPdTMceIAJSJAJqpRSDxqjYVU3/aPzZ081dQd+2glI1PO/+pVSaj4VrlLsezF2H8X/5+X6/P6zKOtmPDBGgVS4D1VKqZuP0VUZp8rLrwPN8mFp7mJnOznwOlBg4UxQpZS64+tAY8zqgxjrTvgqYxRYJBNUKaUe8zrQOm8OYmw6xiiQMhNUKaUePUab0yFpjAIpe/5XulJKvV5duR6NUSB17kOVUsoYBficCaqUUjMtYxTABFVKqZcco3U9SWMUWCoTVCml5jlGm2aSxiiwVM//qlZKqeVWuJfxR+/bKoxWMctDKMoYY90Yo8B8uQ9VSqnXH6P/3j6/aquT38nPh7O6MUaBmTFBlVJqSWN0leWHRdrrcnwh/b6tjFFgFkxQpZRa5Bg9zNBdzPJxnE7GqHfTA19jgiql1OIq3FNRbruP97fhCnQXN3/36PHQ/4wCf9i7l+W0YQAMo6oWxGCCEWAYumqfqe//LqWuxzJkmOklJg463+rE2Wf+kSP421xMIiJ6LoUpq9abUJ3Ttk35oPQyRju6wCTpT3MeSkT0vAqTlMdodU6hH6PdDs0no6dj9zgOGaOSxpmgREQlKExZtf5+Tt1NpX6a9ot0+I9SJ6OSrjNBiYgKU5iy5apNeX/uYt/ixRiVNM4EJSIqVmHS6v3hdnTmk9Fq3RijkrpcTCIiKlVh0qp1f2UpV/vQe0l9zkOJiChM23LVv5WPcTxGd/FS47vpJZmgRESFK8wnY1SSCUpEVJrCfDJGJZmgRESlKcwnY1SSi0lERKUpzCdjVJLzUCKi0hTmkzEqyQQlIipN4d86vckYlWSCEhHRg8bo8U3GqCQTlIiIHjRG422tMSrJxSQiInrQGG1+FWPT9PiR7n/ofTv8rlrHGPeH7vHvNsaoVGzOQ4mI6Et8l6PMJq7ubdHXEOq8Rm++BbRevBijUmGZoERE9O5jNLzGXbgqr81+keZ2bRoOShuv6aUyMkGJiGjKMZo5rp+h23h1ALobfqrbZIxKz5wJSkREHzVG89Fn9e1rm66e5anqApP01H38nzgiIpq7wn+0j3Wv5b0xugnVOW3bNLrPtD/k9/XGqPSEOQ8lIqLHjNFDjHV1Op2W21Vc3Bmj1TmFPEYvnY5tGh+MxiFjVPrMmaBERPToMRqaGH+ydwdLaUNhGIbP/IsQISQ5gYShq3pBvf/baY2gSGHTSCXyvAt9xD3zzZk5STUMwzKiX1weo8/7fHoE+j5Cx089Z1SaeyYoERFNU5pUXcRL/SZfebJTnw936s/H6PiIJ2NUmmcmKBER3ccYTYu6aZo6b9PlVpvtcX2e32DqovYGJmmmff1XFxERfRelm1ZW678PRjfbwy9jVJpVzkOJiGhuY3S8Pl8sjkuziz81KY2svZtemkMmKBER3fEYfSrbti136V8yRqX7zQQlIqI5jNFuWUVENZTGqPQdMkGJiGhWY3QV0RcRRVStMSp9g77+K4mIiB5NaUJPEeu8iFg0ETtjVJprzkOJiGieY3QZxWFDNjEYo9K8MkGJiOgeNG09vt2TjzBGpTlkghIR0X1p4no0RqU5ZIISEdG9yhiVHqCv/6ohIiK65RhtI64/9L7P7y9kiojN9ujaGJU+5DyUiIgeTp8xRp/KiPrKFl2ntOrz2etAx5+/jFHpJROUiIgeWWlCdXTjhlxWUaSLrYrFYZG+1/U57YY6dcaoZIISEdGjK01pvR43ZPTrxfWD0dRGcfrv7vUvY1QyQYmIiNLkmqbO6XJl1aRU/vzR54+fGaOSi0lEREQvSresrOpU7nPb55P7TJutMSo5DyUiIvovY7Tc5zSO0WO7oc+nYzTeMkYlE5SIiB5N6ZaV1fM+p9SdXadfOxmVTFAiIqKpY7Q97fIFpj6/3qk3RiUTlIiI6HPHaJyWLrXabMf1eXaryRiVXEwi+s3evewoCgRgGK3UQpkBBAQ0zmrmleb9H2baFh1JX2JfCLfzrU6atcmfaguJiL46RjddbYx1/cb/6fOXB6N1Y4xKzkOJiIi+Oka3XVUb/zZv/xzoZntdmvv4VBGuOj8yRrX6TFAiIlqzwndUxSx8JiejWm8mKBER0ffdpi9iaoxKJigREdFnxuhETjWNUS2/8T/yRERE05IxKr3IeSgREdGsxuixNEYlE5SIiGicMZoeYqyNUckEJSIiGmOMxhjrxhjVmjNBiYiIxhujeb5rJvK9U+nRXEwiIiKagsKAdS+9b6twbf/8ovvu7+cnxqjmnPNQIiKiaY/R55+lT2+bc7/ZhuNhsz0/KJyMaqaZoERERHMZo+lleObhrjIWxqjmlwlKREQ0uzF6maFl/yfokyw3RjWXTFAiIqIZj9EkK0JIfv9qKyejmmfjf0SJiIiWrTBkSbYLyakq78fo8RB33QWmtjJGNcmchxIRES1ljCanKvTG6D7mvVkabxmj+nAmKBER0cwVhizJ/pyqEPa9lzvVzf/HuZNRfTgTlIiIaEEKQ/bjZ1t1d+q7ynhx97hujFE9lglKRES0SIVBS+umu1Pf36K3+01ORvVwLiYREREtUGHQkiy/PxhNsv4WrRtjVO/nPJSIiGjZCkN2uTW/2V6XZhov7UIZnyq82kmvZoISERGtRmE6GaP6x9697KYNBGAYHc3CNy4GbEDtqn2gvv/r1A7EigVRFpDYeM6/cA5JlkT6NOAgQYmIiFJTmM/EqElQIiKi1BTmMzFqbkwiIiJKTWE+E6PmPJSIiCg1haesLMWofTkJSkRERN8To1UlRu2TSVAiIiL6XDN6hV2MmgQlIiJKTWLUXmLT/6kQERHRC8ZoWcV43IdhxTpuhx/ErRg156FERERJKzyw1bAYu8uhuNOim+7XjvvhYfMvbi9R2n3ZRZ9NbxKUiIgoaT12Hjre+nCTq1l+LdJ+59M2HC4xumra/nHTilGToERERAkrPLDNsBi7SxZjeedgNOxilofrhhjNcjFqEpSIiCh5PfE9o3kTqzBasa67y5/fx/04RvsvtZfpzY1JREREyeuJMRraUU5e3xla/NrvbmP0fIp1sW5aMZrmnIcSERHR82M03InRrkXDTYxeEDfjN56K0aVPghIREdEPx+jfrkXD4TZGy6ppz6e4dTK6/ElQIiIimihGy+otQ1c3NzD1ty711ywXowudBCUiIqKfi9G6Dv2yLIy3atrrPfXjGC0rMbrwTf/UJiIioldQeObyPIxXrDfDwej4XzvFuvfGy/TLmvNQIiIimjBG738caJa/l+Yhdrt8Y9Wj9nGgi5gEJSIiopnG6BcToy88CUpERETTxuju48RoGpOgRERENJcYjR8nRtPY9E9ZIiKi/+zdS27TUBiG4aN/YLux4/iSi2AEu2ATTNj/Ykia1CLIpVCnpbGfT2r19DLs4NVJnUNzUpqw7LJdRN+L0TnPeSgRERF9vBjNL2t38WMrRuc3CUpEREQfOUaHtVF5gGk2k6BERER0ZzGaNlGK0fueBCUiIqL7jdHkAaZ73///UyQiIqIl6o1j9GEVsWvTsKKK+hFdRGS5GP3XOQ8lIiKiWSndYodmNCQv19KXu3b4sv9+jtEuyx+vphejfzMJSkRERHNVusHKfUQ//pMsvxTpaYd9fb6b/rImNmL0+UlQIiIimr/SDRYR/fbZg9HU/PJ6/FWMFtVajP4+CUpERERLUrrB1ut6m8ZWVJvjpy+fd226zMnoy/NgEhERES1H6S1XVHUqPrXNeIwe9lGL0ac5DyUiIqIlKr3Nhhg9tmgaidEz11cX3ItRCUpERERLU5q0h6I4/DFGvx5bNHXXMTqo33prJwlKREREi1aasm5VVfviiKIYb9XVY4aWYw8wNZHl3vReghIREdGylSasidOqo6oqja7st8NbOw0xOrSoG5g8mEREREQLV5qwiL7e7KJLqY7ymdfp18PB6FWMFlWWuw7UeSgREREtXdNidJtSG/HCdaBZ/vQLXZx2+kYZ59ViVIISERHRgjX9QvqIV4akk1EJSkREREuXGP1gk6BERES0JKUJW0cnRpMHk4iIiIherYn5+HBuyEaMOg8lIiIiet8Ybb7FqusiTh8bMSpBiYiIiN73f0aHZUmMSlCin+zdzU7bQBiG0em3sAOJ8U/iRO2qvaRK7f3fShNpZBHqLKoAHqfnXaAzW7J5NDBARET0mTG6n9bWYlSCEhEREX1qjB6mpSRGPUwiIiIi+melj93Tc8TYzx1PxwsfPUbdhxIRERF9VIyeXu9GizYpbcf+72MXzePejEpQIiIioo+P0ePrpbltqzon6NXx8qV9uB/TS1AiIiKipV7TVzcvRlMXVf32OFT1g8SoBCUiIiJaJkZf8toqftdpZptde/7y/dvYvzmejs2jPGBa/iMkIiIiWq/Se6xuYpiP0Ze0+dp3Y399vMToEBHNamPUfSgRERFRMTGaQ3IuRs/xmaYYnY5Pz9HmR0wxrfwYlaBERERE5cToMG17K0Z/nOMzDWP/5pjfNG2regU3oxKUiIiIqMQYjWnj2M4/YBr73JzXx/w7o0PBMSpBiYiIiMqO0TaviV8/0+y2+0N+RH91zBl6OZcbo4t/NERERESPr/Qee6l2XZrbZtfki9GrY1YXL6U9YHIfSkRERLS6GE11xO1/B1rVuTSnY9bYF/KaXoISERERrS9Gu2nDv4fk8n9nVIISERERfVlxjMar7dcSoxKUiIiIqBylO7af1rSH1cTo4t9yIiIiInqPGD1MOx/KjlH3oUREREQlKpWzCAlKRERE9H8p3benTdd1m1NRMSpBiYiIiNaidNeG511E7I6b5WNUghIRERGtT+mebSPGKqKKXbd8jC7+rSQiIiKiP+yczUrDQBRGL5+QpPmf6ihxpe//kkIdhlxwuonVljlnUc49y6w+CslfjtGTNIVWahfprfzR+xj8tTOHxP+hGIZhGIZhdZkdoFeTNuSi18IWncyGGPzle0ZigmIYhmEYhtVldgCpvfyWh+TQtGl5usv1jMQExTAMwzAMq8vsAJJdHaNpbq5qWn+5npGYoBiGYRiGYXXZTcdoNy5m3cd7DP5yPSPxYhKGYRiGYVhd9jtjdC2N0dm6Lawx+CtbcYw+Zf7/EWEYhmEYhmH3PEZPnTQXxmi3BVtj8Ne+CwAAAACqxQ4w62xmUj+qsZ/H6OcWzM4x+Mv1BLMUAAAAoD7sCNP0vSHj1Ba+7BRDeoveXb57JBqNRqPRaDRaTe0YyzIHKzA8v6S36P2V7X4eAo1Go9FoNBrtEcfoNboxfVTUX9kYozQajUaj0WjVtxty6qXL5pR2VzbGKI32xW4dGgEMw0AQpDENUf+duo0beQ8ufPSMMcbY85aqNAxjjDHGGHNGGWOMMcbYYktVGoYxxhhjjDmjjDHGGGNssaUqDcMYY4wxxpxRxhhjjDG22CRJkiRJkiRJkiRJkiRJkiTpkf6vbfXmnJmw6bJ3p6tRBFEYhg/nR+1L19roD9ELEu//bqypKXtGsV2Q6BfpF1LUPGnIYYYklTDQV1dXV1c/TauRxrV7O6ZZRasMaZmOFKKN2Fk9N4i2zVXPEI1U7sb0nodA2iONaXqnFabNtNKYZje9dpj2CtJKKb2Dmn4K0dRTl/2ygf7PRVnjRsZqSMu06pjGbls7kSHt8bvXIdqNgzBzcETjuZoZomknvGfvb2Mj2lMG0qzpmvZsrSJE29YnnNkgTbD5cgaENPsUotGejXPO9I0I0cxTiOaeuuw3DDHtSvsQQvTCaERjWgVDkCZ4o5lkSHv87oW0uZeerSZCNL6vccSIZrwkiplk5B3RsqYvMaJZLsVQZ1GcRjSen2gxelaIJkPkts6AiMbiFs8F0ahz8SPBlhCN4xFDWrg1V0i7TztXSIPK+JreqLGR3iAa05eKgjQpOK8tpN1XWFv7+Q9JREN6rn5svkOaOY6ADGmx1pI5yhoMpM0ljSU4RJsSyzwDIhrLWzwXRLMtVBrJwBuiMR0xrqH9LH7YImxDicfH/QRIDGn5Sx8dpJEUnPex2xnS9HyoiDSkjeZeeraIxup4OhnSgH7wfs9CmUdAWLttKkdc0/MRrN33NQUvDKIhfS981xKtAqbBHTyvw+h/fRhdJ0CGtEeYRiQL901tXSBaNErrXlzOpiCatZbtjBnRolNa9UYjSGvbWDaGNaqhNJM1qvH6+wjVvJmPYO3LXm9vIW2Nu48F2JAOdt+YopXGNKCD53UY/cOE1WNN7zdtG6JxeARp46N6ZsdCIhoVZ0yrUbRSEW2+iWqFaLeZHScaNURLbLNlD2ujmnwzVhEjGud9795t+75BGjWr9k+Zdm0LpBHxrjdrWHhEK3mnPbeulG2IBnXw/I4Fp2imjUc0pIPndRj9w6QwNm/bWzYtIRrTI1wL0UcJaVSj94lIpgpp801UK0SjGosPc5cgLRQhPLDNkm/OMqJF7p2p3NaAaJSEG49tN6JC2q64m1Z8kIRotXXbeQzuWkI0oWmlBaJRcTZvW7amEaL5uca5RbRF2AaT9KKNhE+QJugI0gK4vYKQXs7vWcW2KiW03UtRMKR5IQLVWEokSCMZfSnFRwlpubtWYqpjC2mUxsSBZIwJ0uQ7Wr2TiEbVCx61kgjSrv6rZBpJUDv2P7esTq57QTvv9d3d51/NJ3/RWI0F+CW+Xt8fJsNPLKuT617WpKRRrQecGauT617WJjzk3LI6ue4l7Tj9/dyyOrnupWxVwQ39+1eGUaqwhv78/S/z/YXO73p0cnean93+T++/dmeMdbeHa75rvmu+a75rvlc5X6rHfM+2erZjvmdb8z3b8SWf7ezr6v0re33P3zXfNd9n9u5YBWEgCqIoWFn5/58rWDngoFkivNUzRaoUJ1ttlftN315t5qgelaxk1ml6/i8rIqWM0WsP16fx8fHx8fHx8fGt+7bJgUb1qGQlS50m8n+9IpJljF57yFwVHx8fHx8fHx/fum+bHGhUj0pWstRpIv/XKyJZxui1h8xp8fHx8fHx8fHxneqb+WunrB71rGTWaXr+LysivYzRaw+Xx4OPj4+Pj4+Pj+8039z/jEb1qGUls05TPq5XRHoZo6e9+Pj4+Pj4+Pj4ln37XEajelSzklmn6fm/rIj0Msb7w+Lj4+Pj4+Pj4/vMt/VlNKpHJStZ6jSR/+sVkSxj9NpDHhYfHx8fHx8fH9+6b5vLaFSPSlay1Gki/9crIlnG6LWHzGnx8fHx8fHx8fGd5hucA31RPbqV996mCLMikmUMPj4+Pj4+Pj6+Kb7/2vST4uM7ML5h4+M7ML5h4/ttn5mZmZmZ2Z19O9ppGwYDMBr5YitN67qBwrPsNTZp2/s/yRrXcTDI2kWlUsQ5N4BTx//lp4QCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFcZQ+sw3MbDNmRxuFoKj08DAACf0K1jtKZocX1IbnZiFADgk/qQGE0hiFEAAIqH7S2DbrNbI3QUowAAX91NY/TlOYTTcajEKADA11ZitEm81y/tp/PleSXOv4Zv3+e1VP482w+r6b8v31PIO7P+xrTedgwhrieO+cRl7Mbh3fTFmGcuswIAcF+aGG0qLy4x+nPuu9NxqsWYQjhcom/J07y42PcfjDYXOxt7Mbqe2I3RdvpsPE+eQt0JAMA9aWK0jbxYYvR3mP3ahtyklzT8uwtF2T2F1b57Vr5pq93Yj9Ef66d6MdpOX2P0T5h5NgoAcH/exOiYezMvX9anXKDli0fTpfpSLbtpqb7NrmzMn4zdt/Ttw8n3GzsxWk98ea73qP8z2p0+L9VWnfJFAADuSI3RNhdz9cWam6UB06sYjUvr7cvPx6e6sd6xld5c6WzsxWgs856ObYx2p5+NuaLXNfjH3h3ttAoEARhOektOQRKPz+L7v5jpZhwywTEYjaH1+66AZXUv/2wLBQBOJGO0xN+WhOut5UbIzaP+Ikafn0oP1kSMJKzybxW7iX2MXsulEqPN6uPa/D4sRgEATqbE6Mv/6MhtYB0FFwNbjP7Lu8ZAXml2ILsY3U9sYrReqjHarl6BAgCcXInR+lhQxOjz063zxkmJ0QjAMb7Wtykdj9E68XsxWlcvRgEAzu/HY3ScXI8+wFQnilEAgL/lN3dGx8vz7YwCANDFaN26bGK0/c5o9mnzv+K2tJ/4jRitq/fUEgDA+WWM5u8VfSlG13FYnqCP46K8BzQ1E+MNUOPoaIzm6sUoAMAdiRhtHzHqYzQ/eC8/9JmHVd5eQnU/sQTqcmlitL4Xqq5ejAIA3I+I0e0s420aRdjE6G1s1F/MXi5xLXuz2xrNrJzGzP3E/P2k6dLGaOZrnEzzB6sXowAAZ1didFRf+iRG0xiN6Atd/UU+hsjY3cR66bWP0YjhMO9WL0YBAM4vYjQtR2M07wlTydPWWmO0TtzWFBeWPkbr3DlWL0YBAO5JxmhayjZlF6MZfHXX80D6LZme/cQpArOP0dqt1/3qfWcUAOAxjTQEAIADxCgAAI9DjAIAcJQYBQDgcYhRAACOEqMAADwOMQoAAAAAAAAAAAC8tQeHBAAAAACC/r/2hgEAAAAAAAAAAAAAAAAAAADOAvY/HKFDNptvAAAAAElFTkSuQmCC" />
	<p>
		Below is a tool to help you convert between different tempo algorithms.
	</p>
	<table border="1">
		<tr><td>counter</td><td><input id="tmctr" /></td><td><button onclick="tmpc('tmctr')">convert</button></td></tr>
		<tr><td>overflow</td><td><input id="tmofw" /></td><td><button onclick="tmpc('tmofw')">convert</button></td></tr>
		<tr><td>Sonic 2</td><td><input id="tmsh2" /></td><td><button onclick="tmpc('tmsh2')">convert</button></td></tr>
	</table>
	<p>
		Music also has an additional variable: Tick multiplier. For sound effects and often music, this value is set to $01, but you can use other values if you want to. When a delay is read from the tracker, that value is multiplied by the tick multiplier amount. Tick multiplier of $01 means it is the same as read, but $02 means it's twice as long, etc. There is a small issue though. If the total amount overflows the 8-bit range, you start getting smaller values again. As a special case, a delay of $00 is considered undefined, though in most cases it will act as if the delay was $100 frames. This is a limitation with the engine.
	</p>
	<p>
		Additionally, the tick multiplier field may contain extra flags. These flags tell AMPS to treat the music in special ways. They are mostly just for extra features. Here is a list of the special modes. I've listed the bit it detects along with the value that bit represents:
	</p>
	<ul>
		<li><b>bit 6, $40</b> — Tells AMPS that the previous song should be <a href="#part4_2">backed up</a>. This is useful for temporary sounds that should not restart the previous song from the beginning.</li>
		<li><b>bit 7, $80</b> — In PAL regions, Mega Drives run at 50hz as opposed to 60hz. The driver combats this by running twice every 6th frame. This causes timing issues with things that run for a specific amount of time. This flag disables that behavior, meaning the music runs slower, but takes the correct amount of time.</li>
	</ul>
	<p>
		The header also defines the channels that should be used for music. Currently, DAC1 and DAC2 must always be defined, even if they go unused. After DAC channels, FM channels and finally PSG channels are defined. FM and PSG channels always go in order and no channel can be skipped. This works differently to sound effects, which can be defined in any order the programmer wants. This is by design however, to reduce the size of tracker files and load times. Finally, the FM voice list comes right after the last channel. It does not necessarily have to contain any voices, but if some were needed that is where they should be placed. The inflexibility of this system is unfortunate and there are future plans to mitigate it.
	</p>
	<p>Here is an example music header:</p>
	<smps2asm><lbl>Example_Header:</lbl>
	<mac>sHeaderInit</mac>						<cmt>; this line initializes some variables required to make songs work</cmt>
	<mac>sHeaderTempo</mac>	<val>$81</val>, <val>$33</val>				<cmt>; that $8X means that the 50hz "fix" is not applied to this song.</cmt>
	<mac>sHeaderCh</mac>	<val>$03</val>, <val>$02</val>				<cmt>; first parameter is number of FM channels, second is PSG channels.</cmt>
	<mac>sHeaderDAC</mac>	<lbl>Example_DAC1</lbl>, <val>$08</val>, <equ>dKick</equ>		<cmt>; first parameter is tracker data location, second is volume, third is sample to use.</cmt>
	<mac>sHeaderDAC</mac>	<lbl>Example_DAC2</lbl>				<cmt>; you can also omit these fields and they default to $00.</cmt>
	<mac>sHeaderFM</mac>	<lbl>Example_FM1</lbl>, <val>$00</val>, <val>$00</val>			<cmt>; first parameter is tracker data location, second is pitch offset, third is volume.</cmt>
	<mac>sHeaderFM</mac>	<lbl>Example_FM2</lbl>, <val>$F4</val>, <val>$09</val>			<cmt>; all these channels have slightly different headers. You should use the right one.</cmt>
	<mac>sHeaderFM</mac>	<lbl>Example_FM3</lbl>, <val>$F4</val>, <val>$0D</val>			<cmt>; if you have a wrong number of channels, it will lead to an error. Double check if unsure.</cmt>
	<mac>sHeaderPSG</mac>	<lbl>Example_PSG1</lbl>, <val>$D0</val>, <val>$18</val>, <val>$00</val>, <equ>v05</equ>	<cmt>; first parameter is tracker data location, second is pitch offset, third is volume</cmt>
	<mac>sHeaderPSG</mac>	<lbl>Example_PSG1</lbl>, <val>$00</val>, <val>$30</val>, <val>$00</val>, <equ>v00</equ>	<cmt>; (volume is multiplied by $08), fourth is detune, and fifth is volume envelope ID</cmt>

	<cmt>; this is where the FM voices go.</cmt></smps2asm>
	<p>
		Including your music is also pretty easy. Music file names must not contain spaces or other special characters. The only valid characters are A-Z, a-z, 0-9 and _. Music files will be assigned an ID, and in program code, you can refer to this specific id with a special equate, named the music file name, prefixed with <b>mus_</b>. For example, you may have <b>mus_Something</b>. To include your music, simply open <b>code/Data.asm</b>, and locate <b>MusicIndex</b>. You will see lines starting with <b>ptrMusic</b>, with a name and a number. The name should simply be the file name of your music file, while the number is the speed shoes tempo value. Speed shoes tempo should always come right after the music file name. Here is an example:
	</p>
	<smps2asm>	<mac>ptrMusic</mac>	<lbl>Something</lbl>, <val>$10</val></smps2asm>

	<h3 id="part3_1_1" class="bd"><a class="bx" href="#part3_1_1">3.1.1 — Tempo vs BPM</a></h3>
	<p>
		Although not necessary to understand, musicians might be interested in BPM conversion for reference. This tool below allows you to easily convert between them. Tick per quarter is by default $18 in most music, but other values are fine to use too. These conversion values are not always 1:1, especially when converting from BPM. It is best to click the counter or overflow conversion buttons to get a more accurate measure!
	</p>
	<table border="1">
		<tr><td>counter</td><td><input id="bcctr" /></td><td><button onclick="bpmc('bcctr')">convert</button></td></tr>
		<tr><td>overflow</td><td><input id="bcofw" /></td><td><button onclick="bpmc('bcofw')">convert</button></td></tr>
		<tr><td>BPM</td><td><input id="bcbpm" /></td><td><button onclick="bpmx()">convert</button></td></tr>
		<tr><td>tick multiplier</td><td colspan="2"><input id="bctm" value="01" style="width:100%; box-sizing: border-box;" /></td></tr>
		<tr><td>ticks per quarter</td><td colspan="2"><input id="bctq" value="18" style="width:100%; box-sizing: border-box;" /></td></tr>
	</table>
	<h3 id="part3_2" class="bd"><a class="bx" href="#part3_2">3.2 — Sound Effect Files</a></h3>
	<p>
		Sound effects are useful when you want to play a small sound or a short jingle. They are most commonly used as feedback for the player or for enemy sounds. Sound effects are not affected by current tempo or by the 50hz "fix", and generally do not use the tick multiplier. Additionally, sound effects cannot use the channel stack or gate command. These were deemed unnecessary for sound effects and are therefore not available. Sound effects share a voice bank, so the voices are not located after the header. Instead, they are loaded from <b>Voices.asm</b>.
	</p>
	<p>
		Sound effects have a priority system, which allows some sound effects to override others, or not, depending on the priority setting. Priorities go from $00 to $FF, where $00 is the lowest possible priority and $FF the highest. Lower priority channels are always overridden by ones with higher priority. The programmer can decide which priority values to give to each sound effect, but it is recommended to use $80 as the midway point, with priority values fairly close to it. In AMPS, priority values are stored per channel and therefore stick for the duration the channel exists. This means that priority values are computed per channel and stick for longer than a frame. Compared to Sound-Source drivers, this will make sound effects sound different and they cannot override each other at a later time.
	</p>
	<p>
		Sound effects can define channels in any order, and with a standardized set of parameters. The first parameter is a set of flags that should always be the same according to channel type (other values have undefined behaviour). The second parameter is the actual channel type. It is preferred you use the equates provided in <b>code/macro.asm</b> to keep consistency. third parameter is the tracker data location, fourth parameter is pitch offset, and finally, fifth parameter is the channel volume. Here is an example of a sound effect header:
	</p>
	<smps2asm>	<mac>sHeaderInitSFX</mac>						<cmt>; this line initializes some variables required to make sound effects work</cmt>
	<mac>sHeaderPrio</mac>	<val>$80</val>					<cmt>; this is the priority for all sound effect channels</cmt>
	<mac>sHeaderCh</mac>	<val>$03</val>					<cmt>; this must match the actual number of sound effect channels</cmt>
	<mac>sHeaderSFX</mac>	<val>$80</val>, <equ>ctFM5</equ>, <lbl>.FM5</lbl>, <val>$00</val>, <val>$00</val>		<cmt>; FM channels must all use $80 for the flags value</cmt>
	<mac>sHeaderSFX</mac>	<val>$A1</val>, <equ>ctPSG3</equ>, <lbl>.PSG3</lbl>, <val>$0C</val>, <val>$02</val>		<cmt>; PSG channels must all use $A1 for the flags value</cmt>
	<mac>sHeaderSFX</mac>	<val>$A0</val>, <equ>ctDAC1</equ>, <lbl>.DAC1</lbl>, <val>$00</val>, <val>$00</val>		<cmt>; DAC channels must all use $A0 or $A1 for the flags value</cmt></smps2asm>
	<p>
		Currently, sound effects may use the following channels: FM3, FM4, FM5, PSG1, PSG2, PSG3, and DAC1. FM3 may be later changed to FM2.
	</p>
	<p>
		Including sound effect files is pretty easy: each sound effect file name must not contain spaces or other special characters. The only valid characters are A-Z, a-z, 0-9 and _. Sound effect files will be assigned an ID, and in program code, you can refer to this specific ID with a special equate, named the sound effect file name, prefixed with <b>sfx_</b>. For example, you may have <b>sfx_Example</b>. To include your sound effects, simply open <b>code/Data.asm</b>, and locate <b>SoundIndex</b>. You will see lines starting with <b>ptrSFX</b> and a number, then a list of names. The name should simply be the file name of your sound effect file, while the number is a bit-field of flags. Each different set of flags should be on its own <b>ptrSFX</b> line. Here is a list of the flags. I've listed the bit it detects along with the value that bit represents:
	</p>
	<ul>
		<li><b>bit 0, $01</b> — Tells AMPS this sound effect should switch to the next ID every other time it is played. This is used to implement the ring speaker switching behaviour from Sonic games, although it could be used for any number of sound effect behaviours.</li>
		<li><b>bit 7, $80</b> — Tells AMPS this sound effect is continuous. These sound effects do not restart each time they are played. Instead, they continue in a loop inside of the tracker file. They are stopped only when either the sound effect is no longer being played, or some other sound effect overrides it. This effect was particularly popular in Sonic 3 & Knuckles, but individual sound effects in Sonic 1 and Sonic 2 use similar behaviours.</li>
	</ul>
	<p>
		Here is an example of including your sound effect:
	</p>
	<smps2asm>	<mac>ptrSFX</mac>		<val>$01</val>, <lbl>Example</lbl></smps2asm>

	<h1 id="part4" class="bd"><a class="bx" href="#part4">4 — Trackers</a></h1>
	<p>
		In <a href="#part3">part 3</a>, <a href="#part3_1">3.1</a> and <a href="#part3_2">3.2</a> we talked about the specific differences between sound commands, music, and sound effects. In this part, we'll instead talk about the similarities, and dive deeper into how trackers work.
	</p>

	<h3 id="part4_1" class="bd"><a class="bx" href="#part4_1">4.1 — Trackers Overview</a></h3>
	<p>
		In AMPS, a tracker is channel-specific data that describes how to drive the underlying hardware. AMPS will interpret this data and perform the actions requested by the programmer. Trackers in concept are quite simple, but internally are not. AMPS aims to abstract much of this complexity, so the programmer has to worry about it as little as possible. Trackers are split into 3 types of data: Tracker commands, notes, and delays. For this section, we will focus on notes and delays, and we'll dive deeper into tracker commands in <a href="#part4_2">the next part</a>.
	</p>
	<p>
		AMPS uses delays to know for how long to wait before reading from the tracker. Each channel has a stored note duration and active note duration. Together with delays, tick multipliers, and tempo (sound effects ignore tempo), the note duration is calculated. Every frame, channels will decrease this timer, and if it reaches 0, the tracker is processed again. To make FM, DAC, and PSG compatible, different initial values are loaded into the delay when channels are started (such as when a new music or sound effect is loaded). A delay of $00 frames is considered undefined behaviour, but the engine properly supports any delays between $01 and $7F frames. Most songs will use $18 ticks per quarter note and multiples or divisions of $18 for other delays, but any other value can also be used. It is important to remember that if the tick multiplier is high and the delay value is also high, an overflow may happen, where the delay would be >$FF frames. This, in reality, will lead to a delay less than the intended amount. This is considered bad practice and should be avoided.
	</p>
	<p>
		AMPS uses notes as a means of representing frequency values. PSG, FM, and DAC all have different tables for defining the intended frequency based on the note, but that is rarely something the programmer has to worry about. Instead, it's common to use the provided equates in <b>code/smps2asm.asm</b> as guidelines for note values. There are 12 notes per octave for each type of hardware, and they should roughly sound accurate to real instruments, although it can also depend on the instrument and what kind of hardware voice is used. The programmer can decide to create their own pitch tables or even use a different number of notes per octave, but this is not officially supported with AMPS. Notes go from $80 to $DF, and $80 always represents a rest, where no note will be played, but instead, the note is set to release (when applicable). Playing notes is affected by the transposition of the channel. Transposition will be added to the note value read from the tracker, so another note may actually be played. This is very useful when multiple channels may share routines, or the same routine is used multiple times at different keys. It is important to keep this fact in mind, as it can be both useful and confusing.
	</p>
	<p>
		There is a very specific order of operations when it comes to trackers in AMPS. First off, all commands are executed in order. Few commands will stop the tracker completely, in which case the rest of the process is abandoned. However, if that does not happen, AMPS expects either a note or a delay to happen at some point. If a delay is read, the last note is used to play again. If no note was played yet, the result is undefined behaviour. AMPS will also correctly remember if a rest was played. AMPS will stop reading the tracker, process the delay, and continue to do standard note-on behaviour unless a hold command was played. However, if a note is played instead, AMPS will read its frequency from the appropriate table, and then check the next byte. If this byte is a delay, the delay is also read and processed. There must be no other commands or notes before the delay for this to happen. Again, if no delay was ever played, this is considered undefined behaviour. AMPS will stop reading the tracker, process the delay, and continue to do standard note-on behaviour unless a hold command was played. Although these three approaches may seem confusing and unnecessary, it actually helps to avoid repeating yourself and save some ROM space. It may not be necessary, but it will help those who want it. More about frequencies can be read from <a href="#part5">part 5</a>. Below, you can see a demonstration of how this works:
	</p>
	<smps2asm>	<opc>dc.b</opc> <equ>nRst</equ>, <val>$0C</val>				<cmt>; play a rest note for $0C frames</cmt>
	<opc>dc.b</opc> <equ>nE4</equ>				<cmt>; play E4 note for $0C frames</cmt>
	<mac>saVol</mac>		<val>$04</val>			<cmt>; increase channel volume by $04</cmt>
	<opc>dc.b</opc> <val>$06</val>				<cmt>; play E4 note for $06 frames</cmt>
	<opc>dc.b</opc> <equ>nF4</equ>				<cmt>; play F4 note for $06 frames</cmt>
	<mac>saVol</mac>		<val>-$04</val>			<cmt>; decrease channel volume by $04</cmt>
	<opc>dc.b</opc> <equ>nA4</equ>, <val>$0C</val>				<cmt>; play A4 note for $0C frames</cmt></smps2asm>
	<p>
		A small note here is that when a DAC channel is in sample mode, instead of using the note to read from the frequency table, it instead reads the note as a sample to play. This is very useful when the channel does not need to change the frequency often, and is instead primarily used to play different samples. By default, DAC channels use this mode, but the user can change it depending on preference. More about this is explained in <a href="#part4_2">the next section</a>.
	</p>

	<h3 id="part4_2" class="bd"><a class="bx" href="#part4_2">4.2 — Tracker Commands</a></h3>
	<p>
		AMPS has a large variety of tracker commands. Although not all of them will be useful for every person, they exist nonetheless to help people make music in their own way. Tracker commands go from $E0 to $FF. $FF is a special command, which reads another byte from tracker, to add more possible commands. Below, I will list all the tracker commands in AMPS, their numerical codes, and the parameters they use. All parameters enclosed &lt;like this&gt; are required, while parameters enclosed [like this] are optional. I will also explain how each tracker command works:
	</p>
	<h4 id="cmdE0"><a class="bx" href="#cmdE0">$E0 — ssPan &lt;pan&gt;, [ams], [fms]</a></h4>
	<p>
		This command is used to set the YM2612 panning for the current channel. It only works for FM and DAC channels. YM2612 uses channel panning to determine which speaker to play audio on for different sound channels. There is a flaw however: Since both DAC channels and FM6 are technically the same channel for YM2612, they can only pan together. This is why both active DAC channels OR their panning value together. If DAC1's panning is set to $80, and DAC 2's $40, the resulting panning value is $C0. DAC1 sound effects override the panning value for DAC1 music. Currently, panning on FM6 when any DAC channel is running is considered undefined behaviour, and is therefore disabled in safe mode. This command is skipped when condition is false.
	</p>
	<p>
		The three arguments for ssPan all are used to set the panning value. Since the <a href="https://www.smspower.org/maxim/Documents/YM2612#regb4">panning register is shared with the AMS/FMS data</a> for LFO, you can set both using this command. However, if LFO is not enabled by the tracker, setting AMS/FMS values is considered undefined behaviour. The <b>&lt;pan&gt;</b> parameter can be used to either only set the panning values, or the entire byte. <b>[ams]</b> and <b>[fms]</b> can also be used to set the AMS/FMS values too. They're shifted in place correctly. Below is a table of pre-defined equates for panning values:
	</p>
	<ul>
		<li><b>$00, spNone</b> — Sets panning to neither speaker. This effectively mutes the channel. However, setting DAC2 music channel to panned to neither is actually recommended. Using DAC1, it is then possible to pan the channel in the appropriate speaker at any time.</li>
		<li><b>$40, spRight</b> — Sets panning to the right speaker.</li>
		<li><b>$80, spLeft</b> — Sets panning to the left speaker.</li>
		<li><b>$C0, spCentre</b> — Sets panning to both of the speakers, effectively making it centered.</li>
		<li><b>$C0, spCenter</b> — Silly Americans =U</li>
	</ul>
	<h4 id="cmdE1"><a class="bx" href="#cmdE0">$E1 — ssDetune &lt;detune&gt;</a></h4>
	<p>
		Sets the channel detune to <b>&lt;detune&gt;</b>. Detune is used to change the frequency of the channel slightly. <a href="#part5">You can read more about how this works here.</a> This command is skipped when condition is false.
	</p>
	<h4 id="cmdE2"><a class="bx" href="#cmdE2">$E2 — saDetune &lt;detune&gt;</a></h4>
	<p>
		Adds <b>&lt;detune&gt;</b> to the channel detune. Detune is used to change the frequency of the channel slightly. <a href="#part5">You can read more about how this works here.</a> This command is skipped when condition is false.
	</p>
	<h4 id="cmdE3"><a class="bx" href="#cmdE3">$E3 — ssTranspose &lt;transp&gt;</a></h4>
	<p>
		Sets the channel transposition to <b>&lt;transp&gt;</b>. Transposition is used to change which notes are played, adding to tracker notes. This is very useful when you want to share routines between FM, PSG and DAC, or for reusing a routine but just transposed. This command is skipped when condition is false.
	</p>
	<h4 id="cmdE4"><a class="bx" href="#cmdE4">$E4 — saTranspose &lt;transp&gt;</a></h4>
	<p>
		Adds <b>&lt;transp&gt;</b> to the channel transposition. Transposition is used to change which notes are played, adding to tracker notes. This is very useful when you want to share routines between FM, PSG and DAC, or for reusing a routine but just transposed. This command is skipped when condition is false.
	</p>
	<h4 id="cmdE5"><a class="bx" href="#cmdE5">$E5 — ssTickMulCh &lt;tick&gt;</a></h4>
	<p>
		Sets channel tick multiplier to <b>&lt;tick&gt;</b>. Tick multiplier is used to multiply the delay read from tracker by the tick multiplier value. This is used for some songs. <a href="#part4_1">See the previous part for more details</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdE6"><a class="bx" href="#cmdE6">$E6 — ssTickMul &lt;tick&gt;</a></h4>
	<p>
		Sets tick multiplier for every channel to <b>&lt;tick&gt;</b>. Tick multiplier is used to multiply the delay read from tracker by the tick multiplier value. This is used for some songs. <a href="#part4_1">See the previous part for more details</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdE7"><a class="bx" href="#cmdE7">$E7 — sHold</a></h4>
	<p>
		Toggles the channels hold flag. The hold flag prevents AMPS from processing the normal note on/note off behaviour and resetting internal flags, for example, modulation. The result is that the sound will continue uninterrupted, but you can also add extra tracker commands or delay to your notes. This allows delays longer than $100 frames to be set in the tracker as if it was a continuous note. If you play another note the frequency will be updated but note will not be restarted.
	</p>
	<h4 id="cmdE8"><a class="bx" href="#cmdE8">$E8 — sVoice &lt;voice&gt;</a></h4>
	<p>
		Sets FM voice to &lt;voice&gt; or DAC sample to &lt;voice&gt;. Using this command on a PSG channel is considered undefined behaviour. Additionally, using this command on a DAC channel when pitch mode is enabled is considered undefined behaviour. Read more about how FM voices work at <a href="#part4_4">part 4.4.</a> This command is skipped when condition is false.
	</p>
	<h4 id="cmdE9"><a class="bx" href="#cmdE9">$E9 — ssTempoShoes &lt;tempo&gt;</a></h4>
	<p>
		Sets the speed shoes tempo to <b>&lt;tempo&gt;</b>. You can read more about tempos and how they work at <a href="#part3_1">part 3.1</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdEA"><a class="bx" href="#cmdEA">$EA — ssTempo &lt;tempo&gt;</a></h4>
	<p>
		Sets the normal tempo to <b>&lt;tempo&gt;</b>. You can read more about tempos and how they work at <a href="#part3_1">part 3.1</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdEB"><a class="bx" href="#cmdEB">$EB — sModeSampDAC</a></h4>
	<p>
		Sets the channel mode to sample mode. Using this command on a FM or PSG channel is considered undefined behaviour. Sample mode makes it so that each note read is treated as a sample instead of a note. This way, you can easily play different samples in quick succession. This mode is most useful when you want to play multiple different samples at the same pitch. You can use <b>ssFreq</b> and <b>ssFreqNote</b> to change the pitch of samples. This command is skipped when condition is false.
	</p>
	<h4 id="cmdEC"><a class="bx" href="#cmdEC">$EC — sModePitchDAC</a></h4>
	<p>
		Sets the channel mode to pitch mode. Using this command on a FM or PSG channel is considered undefined behaviour. Pitch mode makes it so that each note read is treated as a note instead of a sample. This way, you can easily play samples at different pitches. This mode is most useful when you want to play samples many times at different pitches, or you want to play most of your samples at varying pitches. You can use <b>sVoice</b> to change the samples you are playing. This command is skipped when condition is false.
	</p>
	<h4 id="cmdED"><a class="bx" href="#cmdED">$ED — saVol &lt;volume&gt;</a></h4>
	<p>
		Adds <b>&lt;volume&gt;</b> to the channel volume. AMPS will update the channel volume at the end of the channel update process. <a href="#part6">You can read more about how volume works here.</a> This command is skipped when condition is false.
	</p>
	<h4 id="cmdEE"><a class="bx" href="#cmdEE">$EE — ssVol &lt;volume&gt;</a></h4>
	<p>
		Sets the channel volume to <b>&lt;volume&gt;</b>. AMPS will update the channel volume at the end of the channel update process. <a href="#part6">You can read more about how volume works here.</a> This command is skipped when condition is false.
	</p>
	<h4 id="cmdEF"><a class="bx" href="#cmdEF">$EF — ssLFO &lt;reg&gt; &lt;ams&gt; [fms] [pan]</a></h4>
	<p>
		Enables LFO and sets up AMS, FMS and enable bits for the channel. LFO is a YM2612 effect that changes the volume and frequency of the sound being generated. Unlike software effects, LFO can change volume and frequency many times a frame, with some values sounding much like shouting into a spinning fan. LFO speed settings are global for each channel, but every channel can define how strongly they are affected. Changing the global settings while multiple channels have LFO enabled affects each channel. The &lt;reg&gt; parameter is used to control which operators to enable AMS for, <a href="https://www.smspower.org/maxim/Documents/YM2612#reg22">and the LFO frequency</a>. See the table below:
	</p>
	<table border="1">
		<tr><td>bit</td><td>7</td><td>6</td><td>5</td><td>4</td><td>3</td><td>2</td><td>1</td><td>0</td></tr>
		<tr><td>val</td><td>$80</td><td>$40</td><td>$20</td><td>$10</td><td>$08</td><td>$04</td><td>$02</td><td>$01</td></tr>
		<tr><td>use</td><td>Enable op 1</td><td>Enable op 3</td><td>Enable op 2</td><td>Enable op 4</td><td>Enable LFO</td><td colspan="4">LFO Frequency</td></tr>
	</table>
	<p>
		The &lt;ams&gt;, [fms] and [pan] parameters can be used together to define the <a href="https://www.smspower.org/maxim/Documents/YM2612#regb4">AMS and FMS sensitivity, and channel panning</a>. The &lt;ams&gt; parameter can be used to set the entire byte value, or only the AMS sensitivity. &lt;ams&gt; and [fms] are shifted in the correct places when the &lt;ams&gt; parameter is not used alone, and [pan] parameter expects normal values for it. Below is a table of pre-defined equate values for panning:
	</p>
	<ul>
		<li><b>$00, spNone</b> — Sets panning to neither speaker. This effectively mutes the channel. However, setting DAC2 music channel to panned to neither is actually recommended. Using DAC1, it is then possible to pan the channel in the appropriate speaker at any time.</li>
		<li><b>$40, spRight</b> — Sets panning to the right speaker.</li>
		<li><b>$80, spLeft</b> — Sets panning to the left speaker.</li>
		<li><b>$C0, spCentre</b> — Sets panning to both of the speakers, effectively making it centered.</li>
		<li><b>$C0, spCenter</b> — Silly Americans =U</li>
	</ul>
	<p>
		This command is skipped when condition is false.
	</p>
	<h4 id="cmdF0"><a class="bx" href="#cmdF0">$F0 — sModAMPS &lt;wait&gt; &lt;speed&gt; &lt;step&gt; &lt;count&gt;</a></h4>
	<p>
		Updates software frequency modulation information. Modulation is useful for creating an effect where frequency moves up and/or down repeatedly, which can be used either for detuning on instruments or for custom effects. They are often used for sound effects to make them sound interesting, realistic or fun. They are also used in music to create bigger immersion. Modulation in AMPS is slightly different from Sound-Source games, but in general it works similarly. The <b>&lt;wait&gt;</b> parameter delays the start of the modulation by that number of frames, where 0 frames means it starts immediately. <b>&lt;speed&gt;</b> is the number of frames to delay until the next step is executed. 0 frames is considered invalid. <b>&lt;step&gt;</b> is the frequency offset per step. Values are sign extended, so anything above $7F is a negative value. The resulting frequency offset is 16-bit and can also be negative. <b>&lt;count&gt;</b> is the number of steps to perform before negating the <b>&lt;step&gt;</b> parameter. 0 steps will behave as infinite steps. For a more in-depth explanation of the algorithm, <a href="#part5_1">see the next part</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF1"><a class="bx" href="#cmdF1">$F1 — ssPortamento &lt;frames&gt;</a></h4>
	<p>
		Sets the portamento speed to <b>&lt;frames&gt;</b> frames, where 0 frames disables the effect. Portamento is an effect where the frequency of the previous note is blended smoothly with the current note. The <b>&lt;frames&gt;</b> parameter is used to control how long this transition takes. A speed of $01 means there is 1 frame where the note is transitioning to the next. In that example, the frequency will be in the middle of the 2 notes. Portamento only occurs when the next note is played, and therefore will delay the notes slightly. This also affects note on/off behaviour, which will happen whenever the note is played rather than when it transitions. This can be worked around with the sHold tracker command or by creating complex tracker code to execute the note-on when you want it to happen. This is usually not noticeable enough to matter however. <a href="#part5_2">Read more about portamento in this part</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF2"><a class="bx" href="#cmdF2">$F2 — sVolEnv &lt;env&gt;</a></h4>
	<p>
		Sets the channel volume envelope to <b>&lt;env&gt;</b>. Volume envelopes are used to change the volume of a channel per frame, reading from a list. This is particularly useful for PSG channels, since they do not inherently have any capability to change the volume in a meaningful way otherwise. However, if FEATURE_DACFMVOLENV is enabled, DAC and FM channels can also use this functionality. More about volume envelopes in <a href="#part6_1">part 6.1</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF3"><a class="bx" href="#cmdF3">$F3 — sModEnv &lt;env&gt;</a></h4>
	<p>
		Sets the channel modulation envelope to <b>&lt;env&gt;</b>. Modulation envelopes are used to change the frequency of a channel per frame, reading from a list. This works similarly to volume envelopes, but has some differences as well. Sound-Source games have used this feature to create more dynamic sounding instruments. This feature is only available when FEATURE_MODENV is enabled. More about modulation envelopes in <a href="#part5">part 5</a>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF4"><a class="bx" href="#cmdF4">$F4 — sCont &lt;loc&gt;</a></h4>
	<p>
		Is used to make continuous sound effects work. Playing a continuous sound effect multiple times does not restart the sound effect, but instead makes it continue for longer time. This means that the sound effect can loop smoothly, and yet can be extended as necessary. This command allows continuous sound effects to check if the sound effect was played again, and if so, jump back to <b>&lt;loc&gt;</b> in tracker code. AMPS assumes that every sound effect channel will loop, so not looping every sound effect channel is considered undefined behaviour, though most of the time some channels will loop more times than others. If you do not wish a channel to play any sound after some time, loop them inside a bunch of rest notes. Additionally, all the channels should loop at the exact same tick. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF5"><a class="bx" href="#cmdF5">$F5 — sStop</a></h4>
	<p>
		Will stop the current tracker from running, and release all the resources needed by the channel. Additionally, when sound effect channels are stopped, the music channels they were interrupting are correctly restored. After this command, no tracker code in the current channel will be executed. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF6"><a class="bx" href="#cmdF6">$F6 — sJump &lt;loc&gt;</a></h4>
	<p>
		Sets the tracker address to be at <b>&lt;loc&gt;</b>. After this command, all tracker code for the current channel is read starting from <b>&lt;loc&gt;</b>. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF7"><a class="bx" href="#cmdF7">$F7 — sLoop &lt;index&gt; &lt;loops&gt; &lt;loc&gt;</a></h4>
	<p>
		Creates a loop between the command and the address at <b>&lt;loc&gt;</b>. This loop will be executed for <b>&lt;loops&gt;</b> times. Due to technical reasons, <b>&lt;loops&gt;</b> must be 2 or greater. Finally, the <b>&lt;index&gt;</b> parameter is used to identify which loop is being used. AMPS supports 3 different loop indexes, primarily used for multiple loops inside of each other. Here is a list of how the loop indexes are available for different channels:
	</p>
	<ul>
		<li><b>$00</b> — Always available.</li>
		<li><b>$01</b> — Available for every channel except PSG3, if FEATURE_DACFMVOLENV is disabled.</li>
		<li><b>$02</b> — Available only for music channels.</li>
	</ul>
	<p>
		This command is skipped when condition is false.
	</p>
	<h4 id="cmdF8"><a class="bx" href="#cmdF8">$F8 — sCall &lt;loc&gt;</a></h4>
	<p>
		Is used to temporarily run another routine, while remembering the last location we were in. The tracker address at <b>&lt;loc&gt;</b> is jumped to, while the location of the next tracker command at the previous address is saved to a stack. This allows us to run another routine, or even multiple other routines, before eventually returning back to the original routine. The sRet command is used to return back a level in the stack. This command is very useful for general routines that you may want to reuse multiple times, or even between multiple different trackers. By default, 3 different routines can be called before the stack runs out of space. This command is not available for sound effect channels, and attempting to use it will result in undefined behaviour. This command is skipped when condition is false.
	</p>
	<h4 id="cmdF9"><a class="bx" href="#cmdF9">$F9 — sRet</a></h4>
	<p>
		Is used to return from a routine called by sCall. This immediately returns to the next tracker code after the corresponding sCall command. If there are no calls present in the stack, the operation is invalid and results in undefined behaviour. This command is not available for sound effect channels, and attempting to use it will result in undefined behaviour. This command is skipped when condition is false.
	</p>
	<h4 id="cmdFA"><a class="bx" href="#cmdFA">$FA — sComm &lt;index&gt; &lt;val&gt;</a></h4>
	<p>
		Sets the communications byte <b>&lt;index&gt;</b> to <b>&lt;val&gt;</b>. Since AMPS only supports 16 communications bytes, using indexes higher than that will result in undefined behaviour. There are only 8 communications flags installed by default however. If you extend the number of available communications bytes, then they may be used. Read more about communications bytes in <a href="#part7">part 7</a>.
	</p>
	<h4 id="cmdFB"><a class="bx" href="#cmdFB">$FB — sCond &lt;index&gt; &lt;cond&gt; &lt;val&gt;</a></h4>
	<p>
		Checks the value of communications byte <b>&lt;index&gt;</b> against <b>&lt;val&gt;</b>. The command reads the byte at <b>&lt;index&gt;</b>, compares its value to <b>&lt;val&gt;</b>, and then uses <b>&lt;cond&gt;</b> to decide whether to set condition mode to false. When condition is false, execution of some tracker commands is disabled. To read more about this, see <a href="#part7">part 7</a>. Below is a table of all valid conditions:
	</p>
	<ul>
		<li><b>$00, dcoT</b> — Sets condition to true regardless.</li>
		<li><b>$01, dcoF</b> — Sets condition to false regardless.</li>
		<li><b>$02, dcoHI</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than the communications value. This is an unsigned comparison.</li>
		<li><b>$03, dcoLS</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than the communications value. This is an unsigned comparison.</li>
		<li><b>$04, dcoHS</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than or equal as the communications value. This is an unsigned comparison.</li>
		<li><b>$04, dcoCC</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in carry being clear.</li>
		<li><b>$05, dcoLO</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than or equal as the communications value. This is an unsigned comparison.</li>
		<li><b>$05, dcoCS</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in carry being set.</li>
		<li><b>$06, dcoNE</b> — Sets condition to true, if <b>&lt;val&gt;</b> does not equal the communications value.</li>
		<li><b>$07, dcoEQ</b> — Sets condition to true, if <b>&lt;val&gt;</b> does equal the communications value.</li>
		<li><b>$08, dcoVC</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in overflow being clear.</li>
		<li><b>$09, dcoVS</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in overflow being set.</li>
		<li><b>$0A, dcoPL</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in a positive value.</li>
		<li><b>$0B, dcoMI</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in a negative value.</li>
		<li><b>$0C, dcoGE</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than or equal as the communications value. This is a signed comparison.</li>
		<li><b>$0D, dcoLT</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than the communications value. This is a signed comparison.</li>
		<li><b>$0E, dcoGT</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than the communications value. This is a signed comparison.</li>
		<li><b>$0F, dcoLE</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than or equal as the communications value. This is a signed comparison.</li>
	</ul>
	<h4 id="cmdFC"><a class="bx" href="#cmdFC">$FC — sCondOff</a></h4>
	<p>
		Sets condition to true.
	</p>
	<h4 id="cmdFD"><a class="bx" href="#cmdFD">$FD — sGate &lt;frames&gt;</a></h4>
	<p>
		Sets the gate timeout to <b>&lt;frames&gt;</b>. Value of 0 disables this effect. Gate cuts the sound out after a specific number of frames (not ticks!), commencing regular note off behaviour for the channel. This is very useful when you have a lot of notes that should stop few frames/ticks before the actual note length. Instead of placing a bunch of notes with delays, and rests with delays, you can optimize it to use sGate instead. Not only is this faster, but also more space-efficient. This command is not available for sound effects, and trying to use it is considered undefined behaviour. This command is skipped when condition is false.
	</p>
	<h4 id="cmdFE"><a class="bx" href="#cmdFE">$FE — sCmdYM &lt;reg&gt; &lt;val&gt;</a></h4>
	<p>
		Sends an YM command into YM2612. This command allows you to send any arbitrary YM2612 commands from the tracker. This command is somewhat dangerous as you can accidentally mess something up, so being extra careful is warranted. Additionally, your changes will NOT be saved, so if you use this in a channel that can be interrupted by sound effects, by the time it is no longer interrupted, the changes you've made are lost forever. This is why you should make only non-essential changes for these FM channels. The <b>&lt;reg&gt;</b> parameter is used to choose the YM2612 register to write to, while <b>&lt;val&gt;</b> is loaded into it. For channel-specific registers, the channel type is also added into it, so you can always get the correct register you want. This happens for registers $30 to $A7 and $A8 tp $FF. Attempting to write to another channels registers is considered undefined behaviour. Additionally, using this command from DAC and PSG channels are considered undefined behaviour. For a breakdown of what each register does, <a href="https://www.smspower.org/maxim/Documents/YM2612">read this page</a>. This command is skipped when condition is false.
	</p>
	<h4>$FF — META</h4>
	<p>
		Reads the next byte from the tracker, and calls the following list of commands by that byte. The values are always multiples of 4 to make the code faster.
	</p>
	<h4 id="cmdFF00"><a class="bx" href="#cmdFF00">$FF $00 — sModOn</a></h4>
	<p>
		Enables modulation. Unless modulation was initialized before using sModAMPS, using this command is considered undefined behaviour.
	</p>
	<h4 id="cmdFF04"><a class="bx" href="#cmdFF04">$FF $04 — sModOff</a></h4>
	<p>
		Disables modulation. The modulation data is still kept, but no modulation will take place until it is enabled again.
	</p>
	<h4 id="cmdFF08"><a class="bx" href="#cmdFF08">$FF $08 — ssFreq &lt;freq&gt;</a></h4>
	<p>
		Sets the channel frequency to 16-bit value <b>&lt;freq&gt;</b>. This is only useful when a DAC channel is in sample mode, where you can use this command to set the precise frequency of the channel. In any other case, using this command is considered undefined behaviour.
	</p>
	<h4 id="cmdFF0C"><a class="bx" href="#cmdFF0C">$FF $0C — ssFreqNote &lt;note&gt;</a></h4>
	<p>
		Sets the channel frequency to the frequency represented by <b>&lt;note&gt;</b>. Channel transposition also is added to <b>&lt;note&gt;</b>. This is only useful when a DAC channel is in sample mode, where you can use this command to set the precise frequency of the channel. In any other case, using this command is considered undefined behaviour.
	</p>
	<h4 id="cmdFF10"><a class="bx" href="#cmdFF10">$FF $10 — sSpinRev</a></h4>
	<p>
		Increases spindash counter by 1, and adds the counter value to the transposition of the channel. Only really useful for making the spindash rev sound effect work.
	</p>
	<h4 id="cmdFF14"><a class="bx" href="#cmdFF14">$FF $14 — sSpinReset</a></h4>
	<p>
		Resets spindash counter. This is used by the spindash sound effect, and various other sound effects to reset the rev counter. This makes it behave like Sonic games. Really useful for making the spindash rev sound effect work.
	</p>
	<h4 id="cmdFF18"><a class="bx" href="#cmdFF18">$FF $18 — saTempoShoes &lt;tempo&gt;</a></h4>
	<p>
		Adds <b>&lt;tempo&gt;</b> to the speed shoes tempo. You can read more about tempos and how they work at <a href="#part3_1">part 3.1</a>.
	</p>
	<h4 id="cmdFF1C"><a class="bx" href="#cmdFF1C">$FF $1C — saTempo &lt;tempo&gt;</a></h4>
	<p>
		Adds <b>&lt;tempo&gt;</b> to the normal tempo. You can read more about tempos and how they work at <a href="#part3_1">part 3.1</a>.
	</p>
	<h4 id="cmdFF20"><a class="bx" href="#cmdFF20">$FF $20 — sCondReg &lt;index&gt; &lt;cond&gt; &lt;val&gt;</a></h4>
	<p>
		Checks the value of a RAM address indexed from a table (dcCondRegTable) at <b>&lt;index&gt;</b> against <b>&lt;val&gt;</b>. The command reads the byte at <b>&lt;index&gt;</b>, compares its value to <b>&lt;val&gt;</b>, and then uses <b>&lt;cond&gt;</b> to decide whether to set condition mode to false. When condition is false, execution of some tracker commands is disabled. To read more about this, see <a href="#part7">part 7</a>. Below is a table of all valid conditions:
	</p>
	<ul>
		<li><b>$00, dcoT</b> — Sets condition to true regardless.</li>
		<li><b>$01, dcoF</b> — Sets condition to false regardless.</li>
		<li><b>$02, dcoHI</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than the communications value. This is an unsigned comparison.</li>
		<li><b>$03, dcoLS</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than the communications value. This is an unsigned comparison.</li>
		<li><b>$04, dcoHS</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than or equal as the communications value. This is an unsigned comparison.</li>
		<li><b>$04, dcoCC</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in carry being clear.</li>
		<li><b>$05, dcoLO</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than or equal as the communications value. This is an unsigned comparison.</li>
		<li><b>$05, dcoCS</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in carry being set.</li>
		<li><b>$06, dcoNE</b> — Sets condition to true, if <b>&lt;val&gt;</b> does not equal the communications value.</li>
		<li><b>$07, dcoEQ</b> — Sets condition to true, if <b>&lt;val&gt;</b> does equal the communications value.</li>
		<li><b>$08, dcoVC</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in overflow being clear.</li>
		<li><b>$09, dcoVS</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in overflow being set.</li>
		<li><b>$0A, dcoPL</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in a positive value.</li>
		<li><b>$0B, dcoMI</b> — Sets condition to true, when subtracting <b>&lt;val&gt;</b> from the communications value results in a negative value.</li>
		<li><b>$0C, dcoGE</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than or equal as the communications value. This is a signed comparison.</li>
		<li><b>$0D, dcoLT</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than the communications value. This is a signed comparison.</li>
		<li><b>$0E, dcoGT</b> — Sets condition to true, if <b>&lt;val&gt;</b> is greater than the communications value. This is a signed comparison.</li>
		<li><b>$0F, dcoLE</b> — Sets condition to true, if <b>&lt;val&gt;</b> is lower than or equal as the communications value. This is a signed comparison.</li>
	</ul>
	<h4 id="cmdFF24"><a class="bx" href="#cmdFF24">$FF $24 — sPlayMus &lt;id&gt;</a></h4>
	<p>
		Is used to play sound effects from tracker. The sound effect <b>&lt;id&gt;</b> will be placed in the first queue slot. Unless it is overridden before the next frame, it will be played.
	</p>
	<h4 id="cmdFF28"><a class="bx" href="#cmdFF28">$FF $28 — ssModFreq &lt;freq&gt;</a></h4>
	<p>
		Sets modulation frequency offset to 16-bit value <b>&lt;freq&gt;</b>. This allows to make more interesting or complex modulation patterns.
	</p>
	<h4 id="cmdFF2C"><a class="bx" href="#cmdFF2C">$FF $2C — sModReset</a></h4>
	<p>
		This command does the same as when note is played, where modulation parameters are loaded from the last sModAMPS command, and initialized. This is only really useful when notes are held, but this behaviour should be preserved, because as of v2.1, this does not happen in sModAMPS command anymore. This command replaces that behaviour.
	</p>
	<h4 id="cmdFF30"><a class="bx" href="#cmdFF30">$FF $30 — sSpecFM3</a></h4>
	<p>
		Not implemented.
	</p>
	<h4 id="cmdFF34"><a class="bx" href="#cmdFF34">$FF $34 — ssFilter &lt;bank&gt;</a></h4>
	<p>
		Sets the Dual PCM volume filter bank address to <b>&lt;bank&gt;</b>. Volume filters allow PCM to sound different by replacing actual PCM values with values from the volume table. Each volume filter is $8000 bytes, where there are $80 volume levels with $100 possible values for each (for 8-bit PCM audio). By default, AMPS uses the logarithmic volume filter. Warning: AMPS has no logic to change volume filters by itself, and can only do using this command. This means, any sound effects or song changes may break things. Use this command with caution.
	</p>
	<h4 id="cmdFF38"><a class="bx" href="#cmdFF38">$FF $38 — sBackup</a></h4>
	<p>
		Stops the current music from playing, and if a song was backed up, loads it instead and start a fade in. When a song that enables the back-up flag is played, AMPS moves the old song data into another memory location before loading the song in. sBackup does the opposite, loading the song data from the memory location into active channel memory. It also initializes the hardware to continue correctly from where it left off. Fade in is done to make the transition easier, and to hide some of the sound oddities that can happen whenever this is done. Backing up songs is very useful when you have temporary songs that need to play, such as the 1UP music from Sonic games. This is only available if FEATURE_BACKUP is enabled. Otherwise, it is considered undefined behaviour.
	</p>
	<h4 id="cmdFF3C"><a class="bx" href="#cmdFF3C">$FF $3C — sNoisePSG &lt;mode&gt;</a></h4>
	<p>
		Is used to set the PSG4 noise mode. PSG4 noise is useful for creating hi-hat-like effects. There are additional modes that generate different kind of noise. The command sends the PSG command <b>&lt;mode&gt;</b> into the PSG, and sets the channel mode to PSG4, muting PSG3. Additionally, using value 0 disables this effect and restores the channel to PSG3. This is only valid for PSG3 and PSG3 SFX channels.
	</p>
	<h4 id="cmdFF40"><a class="bx" href="#cmdFF40">$FF $40 — sFreeze</a></h4>
	<p>
		Freezes the 68k whenever this tracker command is read. It will also allow you to step over the instruction into an rts. This is very useful for debugging the 68k code at the specific position. Only available in safe mode, it is ignored in normal mode.
	</p>
	<h4 id="cmdFF44"><a class="bx" href="#cmdFF44">$FF $44 — sCheck</a></h4>
	<p>
		When the entire sound driver has executed, it will bring up the debugger and show various statistics about AMPS. Useful for debugging something possibly going wrong with the sound effects, music, other aspects of AMPS, or the programming itself. Only available in safe mode, it is ignored in normal mode.
	</p>

	<h3 id="part4_3" class="bd"><a class="bx" href="#part4_3">4.3 — SN76496</a></h3>
	<p>
		The SN76496, better known as PSG, is the simplest sound chip on the Mega Drive. It really only has the capability to control volume, frequency, and channel 4 noise. Although the chip is hilariously barebones, it can still be used to generate really interesting sounds. PSG is a square wave generator chip, which means that each noise goes from mute to max volume nearly instantly. Due to limitations with filtering and the sound chip itself, it looks less like a square and more of a spiky square-like structure. The details are not overly important, and <a href="https://www.smspower.org/Development/SN76489">you can read more in detail about PSG here</a>. What really is important, is how AMPS interacts with the PSG chip.
	</p>
	<p>
		Although PSG has 4 channels, AMPS only supports 3 at a time. AMPS can switch between PSG3 or PSG4 mode for PSG3 channel. PSG3 mode is a normal tone channel, much like PSG1 and PSG2. This does not allow PSG4 to be used (though if you REALLY wanted you could do it - please don't), but is very good if you dont need it anyway. Since PSG4 allows for relatively unconvincing but reasonable hats, using PSG4 mode is more common. In this mode, PSG4 can use one of a few settings to enable noise. Below is a list of the PSG commands and their meanings:
	</p>
	<table border="1">
		<tr><td>PSG command</td><td>$E0</td><td>$E1</td><td>$E2</td><td>$E3</td><td>$E4</td><td>$E5</td><td>$E6</td><td>$E7</td></tr>
		<tr><td>Equate name</td><td>snPeri10</td><td>snPeri20</td><td>snPeri40</td><td>snPeriPSG3</td><td>snWhite10</td><td>snWhite20</td><td>snWhite40</td><td>snWhitePSG3</td></tr>
		<tr><td>Mode</td><td colspan="4">Periodic noise</td><td colspan="4">White noise</td></tr>
		<tr><td>Frequency</td><td>$0010</td><td>$0020</td><td>$0040</td><td>PSG3</td><td>$0010</td><td>$0020</td><td>$0040</td><td>PSG3</td></tr>
	</table>
	<p>
		Most commonly, PSG4 mode is used for songs, to add some extra depth. In AMPS, you can also enable and disable PSG4 mode with the sNoisePSG command. Using values on the table above you can enable it for the specific mode, and using $00 disables it. PSG4 has its own channel volume, but in case of using PSG3 mode, it does not have its own frequency. This is particularly problematic because usually PSG hi-hats use frequency $0000, which is not pre-defined in the modes. It is possible to use another frequency instead and also use PSG3 at the same time, allowing PSG to output 4 different sounds at once, but currently AMPS does not have support for that. Both sound effects and music can use PSG4 mode, and it will be correctly restored when sound effects end.
	</p>
	<p>
		PSG has a very small range of possible frequencies. Though this does not usually present an issue, the range of notes available in AMPS is limited. Below is a table of all notes, their raw values, and frequencies. There is also a special equate in AMPS, nHiHat, that corresponds to nBb6 so long as there is no transposition.
	</p>
	<table border="1">
		<tr><td>octave</td><td>nC</td><td>nCs</td><td>nD</td><td>nEb</td><td>nE</td><td>nF</td><td>nFs</td><td>nG</td><td>nAb</td><td>nA</td><td>nBb</td><td>nB</td></tr>
<tr><td>0</td><td>$81, $03FF</td><td>$82, $03FF</td><td>$83, $03FF</td><td>$84, $03FF</td><td>$85, $03FF</td><td>$86, $03FF</td><td>$87, $03FF</td><td>$88, $03FF</td><td>$89, $03FF</td><td>$8A, $03F7</td><td>$8B, $03BE</td><td>$8C, $0388</td></tr>
<tr><td>1</td><td>$8D, $0356</td><td>$8E, $0326</td><td>$8F, $02F9</td><td>$90, $02CE</td><td>$91, $02A5</td><td>$92, $0280</td><td>$93, $025C</td><td>$94, $023A</td><td>$95, $021A</td><td>$96, $01FB</td><td>$97, $01DF</td><td>$98, $01C4</td></tr>
<tr><td>2</td><td>$99, $01AB</td><td>$9A, $0193</td><td>$9B, $017D</td><td>$9C, $0167</td><td>$9D, $0153</td><td>$9E, $0140</td><td>$9F, $012E</td><td>$A0, $011D</td><td>$A1, $010D</td><td>$A2, $00FE</td><td>$A3, $00EF</td><td>$A4, $00E2</td></tr>
<tr><td>3</td><td>$A5, $00D6</td><td>$A6, $00C9</td><td>$A7, $00BE</td><td>$A8, $00B4</td><td>$A9, $00A9</td><td>$AA, $00A0</td><td>$AB, $0097</td><td>$AC, $008F</td><td>$AD, $0087</td><td>$AE, $007F</td><td>$AF, $0078</td><td>$B0, $0071</td></tr>
<tr><td>4</td><td>$B1, $006B</td><td>$B2, $0065</td><td>$B3, $005F</td><td>$B4, $005A</td><td>$B5, $0055</td><td>$B6, $0050</td><td>$B7, $004B</td><td>$B8, $0047</td><td>$B9, $0043</td><td>$BA, $0040</td><td>$BB, $003C</td><td>$BC, $0039</td></tr>
<tr><td>5</td><td>$BD, $0036</td><td>$BE, $0033</td><td>$BF, $0030</td><td>$C0, $002D</td><td>$C1, $002B</td><td>$C2, $0028</td><td>$C3, $0026</td><td>$C4, $0024</td><td>$C5, $0022</td><td>$C6, $0020</td><td>$C7, $001F</td><td>$C8, $001D</td></tr>
<tr><td>6</td><td>$C9, $001B</td><td>$CA, $001A</td><td>$CB, $0018</td><td>$CC, $0017</td><td>$CD, $0016</td><td>$CE, $0015</td><td>$CF, $0013</td><td>$D0, $0012</td><td>$D1, $0011</td><td>$D2, $0010</td><td>$D3, $0000</td><td></td></tr>
	</table>
	<p>
		Each of these notes can be converted to the following format: xy, where x is the identifier of the note (for example nEb), and y is the octave (for example 4). This would result in equate nEb4, which can directly be used in tracker. These note names are largely arbitrary and only theoretically correspond to real instruments. Indeed, many other sound drivers on the Mega Drive have different frequencies for the notes anyway. These frequencies and notes are heavily based on Sound-Source for consistency's sake, and for no real need to change them.
	</p>
	<p>
		PSG uses a 7-bit volume in AMPS as opposed to 4-bit that the SN76496 uses. This is to make PSG more aligned with FM and DAC, but at the cost of making the PSG volumes not match hardware levels. AMPS lazily converts the volume simply by dividing by 8, which results in a difference to the volume curve, but is accurate enough to work. There is also special behaviour with frequency of PSG, where you can disable safety measures intended to stop invalid frequencies being loaded. This is, oddly, necessary for the insta-shield sound effect in Sonic 3 & Knuckles! The problem with not capping the frequency is that it can write commands instead of frequencies into PSG, leading to undefined behaviour. For whatever reason, this does not seem to break anything. It is still not recommended to be used for any other reason!
	</p>
	<h3 id="part4_4" class="bd"><a class="bx" href="#part4_4">4.4 — YM2612</a></h3>
	<p>
		The YM2612, also referred to as FM (frequency modulation), is the more complex sound chip in the Mega Drive. It is used to produce most sounds, as it has the most channels and the most rich sound output. It allows for a large number of parameters that change how music sounds, and more complex sinewave mixing. Although there could be a lot said about it, <a href="https://segaretro.org/YM2612">there are already a lot of documentation out there</a>. Instead, how FM works within AMPS is more important for this document.
	</p>
	<p>
		AMPS has support for all 6 channels at once, even while DAC is playing. Although, when DAC is not playing the mute sample (if the sample itself is mute, it does NOT count!), FM6 will be automatically disabled. Dual PCM is responsible for this, which means the enabling/disabling happens immediately, not at the end of the frame. In theory, this should never lead to artifacts in sound, but it can sound weird if samples go in and out all the time. You need to enable FEATURE_FM6 in order to use FM6. Additionally, panning in FM6 is currently not implemented correctly. It overrides panning for both DAC channels, and vice versa too. The results of that are considered undefined behaviour, so panning on FM6 is not recommended.
	</p>
	<p id="part_4_41">
		AMPS uses FM voice tables to load FM instruments. Music has a single table for all its channels, and sound effects use a common table for all voices. Unlike in Sound-Source, AMPS uses a more efficient format where loading any voice is as fast as any other. Therefore, a global voice table for sound effects actually improves performance overall. Instruments can be given unique names so that removing or adding them can be done without breaking anything. The global voice table for sound effects is in <b>Voices.S2A</b>. Below is an example of a voice, along with the more common names for each parameter:
	</p>
	<smps2asm>	<cmt>; Voice $00</cmt>
	<mac>spAlgorithm</mac>	<val>$04</val>, <lbl>Rings</lbl>					<cmt>; Algorithm. The second parameter defines the name, in this case, pRings</cmt>
	<mac>spFeedback</mac>	<val>$00</val>						<cmt>; Feedback</cmt>
	<mac>spDetune</mac>	<val>$03</val>, <val>$07</val>, <val>$07</val>, <val>$04</val>				<cmt>; Detune</cmt>
	<mac>spMultiple</mac>	<val>$07</val>, <val>$07</val>, <val>$02</val>, <val>$09</val>				<cmt>; Multiple</cmt>
	<mac>spRateScale</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>				<cmt>; Rate Scaling</cmt>
	<mac>spAttackRt</mac>	<val>$1F</val>, <val>$1F</val>, <val>$1F</val>, <val>$1F</val>				<cmt>; Attack Rate</cmt>
	<mac>spAmpMod</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>				<cmt>; Amplitude Modulation</cmt>
	<mac>spSustainRt</mac>	<val>$07</val>, <val>$07</val>, <val>$0A</val>, <val>$0D</val>				<cmt>; First Decay Rate; Decay 1 Rate</cmt>
	<mac>spSustainLv</mac>	<val>$01</val>, <val>$01</val>, <val>$00</val>, <val>$00</val>				<cmt>; Secondary Amplitude; Decay Level</cmt>
	<mac>spDecayRt</mac>	<val>$00</val>, <val>$00</val>, <val>$0B</val>, <val>$0B</val>				<cmt>; Second Decay Rate; Decay 2 Rate</cmt>
	<mac>spReleaseRt</mac>	<val>$0F</val>, <val>$0F</val>, <val>$0F</val>, <val>$0F</val>				<cmt>; Release Rate</cmt>
	<mac>spSSGEG</mac>		<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>				<cmt>; SSG-EG. This was introduced in AMPS.</cmt>
	<mac>spTotalLv</mac>	<val>$23</val>, <val>$23</val>, <val>$00</val>, <val>$00</val>				<cmt>; Total Level</cmt></smps2asm>
	<p>
		Each voice in AMPS is 32 bytes in size, and has 3 unused bytes. This is done for the sake of alignment and efficiency. The above parameters are used to define each instrument, and they are sent to YM2612 via Dual PCM. This means, that the timings between voices and notes are different to Sound-Source and therefore some things will sound different. This sometimes causes perfectly good sound effects from Sound-Source games to sound absolute trash in AMPS. This is largely unavoidable and there seems to be no real solution to this issue. Potential fixes are being investigated but there is no guarantee for it.
	</p>
	<p>
		FM has $80 total volume levels per operator and depending on the algorithm, different operators act as the volume (slot operators), and others as modulators (nonslot operators). SMPS2ASM will correctly tell AMPS which operators are used for which purpose, but this can be changed by the programmer if they wish to have different behaviour. It is not recommended, unless the programmer knows what they are doing. All the slot operators can have different total level values, as they are simply just added into the calculated volume. Additionally, <a href="#part6_2">underwater mode</a> changes the slot and nonslot total levels too.
	</p>
	<p>
		You can send arbitrary YM2612 commands from tracker as well. This is useful for editing single instrument parameters or doing some more uncommon tricks. This is dangerous, because if a sound effect interrupts the channel, all your changes are lost. Indeed, relying on changes to stick is a terrible idea. Additionally, songs that use the backup system will also make these changes be lost, this time in every FM channel. Some other settings, such as LFO, will neither stick around correctly. However, because SSG-EG is in the instrument data, it will always be restored.
	</p>
	<p>
		YM2612 has an interesting frequency range. It has frequencies from $000 to $7FF, and octaves from $00xx to $38xx. Each octave, well, is an octave higher than the previous. However, the frequency between octaves also has some overlap. A lower octave frequency may sound the same as higher octave frequency, but earlier from the frequency range. To put it more simply, $4C0 may sound the same as $A5C. The point where this happens precisely is not known yet, but the estimate provided is close enough. Below is a table of all notes, their raw values, and frequencies.
	</p>

	<table border="1">
		<tr><td>octave</td><td>nC</td><td>nCs</td><td>nD</td><td>nEb</td><td>nE</td><td>nF</td><td>nFs</td><td>nG</td><td>nAb</td><td>nA</td><td>nBb</td><td>nB</td></tr>
<tr><td>-1</td><td colspan="11"></td><td>$80, $025E</td></tr>
<tr><td>0</td><td>$81, $0284</td><td>$82, $02AB</td><td>$83, $02D3</td><td>$84, $02FE</td><td>$85, $032D</td><td>$86, $035C</td><td>$87, $038F</td><td>$88, $03C5</td><td>$89, $03FF</td><td>$8A, $043C</td><td>$8B, $047C</td><td>$8C, $0A5E</td></tr>
<tr><td>1</td><td>$8D, $0A84</td><td>$8E, $0AAB</td><td>$8F, $0AD3</td><td>$90, $0AFE</td><td>$91, $0B2D</td><td>$92, $0B5C</td><td>$93, $0B8F</td><td>$94, $0BC5</td><td>$95, $0BFF</td><td>$96, $0C3C</td><td>$97, $0C7C</td><td>$98, $125E</td></tr>
<tr><td>2</td><td>$99, $1284</td><td>$9A, $12AB</td><td>$9B, $12D3</td><td>$9C, $12FE</td><td>$9D, $132D</td><td>$9E, $135C</td><td>$9F, $138F</td><td>$A0, $13C5</td><td>$A1, $13FF</td><td>$A2, $143C</td><td>$A3, $147C</td><td>$A4, $1A5E</td></tr>
<tr><td>3</td><td>$A5, $1A84</td><td>$A6, $1AAB</td><td>$A7, $1AD3</td><td>$A8, $1AFE</td><td>$A9, $1B2D</td><td>$AA, $1B5C</td><td>$AB, $1B8F</td><td>$AC, $1BC5</td><td>$AD, $1BFF</td><td>$AE, $1C3C</td><td>$AF, $1C7C</td><td>$B0, $225E</td></tr>
<tr><td>4</td><td>$B1, $2284</td><td>$B2, $22AB</td><td>$B3, $22D3</td><td>$B4, $22FE</td><td>$B5, $232D</td><td>$B6, $235C</td><td>$B7, $238F</td><td>$B8, $23C5</td><td>$B9, $23FF</td><td>$BA, $243C</td><td>$BB, $247C</td><td>$BC, $2A5E</td></tr>
<tr><td>5</td><td>$BD, $2A84</td><td>$BE, $2AAB</td><td>$BF, $2AD3</td><td>$C0, $2AFE</td><td>$C1, $2B2D</td><td>$C2, $2B5C</td><td>$C3, $2B8F</td><td>$C4, $2BC5</td><td>$C5, $2BFF</td><td>$C6, $2C3C</td><td>$C7, $2C7C</td><td>$C8, $325E</td></tr>
<tr><td>6</td><td>$C9, $3284</td><td>$CA, $32AB</td><td>$CB, $32D3</td><td>$CC, $32FE</td><td>$CD, $332D</td><td>$CE, $335C</td><td>$CF, $338F</td><td>$D0, $33C5</td><td>$D1, $33FF</td><td>$D2, $343C</td><td>$D3, $347C</td><td>$D4, $3A5E</td></tr>
<tr><td>7</td><td>$D5, $3A84</td><td>$D6, $3AAB</td><td>$D7, $3AD3</td><td>$D8, $3AFE</td><td>$D9, $3B2D</td><td>$DA, $3B5C</td><td>$DB, $3B8F</td><td>$DC, $3BC5</td><td>$DD, $3BFF</td><td>$DE, $3C3C</td><td>$DF, $3C7C</td><td></td></tr>
	</table>

	<h3 id="part4_5" class="bd"><a class="bx" href="#part4_5">4.5 — Dual PCM</a></h3>
	<p>
		Dual PCM FlexEd is not an actual sound chip, but rather a piece of software that is responsible for dealing with PCM audio and YM2612 commands. Dual PCM is heavily integrated with AMPS to give the best possible user experience. It allows playing back 2 PCM samples at once, with the ability to change pitch and volume as well. Although Dual PCM is "only" approximately 14KHz 8-bit PCM audio per channel, it still leads to excellent audio quality. <a href="Dual PCM - FlexEd (Technical Document).pdf" target="_blank">There is in-depth documentation available for Dual PCM</a>, so I will not dive too deeply into how it works. Instead, I will focus more on how AMPS interacts with it.
	</p>
	<p>
		Dual PCM uses SWF format for samples. This is a custom PCM format specifically for use with Dual PCM. AMPS stores raw samples in the <b>dac</b> folder, and <b>ConvPCM.exe</b> is used to convert general sample formats to SWF. After this, SWF files should be stored in <b>dac/incSWF</b>. AMPS will access files from there. Samples are included in <b>code/Data.asm</b>, at the bottom of the file. There should be a bunch of <b>incSWF</b> statements with names on them. These are file names of the individual samples. They should only contain A-Z, a-z, 0-9 and _, otherwise they won't be assembled correctly. AMPS will generate the necessary structures to include the file into the disassembly. You need to add samples into the bottom of the file before you can use them in your trackers. Also, you need to define data for them. At SampleList, you will see a list of defined tracker samples. These define the settings and names for the samples. Here is an example:
	</p>
	<asm>	<mac>sample</mac> <val>$0180</val>, <equ>Tom</equ>, <equ>Stop</equ>, <equ>HiTom</equ>		<cmt>; High Tom</cmt></asm>
	<p>
		This defines a sample, with equate name <b>dHiTom</b>, with base frequency of $180. This frequency is added to calculated frequency whenever it is updated. Frequency of $0100 is the neutral frequency, where the sample speed/frequency is at 100%. The higher the frequency goes, the faster the sample is, same for lower. Negative values make it go backwards (from the end to start). The sample name <b>Tom</b> is loaded from memory to start the sample, and the sample <b>Stop</b> is loaded as the looping point. This makes the Tom sample play fully before the sound is stopped. You could insert another sample as the loop sample, and you'd get an infinitely looping sample (so long as a note is played, that is). Defining a 3rd name, in this case <b>HiTom</b> is not required. Omitting it means the first name, <b>Tom</b> in this case, uses that name for the sample equate. That would result in <b>dTom</b>. Here is an example of that:
	</p>
	<asm>	<mac>sample</mac> <val>$0100</val>, <equ>Tom</equ>, <equ>Stop</equ>			<cmt>; Mid Tom</cmt></asm>
	<p>
		The looping happens internally in Dual PCM rather than with AMPS, so it can be very useful for creating samples that repeat in quicker than per frame. Making the samples too short will lead to a lot of quality loss, so sometimes repeating the sample data a few times is a good idea. Adding a lot of blank space at the end of the sample can inflate the ROM size however, so use these tricks very carefully.
	</p>
	<p>
		DAC channels have 2 modes: Sample mode and pitch mode. These can be selected using tracker commands sModeSampDAC and sModePitchDAC. In sample mode, each note represents a sample to be used at the current channel pitch. AMPS will also remember what sample was last used and it will work like channels normally with the exception that you're changing the sample, not the pitch. Pitch mode is how channels work normally, every note represents a frequency from the frequency table. The last used sample is used to play the new note. You can use sVoice to change the sample in pitch mode, and ssFreq & ssFreqNote to change the frequency of the channel in sample mode.
	</p>
	<p>
		Panning for DAC channels is bit of an exception. The 2 currently active channels add the panning value together to get the final value. If SFX DAC1 channel is active, it will override DAC1. If one channel is panned to the centre and other is to left, the panning will be centre anyway. It is a good idea to pan one channel to none and the other controls panning for both. This may be a problem when using SFX DAC1, as it cannot be guaranteed to have control over panning and may cause music to sound strange. You should be careful when using panning like this.
	</p>
	<p>
		Dual PCM has $80 volume levels for samples, and it uses a table to load these volumes from. AMPS by default comes equipped with a logarithmic volume filter that mimics the perceived volume levels of YM2612 as closely as possible. It will never be a perfect match but its usually not noticeable. AMPS also includes a linear volume table but using this isn't really recommended. You can also create custom tables and use them with AMPS, but this is not properly supported at the moment, and you'd have to figure it out yourself. Because of limitations with Dual PCM, attempting to update volume more often than every 4 frames will lead to quality loss. In AMPS, this is done by wrapping the PCM buffers when they run out of data, so that a part of the PCM data will play twice over. This has been considered less distracting than stopping the sample playback outright. This is a good idea to remember for channel volumes, volume fading, volume envelopes and others.
	</p>
	<p>
		DAC has a wide range of possible frequencies, including backwards frequencies. Many of these frequencies are not particularly useful, because they go quite fast, but they are included because someone might find them useful or cool to experiment with. The frequency table is $100 elements long, so any note and transposition value can be used. This is done mostly to support the backwards frequencies correctly. It is technically possible to go over $FFF or below -$FFF in frequency, but this is not supported by the Dual PCM configuration and may lead to glitches. Below is a table of all notes, their raw values, and frequencies:
	</p>
	<table border="1">
		<tr><td>octave</td><td>nC</td><td>nCs</td><td>nD</td><td>nEb</td><td>nE</td><td>nF</td><td>nFs</td><td>nG</td><td>nAb</td><td>nA</td><td>nBb</td><td>nB</td></tr>
<tr><td>?</td><td colspan="11"></td><td>$80, $0000</td></tr>
<tr><td>0</td><td>$81, $0010</td><td>$82, $0011</td><td>$83, $0012</td><td>$84, $0013</td><td>$85, $0014</td><td>$86, $0015</td><td>$87, $0017</td><td>$88, $0018</td><td>$89, $0019</td><td>$8A, $001B</td><td>$8B, $001D</td><td>$8C, $001E</td></tr>
<tr><td>1</td><td>$8D, $0020</td><td>$8E, $0022</td><td>$8F, $0024</td><td>$90, $0026</td><td>$91, $0028</td><td>$92, $002B</td><td>$93, $002D</td><td>$94, $0030</td><td>$95, $0033</td><td>$96, $0036</td><td>$97, $0039</td><td>$98, $003C</td></tr>
<tr><td>2</td><td>$99, $0040</td><td>$9A, $0044</td><td>$9B, $0048</td><td>$9C, $004C</td><td>$9D, $0051</td><td>$9E, $0055</td><td>$9F, $005B</td><td>$A0, $0060</td><td>$A1, $0066</td><td>$A2, $006C</td><td>$A3, $0072</td><td>$A4, $0079</td></tr>
<tr><td>3</td><td>$A5, $0080</td><td>$A6, $0088</td><td>$A7, $0090</td><td>$A8, $0098</td><td>$A9, $00A1</td><td>$AA, $00AB</td><td>$AB, $00B5</td><td>$AC, $00C0</td><td>$AD, $00CB</td><td>$AE, $00D7</td><td>$AF, $00E4</td><td>$B0, $00F2</td></tr>
<tr><td>4</td><td>$B1, $0100</td><td>$B2, $010F</td><td>$B3, $011F</td><td>$B4, $0130</td><td>$B5, $0143</td><td>$B6, $0156</td><td>$B7, $016A</td><td>$B8, $0180</td><td>$B9, $0196</td><td>$BA, $01AF</td><td>$BB, $01C8</td><td>$BC, $01E3</td></tr>
<tr><td>5</td><td>$BD, $0200</td><td>$BE, $021E</td><td>$BF, $023F</td><td>$C0, $0261</td><td>$C1, $0285</td><td>$C2, $02AB</td><td>$C3, $02D4</td><td>$C4, $02FF</td><td>$C5, $032D</td><td>$C6, $035D</td><td>$C7, $0390</td><td>$C8, $03C7</td></tr>
<tr><td>6</td><td>$C9, $0400</td><td>$CA, $043D</td><td>$CB, $047D</td><td>$CC, $04C2</td><td>$CD, $050A</td><td>$CE, $0557</td><td>$CF, $05A8</td><td>$D0, $05FE</td><td>$D1, $0659</td><td>$D2, $06BA</td><td>$D3, $0721</td><td>$D4, $078D</td></tr>
<tr><td>7</td><td>$D5, $0800</td><td>$D6, $087A</td><td>$D7, $08FB</td><td>$D8, $0983</td><td>$D9, $0A14</td><td>$DA, $0AAE</td><td>$DB, $0B50</td><td>$DC, $0BFD</td><td>$DD, $0CB3</td><td>$DE, $0D74</td><td>$DF, $0E41</td><td>$E0, $0F1A</td></tr>
<tr><td>8</td><td>$E1, $0FFF</td><td>$E2, $0FFF</td><td>$E3, $0FFF</td><td>$E4, $0FFF</td><td>$E5, $0FFF</td><td>$E6, $0FFF</td><td>$E7, $0FFF</td><td>$E8, $0FFF</td><td>$E9, $0FFF</td><td>$EA, $0FFF</td><td>$EB, $0FFF</td><td>$EC, $0FFF</td></tr>
<tr><td>9</td><td>$ED, $0FFF</td><td>$EE, $0FFF</td><td>$EF, $0FFF</td><td>$F0, $0FFF</td><td>$F1, $0FFF</td><td>$F2, $0FFF</td><td>$F3, $0FFF</td><td>$F4, $0FFF</td><td>$F5, $0FFF</td><td>$F6, $0FFF</td><td>$F7, $0FFF</td><td>$F8, $0FFF</td></tr>
<tr><td>10</td><td>$F9, $0FFF</td><td>$FA, $0FFF</td><td>$FB, $0FFF</td><td>$FC, $0FFF</td><td>$FD, $0FFF</td><td>$FE, $0FFF</td><td>$FF, $0FFF</td><td colspan="5"></td></tr>
<tr><td>-10</td><td colspan="4"></td><td>$00, -$FFF</td><td>$01, -$FFF</td><td>$02, -$FFF</td><td>$03, -$FFF</td><td>$04, -$FFF</td><td>$05, -$FFF</td><td>$06, -$FFF</td><td>$07, -$FFF</td></tr>
<tr><td>-9</td><td>$08, -$FFF</td><td>$09, -$FFF</td><td>$0A, -$FFF</td><td>$0B, -$FFF</td><td>$0C, -$FFF</td><td>$0D, -$FFF</td><td>$0E, -$FFF</td><td>$0F, -$FFF</td><td>$10, -$FFF</td><td>$11, -$FFF</td><td>$12, -$FFF</td><td>$13, -$FFF</td></tr>
<tr><td>-8</td><td>$14, -$FFF</td><td>$15, -$FFF</td><td>$16, -$FFF</td><td>$17, -$FFF</td><td>$18, -$FFF</td><td>$19, -$FFF</td><td>$1A, -$FFF</td><td>$1B, -$FFF</td><td>$1C, -$FFF</td><td>$1D, -$FFF</td><td>$1E, -$FFF</td><td>$1F, -$FFF</td></tr>
<tr><td>-7</td><td>$20, -$F1A</td><td>$21, -$E41</td><td>$22, -$D74</td><td>$23, -$CB3</td><td>$24, -$BFD</td><td>$25, -$B50</td><td>$26, -$AAE</td><td>$27, -$A14</td><td>$28, -$983</td><td>$29, -$8FB</td><td>$2A, -$87A</td><td>$2B, -$800</td></tr>
<tr><td>-6</td><td>$2C, -$78D</td><td>$2D, -$721</td><td>$2E, -$6BA</td><td>$2F, -$659</td><td>$30, -$5FE</td><td>$31, -$5A8</td><td>$32, -$557</td><td>$33, -$50A</td><td>$34, -$4C2</td><td>$35, -$47D</td><td>$36, -$43D</td><td>$37, -$400</td></tr>
<tr><td>-5</td><td>$38, -$3C7</td><td>$39, -$390</td><td>$3A, -$35D</td><td>$3B, -$32D</td><td>$3C, -$2FF</td><td>$3D, -$2D4</td><td>$3E, -$2AB</td><td>$3F, -$285</td><td>$40, -$261</td><td>$41, -$23F</td><td>$42, -$21E</td><td>$43, -$200</td></tr>
<tr><td>-4</td><td>$44, -$1E3</td><td>$45, -$1C8</td><td>$46, -$1AF</td><td>$47, -$196</td><td>$48, -$180</td><td>$49, -$16A</td><td>$4A, -$156</td><td>$4B, -$143</td><td>$4C, -$130</td><td>$4D, -$11F</td><td>$4E, -$10F</td><td>$4F, -$100</td></tr>
<tr><td>-3</td><td>$50, -$0F2</td><td>$51, -$0E4</td><td>$52, -$0D7</td><td>$53, -$0CB</td><td>$54, -$0C0</td><td>$55, -$0B5</td><td>$56, -$0AB</td><td>$57, -$0A1</td><td>$58, -$098</td><td>$59, -$090</td><td>$5A, -$088</td><td>$5B, -$080</td></tr>
<tr><td>-2</td><td>$5C, -$079</td><td>$5D, -$072</td><td>$5E, -$06C</td><td>$5F, -$066</td><td>$60, -$060</td><td>$61, -$05B</td><td>$62, -$055</td><td>$63, -$051</td><td>$64, -$04C</td><td>$65, -$048</td><td>$66, -$044</td><td>$67, -$040</td></tr>
<tr><td>-1</td><td>$68, -$03C</td><td>$69, -$039</td><td>$6A, -$036</td><td>$6B, -$033</td><td>$6C, -$030</td><td>$6D, -$02D</td><td>$6E, -$02B</td><td>$6F, -$028</td><td>$70, -$026</td><td>$71, -$024</td><td>$72, -$022</td><td>$73, -$020</td></tr>
<tr><td>-0</td><td>$74, -$01E</td><td>$75, -$01D</td><td>$76, -$01B</td><td>$77, -$019</td><td>$78, -$018</td><td>$79, -$017</td><td>$7A, -$015</td><td>$7B, -$014</td><td>$7C, -$013</td><td>$7D, -$012</td><td>$7E, -$011</td><td>$7F, -$010</td></tr>
	</table>
	<p>
		Each of these notes can be converted to the following format: xy, where x is the identifier of the note (for example nA), and y is the octave (for example 2). This would result in equate nA2, which can directly be used in tracker. These note names are largely arbitrary and only theoretically correspond to real instruments. Majority of these notes are only accessible with transposition. After all, you can only play $81 to $DF using the tracker by default. Although, with ssFreqNote, you can actually play any of these notes at any time in sample mode.
	</p>
	<h1 id="part5" class="bd"><a class="bx" href="#part5">5 — Frequency</a></h1>
	<p>
		In AMPS, frequency depends entirely on the sound hardware used. You can see the actual tables used in previous parts for <a href="#part4_4">FM</a>, <a href="#part4_3">PSG</a> and <a href="#part4_5">DAC</a>. This is why AMPS abstracts actual frequencies as notes, which are mostly consistent with each other. Transposition is also used to shift the notes around to read different entries from the frequency table. This is most useful for DAC which has negative frequencies not accessible otherwise. Attempting to read an invalid note from these tables is considered undefined behaviour. The frequency read along with detune is used to calculate the final frequency. Additionally, modulation, portamento and modulation envelope are added into the frequency every frame (when active).
	</p>

	<h3 id="part5_1" class="bd"><a class="bx" href="#part5_1">5.1 — Modulation</a></h3>
	<p>
		Software modulation in AMPS is similar but not quite the same to Sound-Source 68k and Sound-Source Z80. They have a slightly different algorithm to each other, and AMPS is also slightly different in other ways. The differences will be noted as I explain the algorithm. Modulation has 4 user-defined values: <b>wait</b>, <b>speed</b>, <b>step</b> and <b>count</b>. These help define the behaviour of the modulation process. There is also a flag that enables and disables modulation independent of setting it up, and can be controlled in tracker with sModOn and sModOff. These only set the state of the flag rather than modifying modulation data. Additionally, sModReset will forcibly reset modulation parameters immediately. ssModFreq can be used to set modulation frequency offset to a specific value. Below is the explanation of the algorithm:
	</p>
	<p>
		There can be some delay before the modulation starts. If <b>wait</b> is not 0, the modulation gets delayed by that many frames instead. The <b>speed</b> parameter defines how often modulation is stepped forwards. Value of $00 is invalid, and $01 is the minimum amount (gets stepped every frame). When a step occurs, <b>step</b> is added to the modulation frequency offset (which is later added to channel frequency!). This value is a signed 8-bit value, -$80 to $7F, and gets extended to a 16-bit value for the purposes of the frequency offset. This allows for a great dynamic frequency range with relatively little effort. There is also the <b>count</b> variable that is the number of steps. When modulation is initialized, this value is halved (rounded down) and set as the initial value. This allows the modulation to go back and forth around the channel frequency, however it doesn't have to. When <b>count</b> goes to 0, the modulation speed is negated, and <b>step</b> is reloaded. This makes the frequency offset go backwards, to approximately the negative value of it. There is an exception, if <b>count</b> parameter has value of $00, <b>step</b> is not negated.
	</p>
	<p>
		There are few interesting differences between Sound-Source versions and AMPS. In Sound-Source 68k, after the <b>count</b> and <b>step</b> parameters are reloaded, the rest of the modulation code is skipped. This includes decrementing the counter and processing frequency. This makes it so that the last step is 2 frames and the modulation is slightly longer. This can be simply fixed by adding 1 to the <b>count</b> parameter in your tracker code. Sound-Source Z80 is a bit more difficult. For some odd reason, it decrements modulation step counter every frame (after modulation wait delay has passed), and therefore can negate the direction even in the middle of the step. Also, the <b>step</b> parameter is therefore multiplied by the <b>speed</b> parameter. This is a problem particularly because its technically impossible to correctly recreate all modulation from Sound-Source Z80 games. In practice, this does not matter because you don't have to get the modulation matching 100% to be good enough.
	</p>
	<p>
		There is also a difference between how Sound-Source Z80 and Sound-Source 68k handle modulation when note is held. If the sModAMPS command (or driver equivalent) is used, Sound-Source 68k will immediately reload modulation parameters, also resetting modulation frequency offset. Sound-Source Z80 and AMPS do not do this, meaning that with sModAMPS, some values are reloaded and some are not. Sound-Source Z80 will not load any values, meaning that <b>wait</b> and <b>step</b> are ignored, <b>speed</b> and <b>count</b> are only reloaded when these values count down completely. In AMPS, <b>wait</b> and <b>step</b> are reloaded when the command is used. To help emulate Sound-Source 68k behaviour, sModReset can be used right after sModAMPS. There is an approximate tool to convert modulation between formats, <a href="#part11_1">click here</a>.
	</p>
	<h3 id="part5_2" class="bd"><a class="bx" href="#part5_2">5.2 — Portamento</a></h3>
	<p>
		Portamento is an effect which allows the frequency between notes to be blended smoothly over time. FEATURE_PORTAMENTO must be enabled to use the portamento effect. Portamento effect has a certain speed, where $00 disables the effect, any other number indicates the number of between frames that are used for blending. Portamento uses a displacement value for changing offset each frame, and a frequency offset that keeps track of how far from the current note the actual frequency is supposed to be. This works irrespective of any other frequency effects so the results are correct every time.
	</p>
	<p>
		The algorithm for portamento simply remembers the difference of the 2 notes, and calculates using the portamento value how much to change it per frame. The algorithm skips some frequency ranges for FM however, because they actually overlap. This makes the effect sound almost perfect. If the difference is too small, the difference is the smallest possible so the note does eventually change. Previous portamento offsets are also considered, so it is safe to change the note while portamento is in progress.
	</p>
	<p>
		Every frame, portamento is processed and calculated. The portamento displacement is added to portamento offset, until it is 0, or changes sign. At this point, portamento is disabled until next note-on. This process again skips the FM ranges that are equivalent. Portamento from or to rests is not possible.
	</p>

	<h1 id="part6" class="bd"><a class="bx" href="#part6">6 — Volume</a></h1>
	<p>
		Internally, AMPS uses 7-bit volume for all software channels. This makes the editing of volumes consistent between different sound hardware. This does mean, that PSG volume is actually multiples of 8 of the real hardware volume. AMPS lazily shifts it down instead of using a look-up-table to be more accurate. Volume levels go from $00 to $7F, where $00 is the loudest possible and $7F is muted. Internally, volume is calculated as 16-bit values, and any volume additions are treated as signed. The volumes outside of $00-$7F are changed to $00 for volumes above $8000 and $7F for below $7FFF. Volumes depend on the hardware and other settings so comparing volumes 1:1 between hardware types is difficult. The volume is merely a relative measure to help the programmer adjust the music to their liking. Volume is also useful to make music fade in/out easily.
	</p>
	<p>
		There are a few factors that come into the final volume. There is master volume for each hardware type (sound effects may ignore this depending in settings), per-channel volume, volume envelopes, and for FM channels, total level values too. Additionally, the PCM volume levels also affect DAC channels.
	</p>

	<h3 id="part6_1" class="bd"><a class="bx" href="#part6_1">6.1 — Channel Volumes</a></h3>
	<p>
		Channels exclusively handle the volume of hardware channels. Some code may mute the hardware channels, but if a volume needs to be updated, the channel will be requested to do it. This flag is used by the tracker, channel itself, and outside influences to correctly update the channel volume when required. This simplifies the complex process of volume updates. AMPS processes volume in the following order:
	</p>
	<ul>
		<li><b>channel volume</b> — Channel-specific volume. Can be used to easily change the volume of the sound but you have to be careful about it as well.</li>
		<li><b>master volume</b> — For all applicable channels, master volume is loaded. Sound effects may disable master volume checks. Depending on channel type, volume is loaded from either mMasterVolFM, mMasterVolDAC or mMasterVolPSG.</li>
		<li><b>volume envelopes</b> — Volume envelopes are processed every frame. <a href="#part7">Read more in the next part</a>.</li>
		<li><b>total level in FM channels</b> — Each FM channel has 4 total level values for each operator. Slot operators are affected by volume calculation, while non-slot aren't.</li>
		<li><b>underwater mode for FM</b> — Underwater mode also affects the volume calculation and non-slot total level value.</li>
		<li><b>PCM audio for DAC channels</b> — The PCM audio data itself is basically just a list of volumes, so it makes sense it can affect how loud the volume is.</li>
		<li><b>PSG audio filtering on real hardware</b> — PSG audio is also somewhat different relatively to FM and DAC audio in real systems. This is because of inconsistent filters and buggy implementation. AMPS cannot do anything about this problem however.</li>
	</ul>
	<p>
		The final step of this process is to send the volume to hardware. In case of PSG, this is a single PSG command containing the volume. For FM, it is 4 total level operators per channel. For DAC, however, it is a bit more complex. Dual PCM uses a volume filter bank with $80 levels of volume to scale the PCM input volume. This allows for very complex filters or a simple filter that AMPS comes with. By default, AMPS uses a logarithmic filter that closely mimics FM volume (but not 100%). However, custom filters may be applied. There is a tracker command, ssFilter, that allows to change the bank. AMPS is very lazy with handling these filters and they can also affect sound effect channels (a filter loaded with DAC1 on music will affect SFX DAC1, and vice versa), so you have to be careful. AMPS requests a volume update from Dual PCM in order to load the correct volume table in Z80 RAM, which then acts as the current filter for the current volume level. It takes some time to load the volume table in RAM, so loading a new volume only every 4 frames or more is recommended. If you load it more often, quality loss is likely to happen. AMPS tells Dual PCM to wrap the buffer around, so a part of the sample will repeat on itself. This is less distracting than the default behaviour of Dual PCM where the samples will delay for a moment. The best thing to do is avoid updating PCM volume too often.
	</p>
	<p>
		Updating PSG and DAC volume is fairly fast for the 68k to do (even given the amount of work required), but unfortunately FM volume is noticeably slower. This is mainly because of the 4 operators that need updating, and the fact we've got to take time from Dual PCM for a while. AMPS optimizes this but at the cost of more 68k time. Avoid updating volume unless it is necessary!
	</p>
	<p>
		Below you can see a chart comparing the effective loudness for each volume level for all the channel types. This is only an approximation, as there are many factors effecting effective and perceived volume. This chart is meant to illustrate the differences of how each channel sounds at different volume levels (Thanks to Markeyjester!):
	</p>
	<voltbl>
		<div>
			<img id="vtbg" src="data:image/png;base64,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" />
			<img id="vtdac" src="data:image/png;base64,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"/>
			<img id="vtfm" src="data:image/png;base64,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"/>
			<img id="vtpsg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAACowAAAH7AgMAAACBUcfkAAAACVBMVEUAAGsAwAAw/zByUTFKAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfkAwIUMRxl2xE+AAADf0lEQVR42u3dMY5TQQwG4Bek11PwuMHeI+IEEYopqELBPfYIFKShp9hbcoS1lJH8E31f8Q4wO/LYHk922wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZ9uPU+MOXlW+8DUz7/7X1gyp+3e9V7n1frxJzvb1X13udsnRBHQT7KU9f1znoGdfqjPy7WiWynqzUgnD1KurIEhDsUTYTbFU0omkBCypMnpJYARRMomlA0gaIJJKT8xwmpPYqiCR4rmr7eNu/wifbTO3zCefdEOu9HSecdPuIoyEd5bq13+JqoDGq9w3erT7pSNBHucNgTzpgpDntw2PPkdoc98Ye9JSD9sDdnSvphb86UcCf3+qQzH0U6c6aIo/CYVj760ToxpzVnqovKoM6c6c21PukOV6aEOznsSVfmowhnPor8w/5Lp7ayUAxWTWZPSD/szZ6Qzp0p6cyeII7CY1r56CfrxJze7InDnjm92ROtfsLt7vVJ516f/EDaygksFGNO5c6UcIc7U9IDqV4/6dyZkq4VR39ZJ+a08tFDIGVO787UfRRzWv3Roy76qGSretFHJdpe+qiEO/RRCXfSRyVdK47+tk7M6fVRjfoxp9dHrbMeFVNae2/XoyK+/NejIl3pURFOj4p4rTh6P29qK6b0elR1VlsxpdmjUlsxpneGl9qK+Pq/VVtdNnkr4bXVdZO3El5byVvJrq2Oft4qJ2Cmttp7eWttcgKm9H5H5V7Xbk4g3jKVt3ZzAvGWkbz1VM2c4LqJt8zkrdvezAnEW+JzAvGW6Jxg22sq3trLdPfAVLy1l4mOt/f1exnxdm28Xb+XYXW8XbqXX/19WBxvl+9lvwfL6ni7fi/7V6+sjrdr9zLk72VI38sAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA84h9MHtNT84MdKgAAAABJRU5ErkJggg==" />
		</div>
		<div>
			<div tabindex="0" onmouseenter="hlvte('vtdac');" onmouseleave="uhvte('vtdac');" onfocus="hlvte('vtdac');" onblur="uhvte('vtdac');"><div style="background: #3030FF"></div>DAC</div>
			<div tabindex="0" onmouseenter="hlvte('vtfm');" onmouseleave="uhvte('vtfm');" onfocus="hlvte('vtfm');" onblur="uhvte('vtfm');"><div style="background: #FF3030"></div>FM</div>
			<div tabindex="0" onmouseenter="hlvte('vtpsg');" onmouseleave="uhvte('vtpsg');" onfocus="hlvte('vtpsg');" onblur="uhvte('vtpsg');"><div style="background: #30FF30"></div>PSG</div>
		</div>
	</voltbl>

	<h3 id="part6_2" class="bd"><a class="bx" href="#part6_2">6.2 — Underwater Mode</a></h3>
	<p>
		Underwater mode is a software effect intended to emulate the music playing under water. This is especially useful for adding more depth for water-based levels. The effect is not perfect but it often sounds convincing enough. This feature can be enabled/disabled with FEATURE_UNDERWATER. Underwater mode currently only affects FM volumes. It works by using the algorithm of the voice to read a value from the table (below), and adding part of it into slot operators (volume), and adding it fully to non-slot operators (modulator/sharpness). The table explains it below:
	</p>
	<table border="1">
		<tr><td>algorithm</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td></tr>
		<tr><td>slot offset</td><td>$00</td><td>$00</td><td>$00</td><td>$00</td><td>$02</td><td>$06</td><td>$06</td><td>$07</td></tr>
		<tr><td>nonslot offs</td><td>$08</td><td>$08</td><td>$08</td><td>$08</td><td>$0A</td><td>$0E</td><td>$0E</td><td>$0F</td></tr>
	</table>
	<p>
		This can cause issues with some instruments, that do not sound good when this algorithm is applied. For underwater levels, you may have to consider how music and sound effects sound when underwater mode is enabled.
	</p>

	<h3 id="part6_3" class="bd"><a class="bx" href="#part6_3">6.3 — Volume Fading</a></h3>
	<p>
		AMPS provides a custom and extensible way to create custom volume fades. By default, only a fade in and fade out are defined. AMPS uses a list of volumes to define how to do fades. Technically, a volume fade does not need to be limited to ending or starting at a muted volume, it can be fade from any volume to any other, and can use any values. The only things that matter is that there is a starting point, and it ends with a command. The table below explains what each command does:
	</p>
	<ul>
		<li><b>$80, fEnd</b> — Simply ends the volume fade.</li>
		<li><b>$84, fStop</b> — Stops the current song and sound effects immediately and ends the volume fade. Also clears sound driver memory and mutes hardware.</li>
		<li><b>$88, fResVol</b> — Resets master volume and asks channels to update their volume.</li>
		<li><b>$8C, fReset</b> — Does the same as both fStop and fResVol.</li>
	</ul>
	<p>
		Volume fading can be enabled programmatically from 68k by calling dLoadFade, where a4 is the volume fade data address. AMPS will automatically use the current FM volume and search the volume fade to find the closest spot to that. This helps make volume fades smooth and consistent, but it also makes it possible that your volume fade is cut short. Overall its not a good idea to rely on volume fades being consistent or taking certain amount of time, instead allowing it to take longer or shorter.
	</p>
	<p>
		Volume filters are read 3 values per frame. The format is FM volume, DAC volume, PSG volume. Instead, a command may be used as well. Channel volumes are added to music volumes and updated with the channel after volume changes (if the volume does not change, no update happens!). Any value $80 or above is treated as a command, as it is not a valid volume anyway. Updating DAC volume more often than once per 4 frames is not recommended because this will result in audible quality loss. Volume fades are processed before sound channels. A word of warning: If any volume fade data is located before ROM address $10000, the fading will never occur. This is simply a limitation with AMPS.
	</p>

	<h1 id="part7" class="bd"><a class="bx" href="#part7">7 — Envelopes</a></h1>
	<p>
		AMPS has 2 types of envelopes: Modulation envelopes and volume envelopes. Volume envelopes can be enabled for only PSG channels, or all channels, using FEATURE_DACFMVOLENV. Modulation envelopes can be enabled or disabled using FEATURE_MODENV. These two assembly flags allow to choose which settings you will need, where them being disabled is faster and uses less RAM, but also allows for less features. The algorithm for both work very similarly, but modulation envelopes have an additional step. This will be mentioned later.
	</p>
	<p>
		Essentially, the algorithm simply looks for the next value in sequence every frame. There are volumes/frequencies and commands, and each envelope must end on a command. When a value is read from the envelope, if it's between $00 and $7F, or $8C to $FF, it is a volume or a frequency offset. Negative values apply a negative offset. Values read from the envelope data signify the end of the envelope processing for the frame. The next byte is read next frame, and the current byte is used to calculate output volume or frequency offset. In case of volume envelopes, it is simply added to channel volume for the current frame (result is not saved), and modulation envelopes are slightly more complex. For modulation envelopes, the modulation sensitivity is used to multiply the read value. A sensitivity of $04 with read value of $07 results in offset of $23. The sensitivity is from $01 to $100 instead of $00 to $FF. This can be set with a separate command. Below is the list of commands available:
	</p>
	<ul>
		<li><b>$80, eReset</b> — Restart to the start of the volume envelope. Continues execution from the beginning.</li>
		<li><b>$82, eHold</b> — Holds the volume or frequency offset at the last read value. Technically, the position is always decremented and value is read again.</li>
		<li><b>$84, eLoop x</b> — Set offset in volume envelope data to x. A value of 0 is equivalent to eReset. Continues execution from the loop point.</li>
		<li><b>$86, eStop</b> — Note off the channel and stop envelope processing.</li>
		<li><b>$88, esSens x</b> — Sets the modulation envelope sensitivity to x. Only valid for modulation envelopes! Continues execution afterwards.</li>
		<li><b>$8A, eaSens x</b> — Adds x to the modulation envelope sensitivity. Only valid for modulation envelopes! Continues execution afterwards.</li>
	</ul>
	<p>
		Some commands stop processing the envelope processing while others continue afterwards. Envelopes are defined in code/Data.asm, in <b>VolEnvs</b> and <b>ModEnvs</b>. They define a list of envelopes and afterwards their data. You can look at examples in these lists. Volume envelopes get the <b>vd</b> prefix for the data and <b>v</b> prefix for the equate. Modulation envelopes get the <b>md</b> envelope for data and <b>m</b> prefix for equates. Special equates, <b>vNone</b> and <b>mNone</b> refer to non-existent envelopes, that just skip the envelope process entirely. They have no effect to volume or frequency.
	</p>

	<h1 id="part8" class="bd"><a class="bx" href="#part8">8 — Communication Bytes</a></h1>
	<p>
		AMPS allows trackers to communicate with the program using communications bytes. By default, 8 bytes are defined that are accessible to both read & write from the tracker. You can conditionally execute tracker code when checking the communications byte with a condition mode. Whenever condition is set to false, number of commands are skipped instead of executing them. This can be used to skip commands, for example jumping or changing voice, to split the single path into multiple paths. This could be used for all kinds of neat effects, dynamic songs, songs that have ending point as opposed to just fading out, things like this. It is entirely up to the programmer on how they decide to accomplish this. <a href="#part4_1">This earlier part also lists which commands will be skipped.</a>
	</p>
	<p>
		The 8 bytes can be accessed through mComm to mComm+7. The program is free to manipulate these in any way and the programmer is responsible for deciding which communications bytes are used for what purpose. Communications bytes are not initialized to any specific value, so relying on them being, for example, 0 is not advised. Communication bytes do not get reset ever with AMPS, so sharing them between songs, sound effects or other is possible. It is a good idea to reset all the communications bytes you intend to use for songs with tracker code. Here is an example of reading and writing to the communications flags:
	</p>
	<asm>		<opc>move.b</opc>	<equ>mComm</equ><math>+</math><val>3</val><opc>.w</opc>,<ea>d0</ea>					<cmt>; load 4th communications byte to d0</cmt>
		<opc>and.b</opc>	#<val>$07</val>,<ea>d0</ea>						<cmt>; clear some extra bits out</cmt>
		<opc>move.b</opc>	<ea>d0</ea>,<equ>mComm</equ><opc>.w</opc>					<cmt>; save as the 1st communications byte</cmt></asm>
	<p>
		Communications bytes can be extended up to 256 bytes if the programmer needs that, but you have to remember, only 16 are available using the sCond command. Additionally, sCondReg command can be used to read from pre-defined RAM addresses or channel offsets. dcCondRegTable contains the table of pointers that are used for reading with this command.
	</p>

	<h1 id="part9" class="bd"><a class="bx" href="#part9">9 — Memory Map</a></h1>
	<p>
		Below is the memory map for every individual channel and the entire sound driver. You can select various modes depending on which flags you have enabled, and the correct sequence is computed for you. This memory map is merely for reference purposes and you should never use the offsets provided here for actual work. The equates exist to make portability and consistency in mind and therefore are highly recommended to be used at all times.
	</p>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdsafe" id="mdsafe" checked /><span>safe mode</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdmod" id="mdmod" checked /><span>FEATURE_MODULATION</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdport" id="mdport" /><span>FEATURE_PORTAMENTO</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdmenv" id="mdmenv" /><span>FEATURE_MODENV</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdvenvdf" id="mdvenvdf" /><span>FEATURE_DACFMVOLENV</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdbackup" id="mdbackup" checked /><span>FEATURE_BACKUP</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdfm6" id="mdfm6" checked /><span>FEATURE_FM6</span></cbox>
	<cbox><input type="checkbox" onclick="refRAM()" title="mdstest" id="mdstest" checked /><span>FEATURE_SOUNDTEST</span></cbox>
	<br/>
	<div style="width: 100%; display: flex; flex-direction: row">
		<div style="flex: 1 1"><h3>Global</h3><table border="1" id="ramtable"></table></div>
		<div style="flex: 1 1"><h3>Channel</h3><table border="1" id="chantable"></table></div>
	</div>
	<br/>

	<h1 id="part10" class="bd"><a class="bx" href="#part10">10 — Creating Custom Music</a></h1>
	<p>
		To be written in the future.
	</p>

	<h1 id="part11" class="bd"><a class="bx" href="#part11">11 — Porting Music And Sound Effects</a></h1>
	<p>
		Due to the difficulty of porting music from non-Sound-Source games, it will not be covered here at all. Although I could cover it, it would be massively complicated and largely unhelpful. Instead, this part will list the kind of information you need to port music. Since AMPS is SMPS2ASM format exclusive, this tutorial will only talk about the aspects of SMPS2ASM. For more information to correctly converting music, see <a href="http://sonicresearch.org/community/index.php?threads/md-music-player-scriptable-smps2asm.4354/">MDMusicPlayer</a>. Since AMPS uses a custom version of the standard SMPS2ASM format created by Aurora, using older versions (Cinossu's S1SMPS2ASM or Flamewing's SMPS2ASM) is not recommended, as those require manual conversion into AMPS format. Unlike most Sound-Source drivers, AMPS does not generally use separate tracker commands for adjusting various things about channels (for example, no adding FM or PSG volume with different commands), so these are to be converted by hand. Here is a full list of common commands and their conversions, and various notes about other commands:
	</p>
	<table border="1">
		<tr><td>Sound-Source command</td><td>AMPS command</td><td>Additional notes</td></tr>
		<tr><td>saVolFM</td><td>saVol</td><td></td></tr>
		<tr><td>saVolPSG</td><td>saVol</td><td>You must remember to multiply the volume by $08 for every instance.</td></tr>
		<tr><td>ssVolS3K</td><td>ssVol</td><td>Volume is negated in a strange way in S3K, but Aurora's SMPS2ASM will disassemble it correctly. If the volume sounds weird, it may be an older file without correct conversion applied.</td></tr>
		<tr><td>sPatFM</td><td>sVoice</td><td></td></tr>
		<tr><td>sVolEnvPSG</td><td>sVolEnv</td><td>Previously, this would have been converted as sVoice, but since FEATURE_FMDACVOLENV was implemented, it should no longer be used.</td></tr>
		<tr><td>ssMod68k</td><td>sModAMPS</td><td>The resulting modulation will be slightly different. See the <a href="#part11_1">converter below</a>, or <a href="#part5_1">documentation about modulation for more info</a>.</td></tr>
		<tr><td>ssModZ80</td><td>sModAMPS</td><td>The resulting modulation will be significantly different. See the <a href="#part11_1">converter below</a>, or <a href="#part5_1">documentation about modulation for more info</a>.</td></tr>
		<tr><td>sYMcmd</td><td>sCmdYM</td><td>sCmdYM can correctly take in account the current channel type.</td></tr>
		<tr><td>sYM1cmd</td><td>sCmdYM</td><td>There are some differences in how these commands function.</td></tr>
		<tr><td>sNoteTimeOut</td><td>sGate</td><td>sNoteTimeOut was the previous name for sGate, and may still be in use with your file. This is not supported for sound effects.</td></tr>
		<tr><td>sSSGEG</td><td></td><td>Currently you cannot set SSG-EG from tracker. This must be enabled in FM voice.</td></tr>
		<tr><td>sModEnv</td><td></td><td>This command with 2 parameters is not supported in AMPS. You could use sCond to check for channel type bits, and execute code based on that.</td></tr>
		<tr><td>saVolFMP</td><td></td><td>Not supported in AMPS. You could use sCond to check for channel type bits, and execute code based on that.</td></tr>
		<tr><td>sComm</td><td></td><td>The first parameter in AMPS is the command byte number. Sound-Source only supported 1 of them, which is why that parameter does not exist. Usually, you would use 0 as the first parameter in this case.</td></tr>
		<tr><td>sPanAni</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sSpecFM3</td><td></td><td>Not supported in AMPS currently.</td></tr>
		<tr><td>sMusPause</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sFadeSpec</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sMuteStopFM</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sPlayDAC</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sPitchSlide</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sRawFreq</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>sCopyMem</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>saTimerA</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>ssTimerA</td><td></td><td>Not supported in AMPS.</td></tr>
		<tr><td>ssTimingSFX</td><td></td><td>Not supported in AMPS.</td></tr>
	</table>
	<p>
		The header of music and sound effects is different in AMPS than Sound-Source. Since AMPS uses 2-channel playback, most of the time another channel needs to be added. Also, there is no pointer to the voice table, so it needs to be moved right below the header. Sound effects do not have separate voice tables, <a href="#part_4_41">so they have to get their voices from the global table</a>. Here is an example music header, and below that is what it should look like when converted. Remember to observe the comments:
	</p>
	<smps2asm>	<mac>sHeaderInit</mac>							<cmt>; Z80 offset is $8DC8</cmt>
	<mac>sHeaderPatch</mac>	<lbl>LunchPlace_Patches</lbl>				<cmt>; will be deleted</cmt>
	<mac>sHeaderCh</mac>	<val>$06</val>, <val>$03</val>					<cmt>; this and the line below swap places. Also, the number of FM channels needs to be $05.</cmt>
	<mac>sHeaderTempo</mac>	<val>$01</val>, <val>$2F</val>					<cmt>; this song uses the overflow method, so it may need to be converted for the counter method</cmt>
	<mac>sHeaderDAC</mac>	<lbl>LunchPlace_DAC</lbl>					<cmt>; this line will need to be duplicated and modified</cmt>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM1</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM2</lbl>, <val>$0C</val>, <val>$08</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM3</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM4</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM5</lbl>, <val>$0C</val>, <val>$0C</val>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG1</lbl>, <val>$F4</val>, <val>$02</val>, <val>$00</val>, <lbl>v00</lbl>		<cmt>; <- notice the channel volume here</cmt>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG2</lbl>, <val>$F4</val>, <val>$04</val>, <val>$00</val>, <lbl>v00</lbl>		<cmt>; <- also notice the transposition</cmt>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG3</lbl>, <val>$00</val>, <val>$02</val>, <val>$00</val>, <lbl>v00</lbl>		<cmt>; <-</cmt>
	...								<cmt>; notice that there may be some lines right here.</cmt>

<lbl>LaunchPlace_Patches:</lbl>

	<cmt>; Patch $00
	; $03
	; $62, $40, $44, $31,	$1F, $1F, $1F, $1C
	; $0B, $0A, $02, $01,	$08, $0B, $04, $06
	; $1F, $1F, $1F, $1F,	$2A, $1A, $2B, $80</cmt>
	<mac>spAlgorithm</mac>	<val>$03</val>
	<mac>spFeedback</mac>	<val>$00</val>
	<mac>spDetune</mac>	<val>$06</val>, <val>$04</val>, <val>$04</val>, <val>$03</val>
	<mac>spMultiple</mac>	<val>$02</val>, <val>$04</val>, <val>$00</val>, <val>$01</val>
	<mac>spRateScale</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>
	<mac>spAttackRt</mac>	<val>$1F</val>, <val>$1F</val>, <val>$1F</val>, <val>$1C</val>
	<mac>spAmpMod</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>
	<mac>spSustainRt</mac>	<val>$0B</val>, <val>$02</val>, <val>$0A</val>, <val>$01</val>
	<mac>spSustainLv</mac>	<val>$01</val>, <val>$01</val>, <val>$01</val>, <val>$01</val>
	<mac>spDecayRt</mac>	<val>$08</val>, <val>$04</val>, <val>$0B</val>, <val>$06</val>
	<mac>spReleaseRt</mac>	<val>$0F</val>, <val>$0F</val>, <val>$0F</val>, <val>$0F</val>				<cmt>; voices will be mostly the same, but we will add another line just below</cmt>
	<mac>spTotalLv</mac>	<val>$2A</val>, <val>$2B</val>, <val>$1A</val>, <val>$00</val>
	...</smps2asm>
	<p>
		Now, the converted version:
	</p>
	<smps2asm>	<mac>sHeaderInit</mac>
	<mac>sHeaderTempo</mac>	<val>$01</val>, <val>$2F</val>					<cmt>; no conversion was done, since the overflow method is also used by AMPS for this example</cmt>
	<mac>sHeaderCh</mac>	<val>$05</val>, <val>$03</val>					<cmt>; there are 5 FM channels in this song, so the FM channel count was changed to $05</cmt>
	<mac>sHeaderDAC</mac>	<lbl>LunchPlace_DAC1</lbl>					<cmt>; this line was added. However, DAC1 is not used because the original song used 1 DAC channel, and DAC1 can be interrupted by sfx</cmt>
	<mac>sHeaderDAC</mac>	<lbl>LunchPlace_DAC2</lbl>					<cmt>; DAC2 is used for the original singular DAC track. If there were 2 DAC tracks already, then you will need to adapt both.</cmt>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM1</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM2</lbl>, <val>$0C</val>, <val>$08</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM3</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM4</lbl>, <val>$00</val>, <val>$0C</val>
	<mac>sHeaderFM</mac>	<lbl>LunchPlace_FM5</lbl>, <val>$0C</val>, <val>$0C</val>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG1</lbl>, <val>$F4</val><mth>+</mth><val>$0C</val>, <val>$10</val>, <val>$00</val>, <lbl>vNone</lbl>	<cmt>; volume is multiplied by $08, and v00 was changed to vNone</cmt>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG2</lbl>, <val>$F4</val><mth>+</mth><val>$0C</val>, <val>$20</val>, <val>$00</val>, <lbl>vNone</lbl>	<cmt>; songs from 68k SMPS drivers need $0C to be added to the transposition of the channel, because of differences in frequency tables.</cmt>
	<mac>sHeaderPSG</mac>	<lbl>LunchPlace_PSG3</lbl>, <val>$00</val>, <val>$10</val>, <val>$00</val>, <lbl>vNone</lbl>		<cmt>; this is not always the case. If only nHiHat is used, the transposition can be kept at $00.</cmt>
									<cmt>; now, we cannot have anything else between this and the voice table</cmt>
	<cmt>; Patch $00
	; $03
	; $62, $40, $44, $31,	$1F, $1F, $1F, $1C
	; $0B, $0A, $02, $01,	$08, $0B, $04, $06
	; $1F, $1F, $1F, $1F,	$2A, $1A, $2B, $80</cmt>
	<mac>spAlgorithm</mac>	<val>$03</val>
	<mac>spFeedback</mac>	<val>$00</val>
	<mac>spDetune</mac>	<val>$06</val>, <val>$04</val>, <val>$04</val>, <val>$03</val>
	<mac>spMultiple</mac>	<val>$02</val>, <val>$04</val>, <val>$00</val>, <val>$01</val>
	<mac>spRateScale</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>
	<mac>spAttackRt</mac>	<val>$1F</val>, <val>$1F</val>, <val>$1F</val>, <val>$1C</val>
	<mac>spAmpMod</mac>	<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>
	<mac>spSustainRt</mac>	<val>$0B</val>, <val>$02</val>, <val>$0A</val>, <val>$01</val>
	<mac>spSustainLv</mac>	<val>$01</val>, <val>$01</val>, <val>$01</val>, <val>$01</val>
	<mac>spDecayRt</mac>	<val>$08</val>, <val>$04</val>, <val>$0B</val>, <val>$06</val>
	<mac>spReleaseRt</mac>	<val>$0F</val>, <val>$0F</val>, <val>$0F</val>, <val>$0F</val>
	<mac>spSSGEG</mac>		<val>$00</val>, <val>$00</val>, <val>$00</val>, <val>$00</val>				<cmt>; voices in AMPS store SSG-EG data inside of them. It's a good idea to add this line before spTotalLv.</cmt>
	<mac>spTotalLv</mac>	<val>$2A</val>, <val>$2B</val>, <val>$1A</val>, <val>$00</val>
	...								<cmt>; notice that there may be some lines right here.</cmt>

<lbl>LunchPlace_DAC1:</lbl>
	<mac>sStop</mac>								<cmt>; these lines need to be added to disable DAC1. You can later reuse this label to add DAC1 track.</cmt></smps2asm>
	<p>
		You need to keep in mind that since sound effects put the voices into the <a href="#part_4_41">global voice table</a>, you need to relocate them there and change all references to it in the tracker code. Additionally, below is how you would change the sfx header:
	</p>
	<smps2asm>	<mac>sHeaderInit</mac>
	<mac>sHeaderPatch</mac>		<lbl>sfx_Voices</lbl>				<cmt>; will be deleted</cmt>
	<mac>sHeaderTick</mac>		<val>$01</val>					<cmt>; will be changed with another line. If tick multiplier is not $01, you'll have to set it with a tracker command.</cmt>
	<mac>sHeaderCh</mac>		<val>$02</val>
	<mac>sHeaderSFX</mac>		<val>$80</val>, <val>$05</val>, <lbl>sfx_FM5</lbl>, <val>$00</val>, <val>$06</val>		<cmt>; channel type will be changed</cmt>
	<mac>sHeaderSFX</mac>		<val>$80</val>, <val>$A0</val>, <lbl>sfx_PSG2</lbl>, <val>$0C</val>, <val>$03</val>		<cmt>; many parameters will be changed</cmt></smps2asm>
	<p>
		Here is the edited version
	</p>
	<smps2asm>	<mac>sHeaderInit</mac>
	<mac>sHeaderPrio</mac>		<val>$80</val>					<cmt>; priority of all SFX channels. This helps with overriding the least important channels.</cmt>
	<mac>sHeaderCh</mac>		<val>$02</val>
	<mac>sHeaderSFX</mac>		<val>$80</val>, <equ>ctFM5</equ>, <lbl>sfx_FM5</lbl>, <val>$00</val>, <val>$06</val>		<cmt>; see list of equates below for chanel types.</cmt>
	<mac>sHeaderSFX</mac>		<val>$A1</val>, <equ>ctPSG2</equ>, <lbl>sfx_PSG2</lbl>, <val>$0C</val><mth>+</mth><val>$0C</val>, <val>$18</val>	<cmt>; channel pitch and volume changed. Also, channel flags MUST be $A1.</cmt></smps2asm>
	<p>
		Here is the table of different channel types:
	</p>
	<table border="1">
		<tr><td>Equate name</td><td>ctFM1</td><td>ctFM2</td><td>ctFM3</td><td>ctFM4</td><td>ctFM5</td><td>ctFM6</td><td>ctPSG1</td><td>ctPSG2</td><td>ctPSG3</td></tr>
		<tr><td>Type value</td><td>$00</td><td>$01</td><td>$02</td><td>$04</td><td>$05</td><td>$06</td><td>$80</td><td>$A0</td><td>$C0</td></tr>
	</table>
	<p>
		You must also keep in mind that different Sound-Source games use different volume and modulation envelope tables. Therefore, to fully port songs between games, these envelopes must be ported to AMPS. You may also look for one that is similar enough to not be very noticeable. Indeed, this is often done if the difference is already minimal. It depends on the case how you acquire the data, but you should convert it to ASM (eg, series of dc.b statements). I cannot help with this because it largely depends on the case. In the case of volume envelopes used for PSG, all the volumes must be multiplied by $08. There are various commands for envelopes as well, they are usually between $80 and $A0 (sometimes negative values are also used as part of the envelopes), and they must be converted correctly. It depends on the game which values correspond to what. These often can be found in <a href="https://forums.sonicretro.org/index.php?threads/valley-bells-smps-research.32473/">SMPS Research Pack</a>. Below is a table of common commands and their AMPS equivalents:
	</p>
	<table border="1">
		<tr><td>command id</td><td>SMPS Research Pack name</td><td>AMPS equate</td><td>notes</td></tr>
		<tr><td>80</td><td>RESET</td><td>eReset</td><td></td></tr>
		<tr><td>81</td><td>HOLD</td><td>eHold</td><td></td></tr>
		<tr><td>82</td><td>LOOP</td><td>eLoop</td><td></td></tr>
		<tr><td>83</td><td>STOP</td><td>eStop</td><td>This one and the below one are equivalent for volume envelopes.</td></tr>
		<tr><td>83</td><td>VOLSTOP_MODHOLD</td><td></td><td>eStop for volume envelopes and eHold for modulation envelopes.</td></tr>
		<tr><td>84</td><td>CHG_MULT</td><td>esSens</td><td></td></tr>
		<tr><td></td><td></td><td>eaSens</td><td>Not supported by Sound-Source by default.</td></tr>
	</table>
	<p>
		To insert this data into AMPS, have a look in <a href="#part7">this part</a>.
	</p>
	<p>
		It is possible you may have to port samples between games as well. This, again, can be very difficult feat. If you wish to port samples, you will have to find the file for the sample. This can be disassembled from the game or may exist somewhere already. You will have to figure out whether it is DPCM or PCM format, and the sample rate. Often, drivers have specific "base rate", and modifiers that add to this rate. This is very specific and therefore difficult to explain. If you are unsure of how to port these samples, you may ask someone more knowledgeable to help.
	</p>
	<p>
		However, if you have both the sample file, its format, and sample rate, it is very easy to convert it to a wav file. Simply, convert any DPCM format samples to PCM first (there are various tools for this available), and then load it into <a href="https://www.audacityteam.org/">Audacity</a>, and import as raw. You get some options after you've selected the file. Simply, the file needs to be "uncompressed 8-bit PCM", at the sample rate you found out, 1-channel mono and big-endian. In theory, the sample should be imported correctly. Then, change the sample rate to the sample rate of Dual PCM (typically this would be 14000Hz), and export the sample as 8-bit wav. This will ensure that the minimal amount of quality loss happens. However, Audacity has some options that can affect the sample quality negatively as well. It is a good idea to try playing around with them to find the most optimal settings. Next, drag & drop the new wav file into ConvPCM, and the SWF sample file will be generated, ready to use. <a href="#part4_5">You can follow these instructions to add your sample</a>.
	</p>
	<p>
		Within the tracker file, you can change references to a sample name to the name of the new sample you added, or any sample you want to replace it with. This in most cases should work as a simple text replacement over the entire file.
	</p>
	<p>
		There are a few differences in various Sound-Source versions, that need to be considered when porting music. These have been taken from the SMPS Research Pack, and adapted to be specific to AMPS:
	</p>
	<ul>
		<li>There are minor differences between frequency tables between Sound-Source 68k, Sound-Source Z80 and AMPS. Most of the time this does not matter but can lead to some unintended glitches.</li>
		<li>In Sound-Source Z80, playing negative PSG frequencies can lead to PSG commands being sent unintentionally. This leads to strange behaviour, because of the way the PSG commands are calculated.</li>
		<li>In Z80 Sound-Source, playing a <b>note, rest, delay, delay</b> will play the note again at the last delay. In AMPS and Sound-Source 68k, rest will be played twice.</li>
		<li>Tick multiplier only affects delays in Sound-Source 68k and AMPS, but also affects gate in Sound-Source Z80.</li>
		<li>In Sound-Source 68k and Sound-Source Z80, volumes between $80 and $FF are treated as the maximum channel volume, while in AMPS is treated as a negative (minimum) volume.</li>
		<li>Modulation envelope sensitivity is signed in AMPS and Sound-Source 68k, but unsigned in Sound-Source Z80. Additionally, in AMPS and Sound-Source Z80, the multiplier is from 1 to $100, while in Sound-Source 68k it is 0 to $FF.</li>
		<li>The bit 7 (value greater than or equal to $80) is used to determine the slot operators for total level values in AMPS and Sound-Source Z80, while in Sound-Source 68k uses another table to determine it.</li>
		<li>AMPS, Sound-Source 68k and Sound-Source Z80 all have different modulation algorithms.</li>
		<li>Modulation parameters are not reset in Sound-Source Z80, in AMPS only <b>&lt;wait&gt;</b> and <b>&lt;step&gt;</b> are reset, and in Sound-Source 68k all are reset when the modulation command (sModAMPS, ssMod68k or ssModZ80) is played. This makes a difference when modulation command is used when note is held. While normally, the parameters eventually get reset anyway, in Sound-Source 68k, they are also reset when note is held.</li>
		<li>When <b>&lt;count&gt;</b> is $00 in AMPS, the length of modulation is infinite. The <b>&lt;count&gt;</b> is never negated, which makes the modulation only go in one direction.</li>
		<li>In Sound-Source Z80 and AMPS, the same frame as note is played, the modulation is updated, while in Sound-Source 68k, it is not.</li>
	</ul>

	<h3 id="part11_1" class="bd"><a class="bx" href="#part11_1">11.1 — Modulation Converter</a></h3>
	<p>
		This is an approximate converter between different modulation algorithms. Do note, that the 4 values required must be separated by commas, and must be presented in hex only. The results may still be inaccurate, but should at least provide a good approximation to work from.
	</p>
	<table border="1">
		<tr><td>algorithm</td><td>wait, speed, step, count</td><td></td></tr>
		<tr><td>ssMod68k</td><td><input id="mc6" /></td><td><button onclick="modc('mc6')">convert</button></td></tr>
		<tr><td>ssModZ80</td><td><input id="mc8" /></td><td><button onclick="modc('mc8')">convert</button></td></tr>
		<tr><td>sModAMPS</td><td><input id="mca" /></td><td><button onclick="modc('mca')">convert</button></td></tr>
	</table>

	<h1 id="part12" class="bd"><a class="bx" href="#part12">12 — Installing AMPS</a></h1>
	<p>
		This part will not tell you how to install AMPS into a pre-existing ROM hack or fully completed project, as the method for converting a pre-existing sound driver to be AMPS instead is difficult to estimate or give advice on. There are reference implementations available for many of the most common disassemblies already. Instead, this tutorial will cover the basics you need to know to successfully implement AMPS into a new project of yours. This could be a homebrew game or an application for example.
	</p>
	<p>
		There are a few files you need to include into the main assembly file. This part will use ASM68K syntax but should be easily applicable to AS too. These following files need to exist at the very start of assembly (beginning of your main asm file):
	</p>
	<asm>		<mac>include</mac> <str>"AMPS/code/smps2asm.asm"</str>	<cmt>; code related to AMPS' SMPS2ASM macro set</cmt>
		<mac>include</mac> <str>"AMPS/code/macro.asm"</str>		<cmt>; various macros and equates that make AMPS possible</cmt>
		<mac>include</mac> <str>"AMPS/lang.asm"</str>			<cmt>; Z80 macro language to assemble Dual PCM. DO NOT USE FOR AS</cmt></asm>
	<p>
		The following code includes AMPS itself and an uncompressed version of Dual PCM. To use compression, you have to come up with your own solution:
	</p>
	<asm>		<mac>include</mac> <str>"AMPS/code/68k.asm"</str>		<cmt>; include main code for AMPS, including all the different various files</cmt>

<lbl>DualPCM:</lbl>	<mac>z80prog</mac> <val>0</val>				<cmt>; initialize Z80 language program</cmt>
		<mac>include</mac> <str>"AMPS/code/z80.asm"</str>		<cmt>; include the Dual PCM driver code</cmt>
<lbl>DualPCM_sz:</lbl>	<mac>z80prog</mac>					<cmt>; end the Z80 language program</cmt></asm>
	<p>
		This is the equivalent code for AS:
	</p>
	<asm>		<mac>include</mac> <str>"AMPS/code/68k.asm"</str>		<cmt>; include main code for AMPS, including all the different various files</cmt>

<lbl>DualPCM:</lbl>
		<mac>save</mac>					<cmt>; save processor flags</cmt>
		<mac>org</mac>	<val>0</val>				<cmt>; go to address 0 in Z80 ROM</cmt>
		<mac>cpu</mac>	<equ>z80undoc</equ>			<cmt>; use Z80 with (broken) undocumented instructions support</cmt>
		<mac>include</mac> <str>"AMPS/code/z80.asm"</str>		<cmt>; include the Dual PCM driver code</cmt>

<lbl>DualPCM_sz:</lbl>
		<mac>cpu</mac>	<equ>68000</equ>				<cmt>; switch back to 68000</cmt>
		<mac>restore</mac>					<cmt>; restore processor flags</cmt></asm>
	<p>
		<b>code/macro.asm</b> needs to be edited in order for the installation to be successful. Specifically, you can toggle the various flags at the top to enable the features you want, and you need to scroll down to the line starting with <b>mFlags</b>. The line above it may have a RAM address or an equate, that you need to change to suit your software. This will redefine the RAM addressing for AMPS so that it uses a desired slot of RAM for its operations. You will need to be aware, that any RAM address below $FF8040 is not valid for AMPS because of short addressing requirements.
	</p>
	<p>
		Finally, your build scripts need to be updated. First, you need this line at the beginning:
	</p>
	<asm><str>"AMPS\Includer.exe"</str> <equ>ASM68K AMPS</equ> <lbl>AMPS\.Data</lbl></asm>
	<p>
		And this at the end:
	</p>
	<asm><mac>del</mac> <lbl>AMPS\.Data</lbl></asm>
	<p>
		For AS, simply change <b>ASM68K</b> to <b>AS</b>. Now, your project should build correctly. If it does not, you may have to figure out the bug report by yourself or ask for help in for example,
		Discord.
	</p>
	<p>
		Next, we need to enable AMPS running. When the program initializes, we must load Dual PCM into memory. Simply, call <b>LoadDualPCM</b> from the initialization code when you are sure Z80 can be started correctly. If the driver is compressed or the initialization code needs to be changed, open <b>code/68k Initialize.asm</b>. Finally, we need to run AMPS during vertical interrupt. Simply, calling <b>UpdateAMPS</b>. This should NOT be done at the beginning of vertical interrupt handler however; Due to various reasons, Dual PCM needs to some time to finish completing various tasks during V-int. Attempting to run AMPS before this is finished, is a dangerous idea. Doing a small DMA transfer before running AMPS should be enough, however. Also, there is an equate we need to load a value to. <b>ConsoleRegion</b> needs to have the region bits from register <b>$A10001</b> loaded into it. AMPS only cares about bits 6 and 7, and will not attempt to read any other bits. If your program already stores the region somewhere, you can make <b>ConsoleRegion</b> point to this variable safely.
	</p>
	<p>
		It is possible, while playing music, that AMPS does not actually work correctly. It is a good idea to first run the <b>mus_Stop</b> command, as this ensures that driver memory gets cleared correctly before any music is played. While in reality this should not be necessary, it's good to be safe than sorry. Additionally, checking that there is no RAM collisions or any suspicious behaviour is a good idea. If the driver still does not work and you cannot figure out some error, contact the developers for help.
	</p>

	<h1 id="part13" class="bd"><a class="bx" href="#part13">13 — Frequent Questions & Answers</a></h1>
	<h3>Do you have a Discord server?</h3>
	<p>
		We do indeed! If you want to get the latest AMPS news and exclusive updates, talk to the developers, ask questions and get help, do join in! We also host other related projects under the same server. <a href="https://discord.gg/nW3CFaU">Join here</a>.
	</p>
	<h3>Where should I report bugs?</h3>
	<p>
		Preferably, you should submit an issue to the Github page of the project. However, you can also report them on our Discord or by directly messaging Aurora on SSRG, Retro, or Discord.
	</p>
	<h3>I have a good idea! But how should I ask for it to get implemented?</h3>
	<p>
		Similarly to reporting bugs, you can in the same way also do feature requests or other improvements. There is no guarantee your feature request will get implemented but it will be considered for a future version.
	</p>
	<h3>Why is there no installation tutorial for my preferred disassembly?</h3>
	<p>
		It would be impossible to make tutorials for every single possible disassembly. Instead, there are pre-made disassemblies available for many common setups. IT is advised to follow the commits for these disassemblies to port the sound driver to your specific setup. If no pre-made disassembly exists for your setup, you may request for it to be created by messaging Aurora.
	</p>
	<h3>How often is AMPS updated?</h3>
	<p>
		It depends entirely on the changes being made and my personal time available. There is no set timeline for updates. The Github repositories will update more often and a release will only be made when there is something stable to show.
	</p>
	<h3>Can I edit AMPS and use it for my project?</h3>
	<p>
		Yes, AMPS is open source and anyone can edit it to their liking. The source code is made to be as easy to modify as possible while still being optimal. You are free to use AMPS for any project as well. Although AMPS is open source and free to use for commercial purposes, because it is technically based on Sound-Source, which is property of SEGA, it may not be a good idea to use for commercial purposes.
	</p>
	<h3>Can you make a custom version of AMPS for me?</h3>
	<p>
		No I cannot. The source code is documented there for you, so you can figure it out by yourself.
	</p>
	<h3>Why does AMPS use so much ROM space?</h3>
	<p>
		AMPS code is highly efficient, and therefore a lot of code is actually repeated multiple times in order to save on processor cycles. This means that a lot more ROM space is used to save on processor cycles. Additionally, Dual PCM requires data for volume tables, samples, the driver itself, and various other things in order to function efficiently. AMPS attempts to reduce on ROM space requirements at times, but rarely at the cost of extra processor cycles.
	</p>

	<h1 id="part14" class="bd"><a class="bx" href="#part14">14 — Changelog</a></h1>
	<p>
		This section contains information about what changes were done between different AMPS and this document revisions. This should help users be informed regarding what differences there are between any release, such as for updating their AMPS release and navigating this document to see what changes they wish to learn about.
	</p>
	<h3 id="part14_1" class="bd"><a class="bx" href="#part14_1">14.1 — AMPS v1.0</a></h3>
	<p>
		Initial AMPS release.
	</p>
	<h3 id="part14_2" class="bd"><a class="bx" href="#part14_2">14.2 — AMPS v2.0</a></h3>
	<p>
		Second major AMPS release. Info to be added here.
	</p>
	<h3 id="part14_3" class="bd"><a class="bx" href="#part14_3">14.3 — AMPS v2.1</a></h3>
	<p>
		Revision to AMPS v2.0. This change fixes various bugs, and changes the modulation algorithm to allow a bit more freedom for music creators, and to be (nearly) compatible with Sound-Source Z80. Here is a list of changes:
	</p>
	<ul>
		<li>sFreqOn and sFreqOff are no longer tracker commands.</li>
		<li>New tracker commands: ssModFreq and sModReset.</li>
		<li>Changes to sModAMPS: Only the <b>&lt;wait&gt;</b> and <b>&lt;step&gt;</b> parameters are loaded initially. This only makes a difference when note is held. The modulation parameters are not reset, which allows the user to change how modulation works mid-note without resetting the offset. In order for the old behaviour to work, sModReset can be used after sModAMPS is used. The <b>&lt;count&gt;</b> is also changed. Now, the value is subtracted before being checked, meaning value of $00 will not start by negating the <b>&lt;step&gt;</b>. Additionally, now it is treated as infinite, meaning modulation up and down is possible for unlimited time. If <b>&lt;count&gt;</b> is $01, the value initially is set to $01 instead of $00, making short modulations still possible. When <b>&lt;wait&gt;</b> is counting down, modulation frequency is still accounted for.</li>
		<li>The frame a note is played, modulation, portamento and modulation envelope are all updated.</li>
		<li>mfbNoPAL flag is used to check whether or not PAL mode is enabled, instead of checking for the region. The flag is updated based on song header and PAL region by dPlaySnd_Music.</li>
		<li>Fixed a bug where DAC panning was not reset correctly for music channels, leading to issues with panning.</li>
		<li>Fixed a bug with modulation envelopes not working as intended.</li>
		<li>Added a new PSG frequency to match the PSG table exactly with Sound-Source Z80.</li>
		<li>Added a new FM frequency to help with Sound-Source Z80.</li>
		<li>Added a feature that allows easier integration with sound test engines.</li>
		<li>Speed shoes tempo algorithm now works by running the sound driver twice when the timeout occurs. This also means speed shoes has its own timeout instead of using the main tempo.</li>
		<li>AMPS Includer can list the names of all music and sfx tracks (not commands however!) now.</li>
	</ul>
</main>
</div>
</body>
</html>
